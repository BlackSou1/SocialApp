(this["webpackJsonpreact-project"]=this["webpackJsonpreact-project"]||[]).push([[0],{49:function(e,t,s){},53:function(e,t,s){"use strict";s.r(t);var n=s(1),o=s(19),a=s(3),c=s(2),i=s(12);s(48),s(49);const r=(e,t={})=>({type:"OPEN_MODAL",name:e,opts:t}),l=e=>({type:"CLOSE_MODAL",name:e});var d=s(26),u=s(34);let m;function b(){const e=window.innerWidth-document.body.offsetWidth+"px";m=document.querySelectorAll(".fixed-item"),document.body.style.overflow="hidden",document.body.style.marginRight=e,m.forEach((t=>t.style.paddingRight=e))}function j(){document.body.style.overflow="",document.body.style.marginRight="",m.forEach((e=>e.style.paddingRight=""))}var f=(e=!1,t)=>{switch(t.type){case"OPEN_HAMBURGER":return b(),!0;case"CLOSE_HAMBURGER":return!1;default:return e}};const h={activeModals:[],currentModal:null,gallery:{content:[]},modals:{},zoom:{}};var p=(e=h,t)=>{var s;const n={...e,actionConfirm:{...e.actionConfirm},activeModals:[...e.activeModals],modals:{...e.modals},zoom:{...e.zoom}};switch(t.type){case"OPEN_MODAL":return b(),n.modals[t.name]=!0,n.activeModals.push(t.name),n.currentModal=t.name,n.actionConfirm=t.opts.actionConfirm,n.actionError=t.opts.actionError,n.changeAvatarCommunityId=t.opts.changeAvatarCommunityId,t.opts.gallery&&(n.gallery=t.opts.gallery),(null===(s=t.opts.zoom)||void 0===s?void 0:s.img)&&(n.zoom.img=t.opts.zoom.img,n.zoom.alt=t.opts.zoom.alt||""),n;case"CLOSE_MODAL":return n.modals[t.name]=!1,n.activeModals.includes(t.name)&&(n.activeModals.splice(n.activeModals.indexOf(t.name)),n.currentModal=n.activeModals[n.activeModals.length-1]),n;default:return e}};function v(e,t){let s=0;[...e].forEach((e=>s+=e.charCodeAt(0)));const n=n=>(s+e.length+parseInt(t.toString(),36)%(n+1)**2)%26+(2===n?0:10),o=e=>e.toString(36),a=n(1),c=n(2),i=n(3),r=n(4);let l="";return[...e].forEach(((e,t)=>{l+=String.fromCharCode(e.charCodeAt(0)+a+c+i+r-Math.min(t%60,t%65,t%70))})),l=btoa(l),l[0]+o(a)+o(c)+o(i)+l.slice(1,-2)+o(r)+l.slice(-2)}function O(e){const t=parseInt(e[1],36),s=parseInt(e[2],36),n=parseInt(e[3],36),o=parseInt(e[e.length-3],36),a=e[0]+e.slice(4,-3)+e.slice(-2);let c="";return[...atob(a)].forEach(((e,a)=>{c+=String.fromCharCode(e.charCodeAt(0)-t-s-n-o+Math.min(a%60,a%65,a%70))})),c}const x={account:{id:null},info:{avatar:"",gender:"",id:"",lastName:"",lastSeen:0,name:""}};var _=(e=x,t)=>{const s=localStorage.getItem("loggedIn");let n;switch(t.type){case"LOG_IN":return n={id:t.user.account.id,password:O(t.user.account.password)},document.cookie=`USER_DATA=${JSON.stringify(n)}; expires=${new Date(Date.now()+31536e6)}`,localStorage.setItem("loggedIn","true"),t.user;case"LOG_OUT":return document.cookie=`USER_DATA=; expires=${new Date}`,localStorage.removeItem("loggedIn"),null;case"LOG_SYNC":return s?t.user:(document.cookie=`USER_DATA=; expires=${new Date}`,null);default:return e}};const g=Object(d.b)({user:_,hamburger:f,modal:p}),N=Object(d.c)(g,Object(d.a)(u.a)),y=a.c;var w=N,k=s(0);function I({children:e,className:t,modalName:s,zoomImg:o}){const c=Object(a.b)(),i=y((e=>e.modal)),r=Object(n.useRef)(null),d=Object(n.useRef)(null),u=Object(n.useCallback)((()=>{c(l(s))}),[c,s]);const m=Object(n.useCallback)((e=>{"Escape"===e.key&&i.currentModal===s&&u()}),[u,i.currentModal,s]);Object(n.useEffect)((()=>(window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m))),[m]);const b=Object(n.useRef)(!1);return Object(k.jsx)("div",{className:`${t?`${t} `:""}modal-${s} modal${i.modals[s]?" modal--open":""}`,ref:r,onMouseDown:function(e){e.target===d.current&&(b.current=!0)},onMouseUp:function(e){b.current&&e.target===d.current&&u(),b.current=!1},onTransitionEnd:function(e){i.currentModal||e.target!==r.current||"visibility"!==e.nativeEvent.propertyName||j()},children:Object(k.jsx)("div",{className:"modal__wrapper",ref:d,children:Object(k.jsxs)("div",{className:`modal-${s}__content modal__content`,onClick:e=>e.stopPropagation(),children:[Object(k.jsx)("button",{className:"modal__close primary-button","aria-label":"Close modal",onClick:u,children:"\xd7"}),e,o&&Object(k.jsx)("img",{className:"modal-zoom__img",src:i.zoom.img||"#",alt:i.zoom.alt||""})]})})})}var C=s(13),S=s(11),$=s(23);s(51),s(54);$.a.initializeApp({apiKey:"AIzaSyBiW6i54kOJNamqNFqxO6ZB78uSGIbRqEM",authDomain:"social-app-bs.firebaseapp.com",databaseURL:"https://social-app-bs-default-rtdb.europe-west1.firebasedatabase.app",projectId:"social-app-bs",storageBucket:"social-app-bs.appspot.com",messagingSenderId:"129896299882",appId:"1:129896299882:web:7bf515fc32dcf9a735f913"});const E=$.a.database(),{increment:L}=$.a.database.ServerValue,P=$.a.database.ServerValue.TIMESTAMP,T=$.a.storage();function R(){const e=Object(n.useContext)(i.LoadingContext),t=Object(n.useRef)({qty:[],incrementQty(e,t){this.qty.includes(e)||(this.qty.push(e),this.qty.length===this.expectedQty&&t())},setExpected(e,t){this.expectedQty||(this.expectedQty=e,t&&0===this.expectedQty&&t())}}),s=Object(n.useRef)(!1),o=Object(n.useCallback)((e=>document.title=e+" | Social App"),[]);return{fetchedItems:t,finishLoading:Object(n.useCallback)((t=>{t&&o(t),s.current=!0,e.done(),window.scrollTo(0,0)}),[e,o]),loaded:s,setTitle:o}}function A(){const e=Object(n.useRef)(!1),[t,s]=Object(n.useState)(!1),o=Object(n.useCallback)(((t=!0)=>{e.current=t,s(t)}),[]);return{AsyncButton:Object(n.useCallback)((e=>Object(k.jsx)(re,{loading:t,...e})),[t]),buttonLoading:t,buttonLoadingRef:e,setButtonLoading:o}}function D(e=!0){const[t,s]=Object(n.useState)([]);return{addImgPreview:n=>{const o=[...n.target.files];e||(o.length=1);let a=o.length;n.target.value="";const c=[];o.forEach((e=>{let n,o;["jpg","jpeg","png"].includes(e.name.split(".").pop().toLowerCase())||(o=!0,a--);const i={lastModified:e.lastModified,name:e.name,size:e.size,type:e.type};for(const s of t)if(JSON.stringify(s.props)===JSON.stringify(i)){n=!0,a--;break}if(!n||!o){const n=new FileReader;n.onload=()=>{c.push({props:i,file:e,result:n.result}),c.length===a&&s([...t,...c])},n.readAsDataURL(e)}}))},imgPreview:t,setImgPreview:s}}i.topbar.config({barColors:{0:"rgba(128, 215, 255, 1)"},className:"loading-bar",shadowBlur:5,shadowColor:"rgba(0, 0, 0, 1)"});const M=e=>E.ref(e);M().orderByChild("u");function q(e){const t=t=>({equalTo:s=>({on(n){const o=t.equalTo(s).on("value",(e=>n(e.val())));return()=>M(e).off("value",o)},once:e=>t.equalTo(s).once("value",(t=>e(t.val())))})});return{newKey:()=>M().push().key,on(t){const s=M(e).on("value",(e=>t(e.val())));return()=>M(e).off("value",s)},once:t=>M(e).once("value",(e=>t(e.val()))),onDisconnect:()=>M(e).onDisconnect(),orderByChild:s=>t(M(e).orderByChild(s)),orderByValue:()=>t(M(e).orderByValue()),push:()=>M(e).push(),remove:()=>M(e).remove(),set:t=>M(e).set(t),update:t=>M(e).update(t)}}function B({callback:e,community:t,fields:s=["info"],userId:n}){const o={},a=[],c=s.map((e=>{const t=e.split("/");return t[t.length-1]}));return s.forEach(((s,i)=>{a.push(q(`${t?"communities/community":"users/user"}${n}/${s}`).on((t=>{o[c[i]]=t,c.map((e=>o[e])).includes(void 0)||e(o.info?{...o}:null)})))})),()=>a.forEach((e=>e()))}var F=[{id:"name",name:"name",title:"Name",errors:{maxLength:{value:32,message:"A name cannot contain more than 32 characters"},required:"Enter your name"}},{id:"lastName",name:"lastName",title:"Last name",errors:{maxLength:{value:32,message:"A last name cannot contain more than 32 characters"},required:"Enter your last name"}},{id:"country",name:"country",title:"Country",errors:{maxLength:{value:56,message:"A country cannot contain more than 56 characters"}}},{id:"city",name:"city",title:"City",errors:{maxLength:{value:85,message:"A city cannot contain more than 85 characters"}}},{autoComplete:"off",id:"status",name:"status",title:"Status",errors:{maxLength:{value:80,message:"A status cannot contain more than 80 characters"}}},{id:"email",name:"email",title:"Email",errors:{maxLength:{value:320,message:"An email cannot contain more than 320 characters"},pattern:{value:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,message:"Enter a correct email address!"},required:"Enter an email address"}},{id:"password",name:"password",type:"password",title:"Password",autoComplete:"new-password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},minLength:{value:2,message:"A password must be at least 2 characters long"},pattern:{value:/^[a-zA-Z0-9!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~-]*$/,message:"A password can only contain letters (a-z, A-Z), numbers, and symbols !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~, and cannot contain spaces"},required:"Enter a password"}},{id:"existingPassword",name:"password",type:"password",title:"Password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},required:"Enter your password"}},{id:"confirmPassword",name:"password",type:"password",title:"Confirm password",autoComplete:"new-password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},required:"Confirm your password"}},{id:"title",name:"title",title:"Title",errors:{maxLength:{value:32,message:"A title cannot contain more than 32 characters"},required:"Enter community title"}},{id:"description",name:"text",title:"Description",errors:{maxLength:{value:256,message:"A description cannot contain more than 256 characters"}}},{id:"shortDescription",name:"text",title:"Short description",errors:{maxLength:{value:100,message:"A short description cannot contain more than 100 characters"}}}];const z=({register:e,userGender:t})=>Object(k.jsxs)("div",{className:"gender",children:[Object(k.jsx)("h4",{className:"gender__title",children:"Gender"}),Object(k.jsx)("div",{className:"gender__items",children:["Male","Female"].map((s=>Object(k.jsxs)("label",{className:"gender__item",children:[Object(k.jsx)("input",{className:"gender__input",defaultChecked:s.toLowerCase()===(t||"male"),type:"radio",value:s.toLowerCase(),...e("gender")}),Object(k.jsx)("p",{className:"gender__text",children:s})]},s)))})]});var U=({opts:{defaultValue:e,errors:t,label:s,labelText:o,obj:a,placeholder:c,register:i},...r})=>{const[l,d]=Object(n.useState)(!1),u={id:a.id,autoCapitalize:["password","email"].includes(a.name)?"off":"on",autoComplete:a.autoComplete||"on",defaultValue:e||"",placeholder:c?a.title:"",spellCheck:!["password","email"].includes(a.name),...r};return Object(k.jsxs)("div",{className:"primary-form__item",children:[s&&Object(k.jsx)("label",{className:"primary-form__label",htmlFor:r.id||a.id,children:o||a.title}),["password","existingPassword"].includes(a.id)?Object(k.jsxs)("div",{className:"primary-form__password",children:[Object(k.jsx)("input",{className:"primary-form__input-password primary-form__input",type:l?"text":"password",...u,...i("password",a.errors)}),Object(k.jsx)("button",{className:"primary-form__password-show",type:"button","aria-label":"Toggle password visibility",onClick:()=>d(!l),children:Object(k.jsx)("i",{className:l?"far fa-eye":"far fa-eye-slash"})})]}):Object(k.jsx)("input",{className:"primary-form__input",type:a.type||"text",...u,...i(a.id,a.errors)}),t[a.id]&&Object(k.jsx)("p",{className:"error-text",children:t[a.id].message})]})};function H(e,t,s="s"){return`${t} ${e}${1!==t?s:""}`}function Y(e,t){const s=new Date(e),n=Date.now()+1e3,o=new Date(n),a=(n-e)/1e3,c=a/60,i=c/60,r=s;return a<0?"just now":c<1?`${H("second",Math.floor(a))} ago`:i<1?`${H("minute",Math.floor(c))} ago`:i<3&&o.getDate()===s.getDate()?`${H("hour",Math.floor(i))} ago`:i<24&&o.getDate()===s.getDate()?t?"today":`today at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`:i<48&&new Date(n-864e5).getDate()===s.getDate()?t?"yesterday":`yesterday at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`:o.getFullYear()===s.getFullYear()?t?`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()}`:`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()} at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`:t?`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()} ${r.getFullYear()}`:`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()} ${r.getFullYear()} at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`}function G(e,t){if(e)return(e=e.trim()).length>t&&(e=e.slice(0,t)),e}function V(e){for(const t in e)e[t]=G(e[t]);return e}const Q=({reqUserId:e,userId:t})=>{q().update({[`users/user${e}/friendRequests/sent/user${t}`]:null,[`users/user${t}/friendRequests/received/user${e}`]:null,[`users/user${e}/friends/user${t}`]:{friendAddDate:P,userId:t},[`users/user${t}/friends/user${e}`]:{friendAddDate:P,userId:e}})},J=e=>{q("posts").orderByChild("authorId").equalTo(e).once((t=>{const s=Object.values({...t}),n={["users/user"+e]:{account:{deleted:!0,id:e},bookmarks:null,connections:null,info:{avatar:"img/user-deleted.svg",deleted:!0,id:e,lastName:"account",name:"Deleted"},photos:null,profilePhotos:null}};s.forEach((e=>n["posts/post"+e.id]=null)),q().update(n)}))},W=(e,t)=>{q("posts").orderByChild("communityId").equalTo(e).once((s=>{const n=Object.values({...s}),o={["communities/community"+e]:{fullInfo:null,info:{avatar:"img/community-deleted.svg",deleted:!0,id:e,subscriberCount:t||null,title:"Deleted community"},photos:null,profilePhotos:null}};n.forEach((e=>o["posts/post"+e.id]=null)),q().update(o),T.ref(`img/community${e}_banner`).delete()}))},K=e=>e.info.deleted?"This user account has been removed":e.connections?"Online":"Last seen "+Y(e.info.lastSeen),Z=({condition:e,contentId:t,contentPath:s,history:n,userId:o,userPath:a})=>{if(!o)return void n.push("/");const c=`${s}/likes/user${o}`,i=`users/user${o}/likes/${a}`;e?q().update({[c]:null,[i]:null}):q().update({[c]:{date:P,userId:o},[i]:{date:P,id:t}})},X=(e,t,s,n)=>{if(!s)return void t.push("/");const o="communities/community"+e,a=`${o}/subscribers/user${s}`,c=o+"/info/subscriberCount",i=`users/user${s}/communities/subscribed/community${e}`;n?q().update({[c]:L(-1),[a]:null,[i]:null}):q().update({[c]:L(1),[a]:s,[i]:{id:e,date:P}})},ee=e=>{e?localStorage.setItem("darkTheme","true"):localStorage.removeItem("darkTheme")},te=()=>localStorage.getItem("darkTheme"),se=()=>{const e=localStorage.getItem("darkTheme");document.documentElement.classList[e?"add":"remove"]("dark"),document.querySelector("meta[name=theme-color]").content=e?"#1773a8":"#22aeff"},ne=({addToPhotos:e,callback:t,communityId:s,createId:n=!0,file:o,imgParent:a,imgPath:c="photos",index:i,storagePrefix:l="",userId:d})=>{const u=n?q().newKey():c;a=a?`${a}/`:"";const m=T.ref("img/"+(l?l+"_":"")+u).put(o);m.on("state_changed",(()=>0),(()=>w.dispatch(r("action-error",{actionError:"Failed to load image to our database. Try again."}))),(()=>m.snapshot.ref.getDownloadURL().then((o=>new Promise((()=>{const r=s?`communities/community${s}`:`/users/user${d}`,l={[`${r}/${a+c}${n?`/${u}`:""}`]:{date:P,id:n?u:null,src:o}};e&&(l[`${r}/profilePhotos/${u}`]={id:u}),q().update(l),null===t||void 0===t||t({id:u,index:i,link:o})}))))))};function oe({addToPhotosHandler:e,community:t,imgPreview:s,loading:n,removeOnClick:o}){const c=Object(a.b)();return Object(k.jsxs)("div",{className:"upload-preview",children:[Object(k.jsxs)("div",{className:"upload-preview__header",children:[!n&&Object(k.jsx)("button",{className:"upload-preview__header-remove",type:"button",onClick:o,children:"\xd7"}),Object(k.jsx)("button",{className:"upload-preview__header-img-container",type:"button",onClick:()=>c(r("zoom",{zoom:{img:s.result,alt:""}})),children:Object(k.jsx)("img",{className:"upload-preview__header-img",src:s.result,alt:""})})]}),Object(k.jsx)("div",{className:"upload-preview__footer",children:Object(k.jsxs)("div",{className:"upload-preview__footer-wrapper",children:[Object(k.jsx)("h4",{className:"upload-preview__title upload-preview__footer-item",children:s.props.name}),e&&Object(k.jsxs)("label",{className:"upload-preview__checkbox upload-preview__footer-item",children:[Object(k.jsx)("input",{className:"upload-preview__checkbox-input",disabled:n,type:"checkbox",name:"checkbox",onChange:e}),Object(k.jsx)("p",{className:"upload-preview__checkbox-text",children:`Add to ${t?"community":"my"} photos`})]})]})})]})}const ae=({community:e,nameIsLink:t=!0,onClick:s,onlyName:n,text:o,textLink:a,userInfo:i})=>{const r=t?c.b:"h4",l=a?c.b:"p";return Object(k.jsxs)("div",{className:"author-info",children:[Object(k.jsx)(r,{className:"author-info__name",to:t?"/"+(e?"community":"id")+i.id:null,onClick:s,children:i.name+(n?"":" "+i.lastName)}),o&&Object(k.jsx)(l,{className:"author-info__text",to:a,children:o})]})},ce=({community:e,onClick:t,size:s="medium",src:n,userId:o})=>Object(k.jsx)(c.b,{className:"avatar",to:"/"+(e?"community":"id")+o,onClick:t,children:Object(k.jsx)("img",{className:"avatar__img-"+s+" avatar__img",src:n,alt:"Avatar"})}),ie=({avatar:e,user:t})=>{const s=Object(a.b)();return t.info.avatar.endsWith(".svg")?Object(k.jsx)("div",{className:"avatar-gallery-btn--default",children:Object(k.jsx)("img",{className:"avatar-gallery-btn__img",src:t.info.avatar,alt:"Avatar"})}):Object(k.jsx)(c.b,{className:"avatar-gallery-btn",to:"#javascript",onClick:n=>{s(r("gallery",{gallery:{author:t,content:[e],initialSlide:0}})),n.preventDefault()},children:Object(k.jsx)("img",{className:"avatar-gallery-btn__img",src:t.info.avatar,alt:"Avatar"})})},re=({afterIconClass:e,beforeIconClass:t,className:s="",href:n,loading:o,preset:a="primary",onClick:i,text:r,to:l,type:d="button"})=>{const u=e=>e&&Object(k.jsx)("i",{className:(s&&s+"__icon ")+a+"-button__icon button__icon "+e}),m=n?"a":l?c.b:"button";return Object(k.jsxs)(m,{className:(s&&s+" ")+a+"-button button"+(o?" button--loading":""),href:n,to:l,type:"button"===m?d:null,onClick:i,children:[o&&Object(k.jsxs)("div",{className:"button__loading",children:[Object(k.jsx)("div",{}),Object(k.jsx)("div",{}),Object(k.jsx)("div",{}),Object(k.jsx)("div",{})]}),u(t),Object(k.jsx)("p",{className:(s&&s+"__text ")+a+"-button__text button__text",children:r}),u(e)]})},le=({className:e,databaseRef:t,disabled:s,emptyButtonText:o,emptyFieldText:a,field:c,ownerId:i,renderInputId:r})=>{const{formState:{errors:l},handleSubmit:d,register:u,reset:m}=Object(C.a)(),b=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[j,f]=Object(n.useState)(!1);return Object(k.jsx)("div",{className:(e?e+" ":"")+"editable-field",children:i!==b||s?Object(k.jsx)("p",{className:(e?e+"__text ":"")+"editable-field__text",children:c||a}):j?Object(k.jsxs)("form",{className:(e?e+"__form ":"")+"editable-field__form",action:"#",method:"post",onSubmit:d((function(e){q(t).set(e[r].trim()||null),f(!1)})),children:[Object(k.jsx)(U,{autoFocus:!0,opts:{obj:F.find((e=>e.id===r)),defaultValue:c,errors:l,placeholder:!0,register:u}}),Object(k.jsxs)("div",{className:(e?e+"__form-buttons ":"")+"editable-field__form-buttons",children:[Object(k.jsx)(re,{text:"Save",type:"submit"}),Object(k.jsx)(re,{preset:"secondary",text:"Cancel",onClick:()=>f(!1)})]})]}):Object(k.jsxs)("button",{className:(e?e+"__button ":"")+"editable-field__button",onClick:()=>{f(!0),m()},children:[Object(k.jsx)("i",{className:(e?e+"__icon ":"")+"editable-field__icon fas fa-edit"}),Object(k.jsx)("p",{className:(e?e+"__text ":"")+"editable-field__text",children:c||o})]})})},de=({bookmarkType:e,children:t,itemId:s})=>{const n="community"===e?"communities":e+"s",o=Object(S.useHistory)(),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),c=y((t=>{var o,a,c,i;return null===(o=t.user)||void 0===o||null===(a=o.bookmarks)||void 0===a||null===(c=a[n])||void 0===c||null===(i=c[e+s])||void 0===i?void 0:i.id}));return Object(k.jsxs)("div",{className:"interaction-submenu",children:[Object(k.jsx)("div",{className:"interaction-submenu__icon",tabIndex:0,children:Object(k.jsx)("i",{className:"fas fa-chevron-down"})}),Object(k.jsxs)("div",{className:"interaction-submenu__wrapper",children:[Object(k.jsx)(re,{text:(c?"Remove from":"Add to")+" bookmarks",onClick:()=>{if(!a)return void o.push("/");const t=q(`users/user${a}/bookmarks/${n}/${e+s}`);c?t.remove():t.set({date:P,id:s})}}),t]})]})},ue=({addToPhotosButton:e,avatar:t,buttonText:s="Post",children:n,community:o,inputPlaceholder:a="Share your thoughts",uploadCallback:c,userId:i})=>{const r=o?i:null,{formState:{errors:l},handleSubmit:d,register:u,reset:m}=Object(C.a)(),{AsyncButton:b,buttonLoading:j,setButtonLoading:f}=A(),{addImgPreview:h,imgPreview:p,setImgPreview:v}=D();function O(e){(({buttonLoading:e,callback:t,communityId:s,imgPreview:n,inputText:o,setButtonLoading:a,userId:c})=>{if(e)return;const i=G(o,5e3),r=n,l=[];if(r.length||i){null===a||void 0===a||a(),r.length||d();const e=({id:e,index:t})=>{l[t]=e,l.length!==r.length||l.includes(void 0)||d()};r.forEach(((t,n)=>ne({addToPhotos:t.addToPhotos,callback:e,communityId:s,file:t.file,index:n,userId:c})))}function d(){const e=l.map((e=>({type:"img",value:e})));i&&e.unshift({type:"text",value:i}),t(e)}})({buttonLoading:j,callback:async e=>{const t=()=>{m(),v([]),f(!1)};c?(await c(e),t()):q("contentData/nextPostId").once((s=>{const n={authorId:o?null:i,communityId:r,content:e,date:P,id:s,shares:0};q().update({["posts/post"+s]:n,"contentData/nextPostId":`${parseInt(s,10)+1}`}).then(t)}))},communityId:r,imgPreview:p,inputText:e.msg,setButtonLoading:f,userId:i})}return Object(k.jsxs)("div",{className:"post-msg",children:[Object(k.jsx)(ce,{community:o,size:"small",src:t,userId:i}),Object(k.jsxs)("form",{className:"post-msg__form",action:"#",method:"post",onSubmit:d(O),children:[n,Object(k.jsx)("textarea",{className:"post-msg__form-input"+(j?" input--disabled":""),disabled:j,placeholder:a+"...",onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d(O)())},...u("msg",{maxLength:{value:5e3,message:"A message cannot contain more than 5000 characters"}})}),l.msg&&Object(k.jsx)("p",{className:"error-text",children:l.msg.message}),Object(k.jsxs)("div",{className:"post-msg__form-footer",children:[Object(k.jsxs)("div",{className:"post-msg__form-footer-inputs",children:[Object(k.jsxs)("label",{className:"post-msg__form-photo",htmlFor:"post-msg__form-photo-input",children:[Object(k.jsx)("button",{className:"post-msg__form-photo-button"+(j?" post-msg__form-photo-button--disabled":""),type:"button",onClick:e=>e.target.closest("label").click(),"aria-label":"Photo",children:Object(k.jsx)("i",{className:"post-msg__form-photo-icon fas fa-camera"})}),Object(k.jsx)("input",{className:"post-msg__form-photo-input",id:"post-msg__form-photo-input",disabled:j,type:"file",accept:".jpg, .jpeg, .png",multiple:!0,hidden:!0,onChange:h})]}),Object(k.jsx)(b,{text:s,type:"submit"})]}),p.length>0&&Object(k.jsx)("div",{className:"upload-previews",children:Object(k.jsx)("div",{className:"upload-previews__wrapper",children:p.map(((t,s)=>Object(k.jsx)(oe,{addToPhotosHandler:e?e=>(({e:e,i:t,imgPreview:s,setImgPreview:n})=>{n(s.map(((s,n)=>(n===t&&(s.addToPhotos=e.target.checked),s))))})({e:e,i:s,imgPreview:p,setImgPreview:v}):void 0,community:o,imgPreview:t,loading:j,removeOnClick:()=>v(p.filter((e=>e.result!==t.result)))},s)))})})]})]})]})},me=({link:e,onChange:t,onSubmit:s,value:n})=>{const o=e?c.b:"button";return Object(k.jsxs)("form",{className:"search-bar",action:"#",method:"post",onSubmit:s,children:[Object(k.jsx)("input",{className:"search-bar__input primary-form__input",type:"text",name:"search",placeholder:"Search...",value:n,onChange:t}),Object(k.jsx)(o,{className:"search-bar__button",to:e&&"/search?query="+n,children:Object(k.jsx)("i",{className:"search-bar__button-icon fas fa-search"})})]})},be=({avatarSize:e="medium",bottomText:t,bottomTextLink:s,children:n,childrenBottom:o,community:a,linksOnClick:i,userInfo:r,wrapperLink:l})=>{const d=l?c.b:"div";return Object(k.jsxs)("div",{className:"user",children:[Object(k.jsx)(ce,{community:a,size:e,src:r.avatar,userId:r.id,onClick:i}),Object(k.jsxs)(d,{className:"user__wrapper",to:l,children:[Object(k.jsxs)("div",{className:"user__header",children:[Object(k.jsx)(ae,{community:a,nameIsLink:!l,text:t,textLink:s,userInfo:r,onClick:i}),n]}),o&&Object(k.jsx)("div",{className:"user__bottom",children:o})]})]})};function je(){const e=Object(a.b)(),t=y((e=>e.modal.actionConfirm)),s=y((e=>e.modal.activeModals)),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.password})),{formState:{errors:c},handleSubmit:i,register:r,reset:d}=Object(C.a)(),u=Object(n.useRef)(!1),[m,b]=Object(n.useState)(!1);function j(s){s.password&&O(o)!==s.password?b(!0):(e(l("action-confirm")),null===t||void 0===t||t.callback())}return Object(n.useEffect)((()=>{!u.current&&s.includes("action-confirm")?(u.current=!0,d(),b(!1)):u.current=!1}),[s,d]),(null===t||void 0===t?void 0:t.text)?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"modal-action-confirm__header",children:Object(k.jsx)("h4",{className:"modal-action-confirm__title",children:"Confirm action"})}),Object(k.jsxs)("div",{className:"modal-action-confirm__wrapper",children:[Object(k.jsx)("p",{className:"modal-action-confirm__text",children:t.text+(t.irreversible?" This action is irreversible!":"")}),t.password&&Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",autoComplete:"off",onSubmit:i(j),children:[Object(k.jsx)(U,{id:"modal-action-confirm__form-input",onInput:()=>b(!1),opts:{obj:F.find((e=>"existingPassword"===e.id)),errors:c,label:!0,labelText:"Enter your password to continue",placeholder:!0,register:r}}),m&&Object(k.jsx)("p",{className:"error-text",children:"Wrong password."})]}),Object(k.jsxs)("div",{className:"modal-action-confirm__buttons",children:[Object(k.jsx)(re,{afterIconClass:"fas fa-check",preset:"secondary",text:"Yes",type:"submit",onClick:i(j)}),Object(k.jsx)(re,{afterIconClass:"fas fa-times",preset:"remove",text:"No",onClick:()=>e(l("action-confirm"))})]})]})]}):null}function fe(){const e=Object(a.b)(),t=y((e=>e.modal.actionError));return t?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"modal-action-error__header",children:Object(k.jsx)("h4",{className:"modal-action-error__title",children:"Error"})}),Object(k.jsxs)("div",{className:"modal-action-error__wrapper",children:[Object(k.jsx)("p",{className:"modal-action-error__text",children:t}),Object(k.jsx)("div",{className:"modal-action-error__buttons",children:Object(k.jsx)(re,{afterIconClass:"fas fa-check",text:"OK",onClick:()=>e(l("action-error"))})})]})]}):null}function he(){const e=Object(a.b)(),t=y((e=>e.modal.changeAvatarCommunityId)),s=y((e=>e.modal.currentModal)),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),{AsyncButton:i,buttonLoading:d,setButtonLoading:u}=A(),{addImgPreview:m,imgPreview:b,setImgPreview:j}=D(!1),f=Object(n.useRef)(!1);return"change-avatar"===s&&(f.current=!0),f.current?b.length?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(oe,{imgPreview:b[0],loading:d,removeOnClick:()=>j([])}),Object(k.jsx)(i,{afterIconClass:"fas fa-check",className:"set-button",preset:"secondary",text:"Set as avatar",onClick:function(){d||(u(),ne({addToPhotos:!0,communityId:t,file:b[0].file,userId:o,callback:({link:s})=>{q(`/${t?`communities/community${t}`:`users/user${o}`}/info/avatar`).set(s).then((()=>{e(l("change-avatar")),setTimeout((()=>{u(!1),j([])}),300)}))}}))}})]}):Object(k.jsxs)(k.Fragment,{children:[!t&&c&&Object(k.jsx)(re,{afterIconClass:"fas fa-images",text:"Choose an existing photo",onClick:()=>e(r("choose-photo"))}),Object(k.jsxs)("label",{className:"modal-change-avatar__upload",htmlFor:"modal-change-avatar__upload-input",children:[Object(k.jsx)(re,{afterIconClass:"fas fa-upload",preset:"secondary",text:"Upload photo",onClick:e=>{var t;return null===(t=e.target.closest("label"))||void 0===t?void 0:t.click()}}),Object(k.jsx)("input",{className:"modal-change-avatar__upload-input",id:"modal-change-avatar__upload-input",type:"file",accept:".jpg, .jpeg, .png",hidden:!0,onChange:m})]})]}):null}function pe(){const e=Object(a.b)(),t=y((e=>e.modal.currentModal)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.photos})),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),i=Object(n.useRef)(!1),[r,d]=Object(n.useState)();return Object(n.useEffect)((()=>{const e=[];Object.keys({...c}).forEach((t=>e.push(null===o||void 0===o?void 0:o[t]))),e.includes(void 0)||(e.sort(((e,t)=>t.date-e.date)),d(e))}),[o,c]),"choose-photo"===t&&(i.current=!0),i.current?Object(k.jsxs)("div",{className:"modal-choose-photo__photos",children:[Object(k.jsx)("div",{className:"photos__header",children:Object(k.jsx)("h4",{className:"photos__title",children:`Your photos (${null===r||void 0===r?void 0:r.length})`})}),r.length>0&&Object(k.jsx)("div",{className:"photos__items",children:Object(k.jsx)("div",{className:"photos__items-wrapper",children:r.map((t=>Object(k.jsx)("button",{className:"photos__item",onClick:()=>{return n=t.src,q(`/users/user${s}/info/avatar`).set(n),e(l("choose-photo")),void e(l("change-avatar"));var n},children:Object(k.jsx)("div",{className:"photos__item-wrapper",children:Object(k.jsx)("img",{className:"photos__item-img",src:t.src,alt:""})})},t.id)))})})]}):null}function ve(){const e=Object(a.b)(),t=y((e=>e.modal.currentModal)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{formState:{errors:o},handleSubmit:c,register:i,reset:r}=Object(C.a)(),{AsyncButton:d,buttonLoadingRef:u,setButtonLoading:m}=A(),b=Object(n.useRef)(!1);return"create-community"===t&&(b.current=!0),b.current?Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:c((function(t){if(!u.current){m(),t=V(t);for(const e in t)t[e]||(t[e]=null);q("contentData/nextCommunityId").once((n=>{const o={fullInfo:{creationTime:P,description:t.description},info:{avatar:"img/community-default.svg",creatorId:s,id:n,shortDescription:t.shortDescription,title:t.title}};q().update({["communities/community"+n]:o,"contentData/nextCommunityId":`${parseInt(n,10)+1}`}).then((()=>{e(l("create-community")),setTimeout((()=>{r(),m(!1)}),300)}))}))}})),children:[F.filter((e=>["title","description","shortDescription"].includes(e.id))).map((e=>Object(k.jsx)(U,{opts:{obj:e,errors:o,placeholder:!0,register:i}},e.id))),Object(k.jsx)(d,{text:"Create community",type:"submit"})]}):null}var Oe=s(59),xe=s(56),_e=s(57),ge=s(60),Ne=s(58);function ye(){const e=Object(a.b)(),t=y((e=>e.modal.gallery)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),o=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),i=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),d=Object(n.useRef)(null),u=Object(n.useRef)(null),[m,b]=Object(n.useState)(),[j,f]=Object(n.useState)();function h(){e(l("gallery"))}return Object(n.useEffect)((()=>{m&&j&&(m.params.navigation.prevEl=d.current,m.params.navigation.nextEl=u.current,m.controller.control=j,j.controller.control=m)}),[m,j]),Object(n.useEffect)((()=>{m&&(m[t.content.length>1?"enable":"disable"](),m.update(),m.slideToLoop(t.initialSlide,0))}),[t,m]),t.author?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)(ge.a,{className:"gallery-swiper__container",autoHeight:!0,navigation:{prevEl:d.current,nextEl:u.current},onBeforeInit:e=>{e.params.navigation.prevEl=d.current,e.params.navigation.nextEl=u.current},onSwiper:b,speed:600,children:[t.content.map((n=>{var a;return Object(k.jsxs)(Ne.a,{className:"gallery-swiper__slide",children:[Object(k.jsx)("div",{className:"modal-gallery__img-container",children:Object(k.jsx)("img",{className:"modal-gallery__img",src:n.src,alt:""})}),Object(k.jsxs)("div",{className:"modal-gallery__info",children:[Object(k.jsx)(be,{avatarSize:"small",bottomText:Y(n.date),community:!!(null===(a=t.author)||void 0===a?void 0:a.info.title),linksOnClick:h,userInfo:t.author.info}),c===t.author.info.id&&n.src!==o&&(null===i||void 0===i?void 0:i[n.id])&&Object(k.jsx)(re,{beforeIconClass:"fas fa-user-circle",preset:"secondary",text:"Set as avatar",onClick:()=>{return e=n.src,q(`/users/user${c}/info/avatar`).set(e),void h();var e}}),(c===t.author.info.id||s)&&Object(k.jsx)(re,{beforeIconClass:"fas fa-trash-alt",preset:"remove",text:"Delete photo",onClick:()=>function(s){const n=t.author.info.title,o=(n?"communities/community":"users/user")+t.author.info.id;e(r("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this photo?",irreversible:!0,callback:()=>{const e={[`${o}/photos/${s.id}`]:null,[`${o}/profilePhotos/${s.id}`]:null};t.author.info.avatar===s.src&&(e[`${o}/info/avatar`]=`img/${n?"community":"user"}-default.svg`),q().update(e),T.ref("img/"+s.id).delete(),h()}}}))}(n)})]})]},n.id)})),Object(k.jsx)("button",{className:"gallery-swiper__button-prev swiper-button-prev",ref:d,children:Object(k.jsx)("i",{className:"fas fa-chevron-left"})}),Object(k.jsx)("button",{className:"gallery-swiper__button-next swiper-button-next",ref:u,children:Object(k.jsx)("i",{className:"fas fa-chevron-right"})})]}),Object(k.jsx)(ge.a,{className:"gallery-thumbs__container",breakpoints:{768:{slidesPerView:6}},centeredSlides:!0,onSwiper:f,slidesPerView:4,slideToClickedSlide:!0,spaceBetween:10,speed:600,children:t.content.map((e=>Object(k.jsx)(Ne.a,{className:"gallery-thumbs__slide",children:Object(k.jsx)("button",{className:"gallery-thumbs__slide-button",children:Object(k.jsx)("img",{className:"gallery-thumbs__slide-img",src:e.src,alt:""})})},e.id)))})]}):null}Oe.a.use([xe.a,_e.a]);const we=e=>({type:"LOG_IN",user:e}),ke=e=>({type:"LOG_SYNC",user:e});let Ie,Ce,Se;var $e=()=>e=>{var t,s;null===(t=Se)||void 0===t||t(),null===(s=Ce)||void 0===s||s(),document.cookie.split(";").forEach((t=>{try{Ie=JSON.parse(t.replace("USER_DATA=",""))}catch(s){return void e(ke(null))}""!==Ie.id?Ce=q(`users/user${Ie.id}/account`).orderByValue().equalTo(v(Ie.password,Ie.id)).on((t=>{var s;null===(s=Ce)||void 0===s||s(),t?Se=B({fields:["account","bookmarks","communities","friendRequests","info","photos","profilePhotos"],userId:Ie.id,callback:t=>{var s;(null===t||void 0===t?void 0:t.account.deleted)?e({type:"LOG_OUT"}):t?(e(ke(t)),ee(!!(null===t||void 0===t||null===(s=t.account.preferences)||void 0===s?void 0:s.darkTheme)),se()):e({type:"LOG_OUT"})}}):e(ke(null))})):e(ke(null))}))};let Ee;function Le(){const e=Object(a.b)(),{formState:{errors:t},handleSubmit:s,register:o}=Object(C.a)(),{AsyncButton:c,buttonLoadingRef:i,setButtonLoading:r}=A(),[d,u]=Object(n.useState)({});return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onChange:()=>r(!1),onSubmit:s((function(t){var s;i.current||(r(),t=V(t),null===(s=Ee)||void 0===s||s(),Ee=q("users/").orderByChild("account/email").equalTo(t.email.toLowerCase()).on((s=>{if(Ee(),!i.current)return;const n=function(e){const t={...d};return e.password!==e.confirmPassword&&(t.wrongConfirmPassword=!0),u(t),t}(t);s&&(u({...n,emailExists:!0}),n.emailExists=!0),Object.values(n).includes(!0)?r(!1):q("contentData/nextUserId").once((s=>{t.confirmPassword=null;const n={account:{email:t.email.toLowerCase(),id:s,password:v(t.password,s),preferences:{darkTheme:!!te()||null},registrationTime:P},info:{avatar:"img/user-default.svg",gender:t.gender,id:s,lastName:t.lastName,lastSeen:P,name:t.name}};q().update({["users/user"+s]:n,"contentData/nextUserId":`${parseInt(s,10)+1}`}).then((()=>{e(l("sign-up")),setTimeout((()=>{e(we(n)),e($e())}),300)}))}))})))})),children:[F.filter((e=>["name","lastName"].includes(e.id))).map((e=>Object(k.jsx)(U,{opts:{obj:e,errors:t,placeholder:!0,register:o}},e.id))),Object(k.jsx)(z,{register:o}),Object(k.jsx)(U,{onInput:()=>u({...d,emailExists:!1}),opts:{obj:F.find((e=>"email"===e.id)),errors:t,placeholder:!0,register:o}}),d.emailExists&&Object(k.jsx)("p",{className:"error-text",children:"This email is already used."}),F.filter((e=>["password","confirmPassword"].includes(e.id))).map((e=>Object(k.jsx)(U,{onInput:()=>u({...d,wrongConfirmPassword:!1}),opts:{obj:e,errors:t,placeholder:!0,register:o}},e.id))),d.wrongConfirmPassword&&Object(k.jsx)("p",{className:"error-text",children:"Wrong confirm password."}),Object(k.jsx)(c,{text:"Sign up",type:"submit"})]})}function Pe(){const e=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(k.jsxs)("div",{className:"modals",children:[Object(k.jsx)(I,{modalName:"gallery",children:Object(k.jsx)(ye,{})}),e?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(I,{modalName:"create-community",children:Object(k.jsx)(ve,{})}),Object(k.jsx)(I,{modalName:"change-avatar",children:Object(k.jsx)(he,{})}),Object(k.jsx)(I,{modalName:"choose-photo",children:Object(k.jsx)(pe,{})}),Object(k.jsx)(I,{modalName:"action-confirm",children:Object(k.jsx)(je,{})}),Object(k.jsx)(I,{modalName:"action-error",children:Object(k.jsx)(fe,{})}),Object(k.jsx)(I,{modalName:"zoom",zoomImg:!0})]}):Object(k.jsx)(I,{modalName:"sign-up",children:Object(k.jsx)(Le,{})})]})}function Te(){const e=Object(a.b)(),t=y((e=>e.hamburger)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=Object(n.useRef)(null),[i,r]=Object(n.useState)(!0),l=Object(n.useCallback)((()=>{r(!1),e({type:"CLOSE_HAMBURGER"})}),[e]);const d=Object(n.useCallback)((e=>{"Escape"===e.key&&t&&l()}),[l,t]);return Object(n.useEffect)((()=>(window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d))),[d]),s?Object(k.jsx)("div",{className:"hamburger"+(!i||t?" hamburger--open":""),onClick:l,children:Object(k.jsx)("div",{className:"hamburger__wrapper"+(t?" hamburger__wrapper--open":""),ref:o,onClick:e=>e.stopPropagation(),onTransitionEnd:function(e){t||e.target!==o.current||"transform"!==e.nativeEvent.propertyName||(r(!0),j())},children:Object(k.jsxs)("nav",{className:"hamburger__nav",children:[Object(k.jsx)(c.b,{className:"hamburger__nav-link",to:"/id"+s,onClick:l,children:"My Profile"}),Object(k.jsx)(c.b,{className:"hamburger__nav-link",to:"/news",onClick:l,children:"News"}),Object(k.jsx)(c.b,{className:"hamburger__nav-link",to:"/messages",onClick:l,children:"Messages"}),Object(k.jsx)(c.b,{className:"hamburger__nav-link",to:"/friends",onClick:l,children:"Friends"}),Object(k.jsx)(c.b,{className:"hamburger__nav-link",to:"/communities",onClick:l,children:"Communities"}),Object(k.jsx)(c.b,{className:"hamburger__nav-link",to:"/bookmarks",onClick:l,children:"Bookmarks"}),Object(k.jsx)(c.b,{className:"hamburger__nav-link",to:"/search",onClick:l,children:"Search"})]})})}):null}const Re=Object(n.createContext)(null);function Ae({opts:e={},...t}){let{openState:s,setOpenState:o,submenuClass:a,tag:c}=e;const i=c||n.Fragment;"string"!==typeof a&&(a="submenu");const[r,l]=Object(n.useState)(!1);null!=s&&o||([s,o]=[r,l]);const d=Object(n.useRef)();return Object(k.jsx)(Re.Provider,{value:{buttonRef:d,openState:s,setOpenState:o,submenuClass:a},children:Object(k.jsx)(i,{...t})})}function De({Tag:e,...t}){const{buttonRef:s,openState:o,setOpenState:a,submenuClass:c}=Object(n.useContext)(Re);return Object(k.jsx)(e,{...t,ref:s,className:t.className+(o?` ${c}__button--open`:""),onClick:()=>a(!o)})}function Me({Tag:e="div",...t}){const{buttonRef:s,openState:o,setOpenState:a,submenuClass:c}=Object(n.useContext)(Re),i=Object(n.useRef)(),r=Object(n.useCallback)((e=>{!s.current||s.current.contains(e.target)||i.current.contains(e.target)||a(!1)}),[s,a]);return Object(n.useEffect)((()=>(window.addEventListener("click",r),()=>window.removeEventListener("click",r))),[r]),Object(k.jsx)(e,{...t,ref:i,className:t.className+(o?` ${c}__wrapper--open`:"")})}function qe(){const e=Object(a.b)(),t=Object(S.useHistory)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info})),[i,r]=Object(n.useState)(!0),[l,d]=Object(n.useState)(""),[u,m]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{let e=window.pageYOffset;function t(){const t=window.innerWidth>768,s=t?50:25,n=window.pageYOffset-e,o=window.pageYOffset>(t?200:100);function a(t){e=window.pageYOffset,document.documentElement.style.setProperty("--header-offset",t?"":"0px"),r(t)}n>s&&o?a(!1):n<-s&&a(!0)}return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)}),[]),Object(n.useEffect)((()=>{te()&&(document.body.classList.add("disable-transition"),se(),document.body.scrollHeight,document.body.classList.remove("disable-transition"))}),[]),Object(k.jsx)("header",{className:"header fixed-item"+(i?" header--visible":""),children:Object(k.jsx)("div",{className:"page-width",children:Object(k.jsxs)("div",{className:"header__wrapper",children:[Object(k.jsx)(c.b,{className:"header__logo",to:s?"/news":"/","aria-label":"Homepage",children:"Social App"}),Object(k.jsxs)("div",{className:"header__right",children:[Object(k.jsx)(me,{link:!0,onChange:e=>d(e.target.value),onSubmit:function(e){e.preventDefault(),t.push("/search?query="+(l||""))},value:l}),void 0===s&&Object(k.jsx)(Be,{}),s&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"header__user",children:Object(k.jsxs)(Ae,{opts:{openState:u,setOpenState:m},children:[Object(k.jsxs)(De,{Tag:"button",className:"header__user-button",children:[Object(k.jsx)("p",{className:"header__user-button-name",children:o.name}),Object(k.jsx)("img",{className:"avatar__img-small",src:o.avatar,alt:"Avatar"}),Object(k.jsx)("i",{className:"header__user-button-icon fas fa-chevron-down"})]}),Object(k.jsx)(Me,{className:"header__user-submenu submenu__wrapper",children:Object(k.jsxs)("div",{className:"header__user-submenu-wrapper",children:[Object(k.jsx)(Be,{}),Object(k.jsx)(c.b,{className:"header__user-submenu-button",to:"/settings",onClick:()=>m(!1),children:"Settings"}),Object(k.jsx)("button",{className:"header__user-submenu-button",onClick:()=>{m(!1),e({type:"LOG_OUT"}),e($e()),t.push("/")},children:"Log out"})]})})]})}),Object(k.jsx)("button",{className:"header__hamburger","aria-label":"Open navigation",onClick:()=>e({type:"OPEN_HAMBURGER"}),children:Object(k.jsx)("i",{className:"fas fa-bars"})})]})]})]})})})}function Be(){const e=y((e=>{var t,s,n;return null===(t=e.user)||void 0===t||null===(s=t.account)||void 0===s||null===(n=s.preferences)||void 0===n?void 0:n.darkTheme})),t=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[s,o]=Object(n.useState)("true"===te());return Object(n.useEffect)((()=>{o(t?!!e:!!te())}),[e,t]),Object(k.jsx)("label",{className:"change-theme"+(s?" change-theme--checked":""),children:Object(k.jsxs)("div",{className:"change-theme__wrapper",children:[Object(k.jsx)("input",{className:"change-theme__input",type:"checkbox","aria-label":"Toggle dark theme",checked:s,onChange:function(){if(t){const s=q(`users/user${t}/account/preferences/darkTheme`);e?s.remove():s.set(!0),o(!!e)}else ee(!te()),se(),o(!!te())}}),Object(k.jsx)("i",{className:"change-theme__icon fas fa-cloud-moon"})]})})}function Fe(){const e=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return e?Object(k.jsx)("nav",{className:"navigation",children:Object(k.jsxs)("div",{className:"navigation__wrapper",children:[Object(k.jsxs)(c.b,{className:"navigation__link",to:"/id"+e,children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-user-circle"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"My Profile"})]}),Object(k.jsxs)(c.b,{className:"navigation__link",to:"/news",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-newspaper"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"News"})]}),Object(k.jsxs)(c.b,{className:"navigation__link",to:"/messages",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-comment"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Messages"})]}),Object(k.jsxs)(c.b,{className:"navigation__link",to:"/friends",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-user-friends"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Friends"})]}),Object(k.jsxs)(c.b,{className:"navigation__link",to:"/communities",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-users"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Communities"})]}),Object(k.jsxs)(c.b,{className:"navigation__link",to:"/bookmarks",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-bookmark"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Bookmarks"})]})]})}):null}function ze(){const[e,t]=Object(n.useState)("scroll-to-top__button");return Object(n.useEffect)((()=>{const e=setInterval((()=>{t("scroll-to-top__button"+(window.pageYOffset<window.innerHeight?" scroll-to-top__button--hidden":""))}),100);return()=>clearInterval(e)}),[]),Object(k.jsx)("div",{className:"scroll-to-top",children:Object(k.jsx)("div",{className:"page-width",children:Object(k.jsx)("div",{className:"scroll-to-top__wrapper",children:Object(k.jsx)("button",{className:e,"aria-label":"Scroll to top",onClick:function(){document.body.scrollIntoView({behavior:"smooth",block:"start"})},children:Object(k.jsx)("i",{className:"fas fa-chevron-up"})})})})})}function Ue(){const e=Object(a.b)(),t=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));Object(n.useEffect)((()=>{if(!t)return;const e="/users/user"+t;let s;const n=q(".info/connected").on((t=>{var n;t&&(null===(n=s)||void 0===n||n.remove(),s=q(e+"/connections").push(),s.set(!0),s.onDisconnect().remove(),q(e+"/info/lastSeen").onDisconnect().set(P))}));return()=>{s.remove(),q(e+"/info/lastSeen").onDisconnect().cancel(),q(e+"/info/lastSeen").set(P),n()}}),[e,t]);const s=Object(n.useCallback)((()=>{e($e())}),[e]);return Object(n.useEffect)((()=>(s(),window.addEventListener("storage",s),()=>window.removeEventListener("storage",s))),[s]),null}function He(){return Object(n.useEffect)((()=>document.title="404 Not Found | Social App"),[]),Object(k.jsx)("section",{className:"error-404",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"error-404__wrapper",children:[Object(k.jsx)("p",{className:"error-404__number",children:"404"}),Object(k.jsx)("h2",{className:"error-404__title",children:"Not Found"}),Object(k.jsx)("p",{className:"error-404__text",children:"The requested page was not found on our server. It may have been removed."})]})})})}function Ye({communitiesInfo:e=[],renderSubscribeButton:t=!0}){const s=Object(a.b)(),n=Object(S.useHistory)(),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),i=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.communities)||void 0===s?void 0:s.subscribed}));return e.length?Object(k.jsx)("div",{className:"communities-list",children:e.map((e=>Object(k.jsx)("div",{className:"communities-list__item",children:Object(k.jsx)(be,{bottomText:H("subscriber",e.subscriberCount||0),childrenBottom:Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("p",{className:"communities-list__item-description",children:e.deleted?"This community has been deleted.":e.shortDescription||"No description provided."}),t&&Object(k.jsx)(re,{preset:(null===i||void 0===i?void 0:i["community"+e.id])?"remove":"primary",text:(null===i||void 0===i?void 0:i["community"+e.id])?"Unsubscribe":"Subscribe",onClick:()=>X(e.id,n,c,!!(null===i||void 0===i?void 0:i["community"+e.id]))})]}),community:!!e.id,userInfo:{...e,lastName:"",name:e.title},children:!e.deleted&&Object(k.jsxs)(de,{bookmarkType:"community",itemId:e.id,children:[Object(k.jsx)(re,{text:"Report",onClick:()=>!c&&n.push("/")}),o&&Object(k.jsx)(re,{text:"Delete community",onClick:()=>{return t=e.id,n=e.subscriberCount,void s(r("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this community?",irreversible:!0,password:!0,callback:()=>W(t,n)}}));var t,n}})]})})},e.id)))}):null}function Ge({button:e,requestDate:t,singleUser:s,users:n}){const o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),a=s=>Object(k.jsx)("div",{className:"users-list__item",children:Object(k.jsx)(be,{bottomText:t?Y(t):K(s),childrenBottom:Object(k.jsxs)(k.Fragment,{children:["bookmarks"===e&&!t&&Object(k.jsx)(re,{text:"Remove from bookmarks",onClick:()=>q(`users/user${o}/bookmarks/users/user${s.info.id}`).remove()}),t&&Object(k.jsx)(re,{text:"Accept friend request",onClick:()=>Q({reqUserId:s.info.id,userId:o})})]}),userInfo:s.info})},s.info.id);return s?a(s):Object(k.jsx)("div",{className:"users-list",children:n.map((e=>a(e)))})}const Ve=Object(n.createContext)(null);function Qe(e){const{loadItem:t,opts:s}=Object(n.useContext)(Ve),o=Object(n.useRef)(),a=Object(n.useRef)(),c=Object(n.useRef)(!1),[i,r]=Object(n.useState)({src:"#",alt:""}),l=Object(n.useCallback)((()=>{window.removeEventListener("load",d),window.removeEventListener("resize",d),window.removeEventListener("scroll",d),clearInterval(o.current)}),[]),d=Object(n.useCallback)((()=>{if(!a.current)return;const t=a.current,n=t.getBoundingClientRect().top+window.pageYOffset+s.scrollOffset-window.innerHeight;window.pageYOffset>=n&&t.offsetParent&&"hidden"!==getComputedStyle(t).visibility&&(c.current=!0,r({src:e.src,alt:e.alt||""}),l())}),[l,s.scrollOffset,e.alt,e.src]);return Object(n.useEffect)((()=>(c.current||(d(),window.addEventListener("load",d),window.addEventListener("resize",d),window.addEventListener("scroll",d),s.autoCheck&&(o.current=setInterval(d,s.autoCheckInterval))),l)),[l,d,s.autoCheck,s.autoCheckInterval]),Object(k.jsx)("img",{ref:a,...e,...i,onLoad:t})}var Je=function({opts:e={},tag:t="div",...s}){const o=t,a="string"===typeof e.animationClass?" "+e.animationClass:" lazy-animation";e.autoCheck="boolean"!==typeof e.autoCheck||e.autoCheck,e.autoCheckInterval=Number.isInteger(e.autoCheckInterval)?e.autoCheckInterval:2e3,e.scrollOffset=Number.isInteger(e.scrollOffset)?e.scrollOffset:0;const[c,i]=Object(n.useState)(!1),r=Object(n.useCallback)((()=>i(!0)),[]);return Object(k.jsx)(Ve.Provider,{value:{loadItem:r,opts:e},children:Object(k.jsx)(o,{...s,className:s.className+(c?"":a)})})};function We({author:e,content:t,lazyLoadEnabled:s,linkStopPropagation:o,msgIndex:i,renderReplyToAuthorText:l}){const d=Object(a.b)(),u=t.filter((e=>"img"===e.type)).map((t=>Object.values({...e.photos}).find((e=>e.id===t.value)))),m=u.filter((e=>e));return Object(k.jsx)("div",{className:"user-message",children:t.map(((t,a)=>{var b;return Object(k.jsx)(n.Fragment,{children:"text"===t.type?l?l(t,!0):Object(k.jsx)("p",{className:"user-message__text user-message__item",children:t.value}):Object(k.jsxs)(k.Fragment,{children:[l&&0===a&&l(t),u.find((e=>(null===e||void 0===e?void 0:e.id)===t.value))?!s||i<4?Object(k.jsx)(c.b,{className:"user-message__img-container user-message__item",to:"#javascript",onClick:s=>{d(r("gallery",{gallery:{author:e,content:m,initialSlide:m.indexOf(m.find((e=>e.id===t.value)))}})),s.preventDefault(),o&&s.stopPropagation()},children:Object(k.jsx)("img",{className:"user-message__img",src:null===(b=u.find((e=>(null===e||void 0===e?void 0:e.id)===t.value)))||void 0===b?void 0:b.src,alt:""})}):Object(k.jsx)(Je,{opts:{scrollOffset:-1e3},tag:c.b,className:"user-message__img-container user-message__item",to:"#javascript",onClick:s=>{d(r("gallery",{gallery:{author:e,content:u,initialSlide:u.indexOf(u.find((e=>e.id===t.value)))}})),s.preventDefault()},children:Object(k.jsx)(Qe,{className:"user-message__img",src:u.find((e=>e.id===t.value)).src,alt:""})}):Object(k.jsx)("p",{className:"user-message__deleted-photo user-message__item",children:"Deleted photo"})]})},a)}))})}function Ke({post:e}){const{hash:t}=Object(S.useLocation)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info.avatar})),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),a=Object(n.useRef)(null),[c,i]=Object(n.useState)(null),[r,l]=Object(n.useState)();Object(n.useEffect)((()=>{"#comments"===t&&setTimeout((()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.scrollIntoView({behavior:"auto",block:"start"})}),0)}),[t]);const d=(t,s)=>n=>{const a=q().newKey(),c=t?`/${t}/replies`:"";return q(`posts/post${e.id}/comments${c}/${a}`).set({authorId:o,content:n,date:P,id:a,replyTo:s||null}).then((()=>i(null)))},u=Object.values({...e.comments}).sort(((e,t)=>t.date-e.date));return Object(k.jsx)("div",{ref:a,className:"post__comments-container",children:Object(k.jsxs)("div",{className:"post__comments",children:[Object(k.jsx)("div",{className:"post__comments-title",children:`Comments (${u.length})`}),Object(k.jsx)("div",{className:"post__comments-wrapper",children:u.map((t=>Object(k.jsx)(Ze,{comment:t,postId:e.id,replyComment:c,selectedReply:r,setReplyComment:i,setSelectedReply:l,uploadCallback:d},t.id)))}),o&&Object(k.jsx)(ue,{avatar:s,buttonText:"Comment",inputPlaceholder:"Leave a comment",uploadCallback:d(),userId:o})]})})}function Ze({comment:e,postId:t,replyComment:s,selectedReply:o,setReplyComment:i,setSelectedReply:l,uploadCallback:d}){const u=Object(a.b)(),m=Object(S.useHistory)(),b=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),j=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info.avatar})),f=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[h,p]=Object(n.useState)(),[v,O]=Object(n.useState)([]),[x,_]=Object(n.useState)([]);Object(n.useEffect)((()=>{const t=Object.values({...e.replies});O(t)}),[e.replies]),Object(n.useEffect)((()=>{const t=B({fields:["info","photos"],userId:e.authorId,callback:e=>p(e)}),s=[],n=[];return v.forEach(((e,t)=>{s.push(B({fields:["info","photos"],userId:e.authorId,callback:e=>{n[t]=e,n.length!==v.length||n.includes(void 0)||_([...n])}}))})),()=>{t(),s.forEach((e=>e()))}}),[e.authorId,v]);const g=({replies:n,replyLikes:a,replyTo:p,tempAuthor:O,tempComment:_})=>Object(k.jsxs)("div",{className:"post__comment",children:[Object(k.jsx)(ce,{src:O.info.avatar,userId:O.info.id}),Object(k.jsxs)("div",{className:"post__comment-wrapper"+(_.id===o?" post__comment-wrapper--selected":""),children:[Object(k.jsx)(ae,{text:Y(_.date),userInfo:O.info}),Object(k.jsx)(We,{author:O,content:_.content,renderReplyToAuthorText:(e,t)=>{var s;return Object(k.jsxs)("p",{className:"user-message__text user-message__item",children:[p&&Object(k.jsxs)(c.b,{className:"user-message__reply-to",to:"/id"+p.info.id,children:[Object(k.jsx)("span",{className:"user-message__reply-to-name",children:null===(s=x.find((e=>{var t;return e.info.id===(null===(t=v.find((e=>e.id===_.replyTo)))||void 0===t?void 0:t.authorId)})))||void 0===s?void 0:s.info.name}),", "]}),t&&e.value]})}}),Object(k.jsxs)("div",{className:"post__comment-footer",children:[Object(k.jsxs)("button",{className:"post__comment-footer-button",onClick:(s,o=!n&&_.id)=>Z({condition:!!(a||N).find((e=>e.userId===f)),contentId:e.id,contentPath:`posts/post${t}/comments/${e.id}${o?`/replies/${o}`:""}`,history:m,userId:f,userPath:`comments/post${t}/${o?`reply${o}`:`comment${e.id}`}`}),children:[Object(k.jsx)("i",{className:"post__comment-footer-button-icon"+((a||N).find((e=>e.userId===f))?" fas fa-heart":" far fa-heart")}),Object(k.jsx)("p",{className:"post__comment-footer-button-text",children:(a||N).length||0})]}),Object(k.jsxs)("button",{className:"post__comment-footer-button",onClick:()=>{return t=_,void(f?i({author:x.find((e=>e.info.id===t.authorId))||h,commentId:e.id,reply:t}):m.push("/"));var t},children:[Object(k.jsx)("i",{className:"post__comment-footer-button-icon fas fa-reply"}),Object(k.jsx)("p",{className:"post__comment-footer-button-text",children:"reply"})]}),(O.info.id===f||b)&&Object(k.jsxs)("button",{className:"post__comment-footer-delete-button",onClick:()=>{return s=n?"":_.id,void u(r("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this comment?",irreversible:!0,callback:q(`posts/post${t}/comments/${e.id}`+(s?`/replies/${s}`:"")).remove}}));var s},children:[Object(k.jsx)("i",{className:"post__comment-footer-delete-button-icon fas fa-trash-alt"}),Object(k.jsx)("p",{className:"post__comment-footer-delete-button-text",children:"Delete"})]})]}),(null===n||void 0===n?void 0:n.length)>0&&Object(k.jsx)("div",{className:"post__comment-replies",children:n}),(null===s||void 0===s?void 0:s.commentId)===e.id&&n&&Object(k.jsx)(ue,{avatar:j,buttonText:"Reply",inputPlaceholder:"Leave a comment",uploadCallback:d(e.id,s.reply.id),userId:f,children:Object(k.jsxs)("button",{className:"post-msg__form-reply-to",type:"button",onClick:()=>{return e=s.reply.id,l(e),void setTimeout((()=>l(null)),0);var e},children:[Object(k.jsx)("p",{className:"post-msg__form-reply-to-text",children:`reply to ${s.author.info.name} ${s.author.info.lastName}`}),Object(k.jsx)("i",{className:"post-msg__form-reply-to-icon fas fa-level-up-alt"})]})})]})]},_.id),N=Object.values({...e.likes}),w=[];return v.forEach((e=>w.push(Object.values({...e.likes})))),h?g({tempAuthor:h,tempComment:e,replies:v.map(((e,t)=>x[t]&&g({tempAuthor:x[t],tempComment:e,replyTo:x.find((t=>{var s;return t.info.id===(null===(s=v.find((t=>t.id===e.replyTo)))||void 0===s?void 0:s.authorId)})),replyLikes:w[t]})))}):null}function Xe({fetchedItems:e,index:t=0,loadingCallback:s,post:o,renderComments:i}){var l;const d=Object(a.b)(),u=Object(S.useHistory)(),m=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),b=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),j=Object(n.useRef)(null),[f,h]=Object(n.useState)();Object(n.useEffect)((()=>B({community:!!o.communityId,fields:["info","photos"],userId:o.authorId||o.communityId,callback:t=>{o.communityId&&(t.info.lastName="",t.info.name=t.info.title),h(t),e.current.incrementQty(o.id,s)}})),[e,s,o.authorId,o.communityId,o.id]);const p=null===(l=o.views)||void 0===l?void 0:l["user"+b];if(Object(n.useEffect)((()=>{if(!(null===f||void 0===f?void 0:f.info.id)||!b||p)return;let e;const t=new IntersectionObserver((([t])=>{t.isIntersecting?e=setTimeout((()=>q(`posts/post${o.id}/views/user${b}`).set({date:P,userId:b})),5e3):clearInterval(e)}),{threshold:.5});return t.observe(j.current),()=>{t.disconnect(),clearTimeout(e)}}),[o.id,null===f||void 0===f?void 0:f.info.id,p,b]),!f)return null;const v=Object.values({...o.likes}),O=Object.values({...o.comments});return Object(k.jsxs)("article",{className:"post",ref:j,children:[Object(k.jsxs)("div",{className:"post__main",children:[Object(k.jsx)(be,{bottomText:Y(o.date),bottomTextLink:"/post"+o.id,community:!!o.communityId,userInfo:f.info,children:Object(k.jsx)(de,{bookmarkType:"post",itemId:o.id,children:(f.info.id===b||f.info.creatorId===b||m)&&Object(k.jsx)(re,{text:"Delete post",onClick:function(){d(r("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this post?",irreversible:!0,callback:q("posts/post"+o.id).remove}}))}})})}),Object(k.jsx)(We,{author:f,content:o.content,lazyLoadEnabled:!0,msgIndex:t}),Object(k.jsxs)("div",{className:"post__footer",children:[Object(k.jsxs)("div",{className:"post__footer-left",children:[Object(k.jsxs)("button",{className:"post__footer-button post__footer-item",onClick:()=>Z({condition:!!v.find((e=>e.userId===b)),contentId:o.id,contentPath:`posts/post${o.id}`,history:u,userId:b,userPath:`posts/post${o.id}`}),children:[Object(k.jsx)("i",{className:"post__footer-button-icon"+(v.find((e=>e.userId===b))?" fas fa-heart":" far fa-heart")}),Object(k.jsx)("p",{className:"post__footer-button-text",children:v.length})]}),Object(k.jsxs)(c.b,{className:"post__footer-button post__footer-item",to:`/post${o.id}#comments`,children:[Object(k.jsx)("i",{className:"post__footer-button-icon far fa-comment"}),Object(k.jsx)("p",{className:"post__footer-button-text",children:O.length})]}),Object(k.jsxs)("button",{className:"post__footer-button post__footer-item",children:[Object(k.jsx)("i",{className:"post__footer-button-icon far fa-share-square"}),Object(k.jsx)("p",{className:"post__footer-button-text",children:o.shares})]})]}),Object(k.jsx)("div",{className:"post__footer-right",children:Object(k.jsxs)("div",{className:"post__footer-item",children:[Object(k.jsx)("i",{className:"post__footer-button-icon fas fa-eye"}),Object(k.jsx)("p",{className:"post__footer-button-text",children:Object.values({...o.views}).length})]})})]})]}),i&&Object(k.jsx)(Ke,{post:o})]})}function et(){var e;const t=Object(S.useHistory)(),{search:s}=Object(S.useLocation)(),o=new URLSearchParams(s).get("tab"),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.bookmarks})),i=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),r=["users","communities"].find((e=>e===o))||"posts",l=Object(n.useRef)(),[d,u]=Object(n.useState)([]),{fetchedItems:m,finishLoading:b}=R(),j=Object(n.useCallback)((()=>b("Bookmarks")),[b]);Object(n.useEffect)((()=>{if(void 0===i&&t.replace("/"),!i)return;const e=Object.values({...null===a||void 0===a?void 0:a[r]});e.sort(((e,t)=>t.date-e.date)),e.length||(j(),u([]));const s=[],n=[],o=(t,s,o)=>{n[o]=t||{id:s.id,unavailable:!0},t||m.current.incrementQty(s.id,j),n.length!==e.length||n.includes(void 0)||(u([...n]),["users","communities"].includes(r)?j():m.current.setExpected(n.length,j))};return e.forEach(((e,t)=>{"users"===r?s.push(B({fields:["connections","info"],userId:e.id,callback:s=>o(s,e,t)})):s.push(q(("communities"===r?"communities/community":"posts/post")+e.id).on((s=>o(s,e,t))))})),()=>s.forEach((e=>e()))}),[r,m,t,j,a,i]),Object(n.useEffect)((()=>l.current=r),[r]);const f=d.filter((e=>!e.unavailable)),h=null===(e=d.filter((e=>e.unavailable)))||void 0===e?void 0:e.length;return Object(k.jsxs)("section",{className:"bookmarks",children:[Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"bookmarks__wrapper",children:[Object(k.jsxs)("div",{className:"bookmarks__header",children:[Object(k.jsx)("h1",{className:"bookmarks__header-title",children:`${r} bookmarks (${d.length})`}),h>0&&Object(k.jsxs)("p",{className:"bookmarks__header-unavailable",children:[h+" unavailable item(s) are hidden ",Object(k.jsx)("button",{className:"bookmarks__header-unavailable-remove",onClick:function(){const e="communities"===r?"community":r.slice(0,-1);d.forEach((t=>t.unavailable&&q(`users/user${i}/bookmarks/${r}/${e+t.id}`).remove()))},children:"(Remove)."})]})]}),Object(k.jsx)("div",{className:"bookmarks__content",children:r===l.current&&("posts"===r?f.map(((e,t)=>Object(k.jsx)(Xe,{fetchedItems:m,index:t,loadingCallback:j,post:e},e.id))):"users"===r?Object(k.jsx)(Ge,{button:"bookmarks",users:f}):Object(k.jsx)(Ye,{communitiesInfo:f.map((e=>e.info))}))})]})}),Object(k.jsx)("aside",{className:"sidebar",children:Object(k.jsxs)("div",{className:"sidebar__wrapper",children:[Object(k.jsx)(c.b,{className:"sidebar__button"+("posts"===r?" sidebar__button--active":""),to:"/bookmarks",children:`Posts (${Object.values({...null===a||void 0===a?void 0:a.posts}).length})`}),Object(k.jsx)(c.b,{className:"sidebar__button"+("users"===r?" sidebar__button--active":""),to:"?tab=users",children:`Users (${Object.values({...null===a||void 0===a?void 0:a.users}).length})`}),Object(k.jsx)(c.b,{className:"sidebar__button"+("communities"===r?" sidebar__button--active":""),to:"?tab=communities",children:`Communities (${Object.values({...null===a||void 0===a?void 0:a.communities}).length})`})]})})]})}function tt(){const e=Object(a.b)(),t=Object(S.useHistory)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[c,i]=Object(n.useState)(),[l,d]=Object(n.useState)(),[u,m]=Object(n.useState)(),{finishLoading:b}=R();return Object(n.useEffect)((()=>{if(null!==s)return q("communities").on((e=>{b("Communities");const t=Object.values({...e}),n=t.filter((e=>e.info.creatorId!==s));Object(o.unstable_batchedUpdates)((()=>{i(t.filter((e=>e.info.creatorId===s))),d(n.filter((e=>{var t;return!(null===(t=e.subscribers)||void 0===t?void 0:t["user"+s])&&!e.info.deleted}))),m(n.filter((e=>{var t;return null===(t=e.subscribers)||void 0===t?void 0:t["user"+s]})))}))}))}),[b,s]),l?Object(k.jsx)("section",{className:"communities",children:Object(k.jsxs)("div",{className:"content-width",children:[Object(k.jsxs)("div",{className:"communities__header",children:[Object(k.jsx)("h1",{className:"communities__title",children:"Communities"}),Object(k.jsx)(re,{text:"Create new community",onClick:()=>s?e(r("create-community")):t.push("/")})]}),c.length>0&&Object(k.jsxs)("div",{className:"communities__item",children:[Object(k.jsx)("div",{className:"communities__item-header",children:Object(k.jsx)("h2",{className:"communities__item-title",children:`My communities (${c.length})`})}),Object(k.jsx)("div",{className:"communities__item-content",children:Object(k.jsx)(Ye,{communitiesInfo:c.map((e=>e.info)),renderSubscribeButton:!1})})]}),u.length>0&&Object(k.jsxs)("div",{className:"communities__item",children:[Object(k.jsx)("div",{className:"communities__item-header",children:Object(k.jsx)("h2",{className:"communities__item-title",children:`Subscribed (${u.length})`})}),Object(k.jsx)("div",{className:"communities__item-content",children:Object(k.jsx)(Ye,{communitiesInfo:u.map((e=>e.info))})})]}),l.length>0&&Object(k.jsxs)("div",{className:"communities__item",children:[Object(k.jsx)("div",{className:"communities__item-header",children:Object(k.jsx)("h2",{className:"communities__item-title",children:`Explore (${l.length})`})}),Object(k.jsx)("div",{className:"communities__item-content",children:Object(k.jsx)(Ye,{communitiesInfo:l.map((e=>e.info))})})]})]})}):null}function st(){var e,t,s,o,i,l,d;const u=Object(a.b)(),m=Object(S.useHistory)(),{communityId:b}=Object(S.useParams)(),j=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),f=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{AsyncButton:h,buttonLoading:p,setButtonLoading:v}=A(),{addImgPreview:O,imgPreview:x,setImgPreview:_}=D(!1),g=Object(n.useRef)(),[N,w]=Object(n.useState)(),[I,C]=Object(n.useState)(),[$,E]=Object(n.useState)(!1),[L,P]=Object(n.useState)(),[T,M]=Object(n.useState)(!1),{fetchedItems:F,finishLoading:z,loaded:U,setTitle:Y}=R(),G=Object(n.useCallback)((()=>z(N.info.title)),[N,z]);if(Object(n.useEffect)((()=>{if(null===f)return;let e,t;const s=q("communities/community"+b).on((s=>{if(g.current=[],null===s||void 0===s?void 0:s.profilePhotos){for(const e in s.profilePhotos){var n;(null===(n=s.photos)||void 0===n?void 0:n[e])&&g.current.push(s.photos[e])}g.current.sort(((e,t)=>t.date-e.date))}w(s),s?((t=>{var s;t.info.deleted||(null===(s=e)||void 0===s||s(),e=B({userId:t.info.creatorId,callback:e=>C([e.info])}))})(s),(()=>{var e;null===(e=t)||void 0===e||e(),t=q("posts").orderByChild("communityId").equalTo(b).on((e=>{const t=Object.values({...e});P(t.sort(((e,t)=>+t.id-+e.id))),F.current.setExpected(t.length)}))})()):z()}));return()=>{var n;s(),null===(n=e)||void 0===n||n(),t()}}),[b,F,z,f]),Object(n.useEffect)((()=>{U.current&&N?Y(N.info.title):L?G():null!==L&&null!==N||z()}),[N,z,U,G,L,Y]),void 0===N)return null;if(!N)return Object(k.jsx)(He,{});const V=!!(null===(e=N.subscribers)||void 0===e?void 0:e["user"+f]);return Object(k.jsxs)("section",{className:"community",children:[Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"community__content",children:[Object(k.jsxs)("div",{className:"community__header",children:[f!==N.info.creatorId&&!j||N.info.deleted?(null===(i=N.fullInfo)||void 0===i?void 0:i.banner)&&Object(k.jsx)("div",{className:"community__banner",children:Object(k.jsx)("img",{className:"community__banner-img",src:null===(l=N.fullInfo)||void 0===l?void 0:l.banner.src,alt:""})}):x[0]?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"community__banner",children:Object(k.jsx)("img",{className:"community__banner-img",src:x[0].result,alt:""})}),Object(k.jsxs)("div",{className:"community__header-buttons",children:[Object(k.jsx)(h,{text:"Confirm banner",onClick:function(){p||(v(),ne({callback:()=>{v(!1),_([])},communityId:b,createId:!1,file:x[0].file,imgParent:"fullInfo",imgPath:"banner",storagePrefix:"community"+b}))}}),!p&&Object(k.jsx)(re,{preset:"secondary",text:"Cancel",onClick:()=>_([])})]})]}):Object(k.jsxs)("label",{className:"modal-change-avatar__upload",htmlFor:"community__banner-overlay-input",children:[Object(k.jsxs)("button",{className:"community__banner-button community__banner",onClick:e=>{var t;return null===(t=e.target.closest("label"))||void 0===t?void 0:t.click()},children:[(null===(t=N.fullInfo)||void 0===t?void 0:t.banner)?Object(k.jsx)("img",{className:"community__banner-img",src:null===(s=N.fullInfo)||void 0===s?void 0:s.banner.src,alt:""}):Object(k.jsx)("p",{className:"community__banner-placeholder",children:"No banner"}),Object(k.jsxs)("div",{className:"community__banner-overlay",children:[Object(k.jsx)("i",{className:"community__banner-overlay-icon far fa-image"}),Object(k.jsx)("p",{className:"community__banner-overlay-text",children:((null===(o=N.fullInfo)||void 0===o?void 0:o.banner)?"Change":"Set")+" banner"})]})]}),Object(k.jsx)("input",{className:"community__banner-overlay-input",id:"community__banner-overlay-input",type:"file",accept:".jpg, .jpeg, .png",hidden:!0,onChange:O})]}),Object(k.jsxs)("div",{className:"community__info",children:[Object(k.jsxs)("div",{className:"community__info-content",children:[Object(k.jsx)(ie,{avatar:g.current.find((e=>e.src===N.info.avatar)),user:{info:{...N.info,lastName:"",name:N.info.title}}}),Object(k.jsxs)("div",{className:"community__info-text",children:[Object(k.jsx)(le,{className:"community-title",databaseRef:`communities/community${b}/info/title`,disabled:N.info.deleted,field:N.info.title,ownerId:N.info.creatorId,renderInputId:"title"}),Object(k.jsx)("p",{className:"community__info-subscribers",children:H("subscriber",N.info.subscriberCount||0)}),$&&Object(k.jsx)("div",{className:"community__info-contacts-container",children:Object(k.jsx)("div",{className:"community__contacts",children:null===I||void 0===I?void 0:I.map((e=>Object(k.jsx)(be,{avatarSize:"small",bottomText:"Creator",userInfo:e},e.id)))})}),!N.info.deleted&&Object(k.jsx)("button",{className:"community__toggle",onClick:()=>E(!$),children:($?"Hide":"Show")+" contacts"})]})]}),Object(k.jsx)(re,{className:"community-subscribe",preset:V?"remove":"primary",text:V?"Unsubscribe":"Subscribe",onClick:()=>X(b,m,f,V)})]})]}),Object(k.jsxs)("div",{className:"community__description",children:[Object(k.jsx)("h3",{className:"community__description-title",children:"Description"}),Object(k.jsxs)("div",{className:"community__description-wrapper",children:[Object(k.jsx)(le,{databaseRef:`communities/community${b}/fullInfo/description`,disabled:N.info.deleted,emptyButtonText:"Set description",emptyFieldText:"No description provided.",field:N.info.deleted?"This community has been deleted.":null===(d=N.fullInfo)||void 0===d?void 0:d.description,ownerId:N.info.creatorId,renderInputId:"description"}),T&&Object(k.jsxs)("div",{className:"community__description-short",children:[Object(k.jsx)("h4",{className:"community__description-short-title",children:"Short description:"}),Object(k.jsx)(le,{databaseRef:`communities/community${b}/info/shortDescription`,disabled:N.info.deleted,emptyButtonText:"Set short description",emptyFieldText:"No description provided.",field:N.info.deleted?"This community has been deleted.":N.info.shortDescription,ownerId:N.info.creatorId,renderInputId:"shortDescription"})]}),(f===N.info.creatorId||j)&&!N.info.deleted&&Object(k.jsx)("button",{className:"community__toggle",onClick:()=>M(!T),children:(T?"Hide":"Show")+" short description"})]})]}),f===N.info.creatorId&&!N.info.deleted&&Object(k.jsx)(ue,{addToPhotosButton:!0,avatar:N.info.avatar,community:!!b,userId:b}),!N.info.deleted&&Object(k.jsxs)("div",{className:"community__posts",children:[Object(k.jsx)("div",{className:"community__posts-header",children:Object(k.jsx)(c.b,{className:"community__posts-title",to:"#todo",children:"Posts"})}),null===L||void 0===L?void 0:L.map(((e,t)=>Object(k.jsx)(Xe,{fetchedItems:F,index:t,loadingCallback:G,post:e},e.id)))]})]})}),!N.info.deleted&&Object(k.jsxs)("aside",{className:"community__sidebar sidebar",children:[Object(k.jsx)("h3",{className:"community__sidebar-title",children:`Contacts (${null===I||void 0===I?void 0:I.length})`}),Object(k.jsx)("div",{className:"community__sidebar-content",children:Object(k.jsx)("div",{className:"community__contacts",children:null===I||void 0===I?void 0:I.map((e=>Object(k.jsx)(be,{avatarSize:"small",bottomText:"Creator",userInfo:e},e.id)))})}),(f===N.info.creatorId||j)&&Object(k.jsxs)("div",{className:"community__sidebar-buttons",children:[Object(k.jsx)(re,{text:"Change avatar",onClick:()=>u(r("change-avatar",{changeAvatarCommunityId:b}))}),Object(k.jsx)(re,{preset:"remove",text:"Delete community",onClick:function(){u(r("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this community?",irreversible:!0,password:!0,callback:()=>W(b,N.info.subscriberCount)}}))}})]})]})]})}function nt(){const e=Object(a.b)(),t=Object(S.useHistory)(),{search:s}=Object(S.useLocation)(),c=new URLSearchParams(s).get("interlocutor"),{conversationId:i}=Object(S.useParams)(),l=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info.avatar})),d=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),u=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info})),m=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.photos})),[b,j]=Object(n.useState)(null),[f,h]=Object(n.useState)(null),[p,v]=Object(n.useState)(),[O,x]=Object(n.useState)([]),_=Object(n.useRef)(),g=Object(n.useRef)(),{finishLoading:N,loaded:w}=R(),I=Object(n.useCallback)((()=>{j(null),h(null),v([]),w.current||N()}),[N,w]),C=Object(n.useCallback)((e=>{d&&(g.current=B({fields:["connections","info","photos"],userId:e.participants.find((e=>e!==d)),callback:t=>{w.current||N(e.participants.includes(d)?"Conversation":null),Object(o.unstable_batchedUpdates)((()=>{j(e),h(t),v([{info:u,photos:m},t])}))}}))}),[N,w,d,u,m]);Object(n.useEffect)((()=>{if(!i&&c&&d){if(d!==c)return q("conversations/").once((e=>{const s=Object.values(e);for(const n of s)if(n.participants.includes(d)&&n.participants.includes(c))return void t.replace("/conversation"+n.id);C({id:"0",messages:[],nextMessageId:"1",participants:[d,c]})})),()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.call(g)};I()}}),[i,C,t,I,c,d]),Object(n.useEffect)((()=>{if(!i||!d)return;const e=q("conversations/conversation"+i).on((e=>{e&&e.participants.includes(d)?(e.messages=Object.values({...e.messages}).sort(((e,t)=>+e.id-+t.id)),C(e)):I()}));return()=>{var t;e(),null===(t=g.current)||void 0===t||t.call(g)}}),[i,C,I,d]),Object(n.useEffect)((()=>{i||c||I()}),[i,I,c]);const $=Object(n.useCallback)((()=>!(void 0===d||!p||!f||!(null===b||void 0===b?void 0:b.participants.includes(d)))),[null===b||void 0===b?void 0:b.participants,f,p,d]);function E(e){if(O.find((t=>t.id===e.id))){const t=[...O];t.splice(O.indexOf(e),1),x(t)}else x([...O,e])}return Object(n.useEffect)((()=>{void 0===d&&t.push("/")}),[t,d]),Object(n.useEffect)((()=>{_.current&&setTimeout((()=>{window.innerHeight<_.current.offsetHeight&&window.scrollTo(0,_.current.offsetHeight)}),0)}),[null===b||void 0===b?void 0:b.id]),p?$()?Object(k.jsx)("section",{className:"conversation",ref:_,children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"conversation__wrapper",children:[Object(k.jsx)("div",{className:"conversation__header",children:Object(k.jsxs)("div",{className:"conversation__header-wrapper",children:[Object(k.jsxs)("div",{className:"conversation__header-interlocutor",children:[Object(k.jsx)(ce,{size:"small",src:f.info.avatar,userId:f.info.id}),Object(k.jsx)(ae,{text:K(f),userInfo:f.info})]}),O.length>0&&Object(k.jsxs)("div",{className:"conversation__header-overlay",children:[Object(k.jsxs)("button",{className:"conversation__header-overlay-qty",onClick:()=>x([]),children:[Object(k.jsx)("i",{className:"conversation__header-overlay-qty-icon",children:"\xd7"}),H("message",O.length)]}),Object(k.jsx)("div",{className:"conversation__header-overlay-buttons",children:Object(k.jsx)(re,{afterIconClass:"fas fa-trash-alt",preset:"remove",text:"Delete forever",onClick:function(){O.find((e=>e.authorId!==d))?e(r("action-error",{actionError:"You can't delete someone else's messages. Try to select only your own messages and try again."})):e(r("action-confirm",{actionConfirm:{text:`Are you sure you want to delete ${H("message",O.length)}?`,irreversible:!0,callback:()=>{x([]),q().update(O.reduce(((e,t)=>(e[`conversations/conversation${i}/messages/message${t.id}`]=null,e)),{}))}}}))}})})]})]})}),Object(k.jsx)("div",{className:"conversation__content",children:b.messages.map(((e,t)=>Object(k.jsx)(ot,{index:t,message:e,participants:p,previousMessage:b.messages[t-1],selectedMessages:O,selectMessage:E},e.id)))}),Object(k.jsx)("div",{className:"conversation__footer",children:Object(k.jsx)("div",{className:"conversation__footer-wrapper",children:Object(k.jsx)(ue,{avatar:l,buttonText:"Message",inputPlaceholder:"Your message",uploadCallback:function(e){return new Promise((s=>{function n(t){const n={authorId:d,content:e,date:P,id:b.nextMessageId},o=`conversations/conversation${t}/`;q().update({[o+"lastMessage"]:n,[o+"messages/message"+b.nextMessageId]:n,[o+"nextMessageId"]:`${parseInt(b.nextMessageId,10)+1}`}).then((()=>{s(),window.innerHeight<_.current.offsetHeight&&window.scrollTo(0,_.current.offsetHeight)}))}b.id&&"0"!==b.id?n(i):q("contentData/nextConversationId").once((e=>{q().update({["conversations/conversation"+e]:{id:e,participants:p.map((e=>e.info.id))},"contentData/nextConversationId":`${parseInt(e,10)+1}`}),n(e),t.replace("/conversation"+e)}))}))},userId:d})})})]})})}):Object(k.jsx)(He,{}):null}function ot({index:e,message:t,participants:s,previousMessage:n,selectedMessages:o,selectMessage:a}){const c=s.find((e=>e.info.id===t.authorId)),i=0===e||t.authorId!==n.authorId||t.date>n.date+3e5;return Object(k.jsxs)("button",{className:"conversation__message"+(o.find((e=>e.id===t.id))?" conversation__message--selected":""),onClick:()=>a(t),children:[i&&Object(k.jsx)(ce,{size:"small",src:s.find((e=>e.info.id===t.authorId)).info.avatar,userId:t.authorId,onClick:e=>e.stopPropagation()}),Object(k.jsxs)("div",{className:"conversation__message-wrapper",children:[i&&Object(k.jsx)(ae,{onlyName:!0,text:Y(t.date),userInfo:s.find((e=>e.info.id===t.authorId)).info,onClick:e=>e.stopPropagation()}),Object(k.jsx)(We,{author:c,content:t.content,linkStopPropagation:!0})]})]})}function at(){const{search:e}=Object(S.useLocation)(),{ownerId:t}=Object(S.useParams)(),s=new URLSearchParams(e).get("tab"),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.friendRequests})),[i,r]=Object(n.useState)(),[l,d]=Object(n.useState)(!1),u=Object(n.useRef)(""),{fetchedItems:m,finishLoading:b,loaded:j,setTitle:f}=R(),h=Object(n.useCallback)((()=>b(u.current)),[b]);if(Object(n.useEffect)((()=>{if(null!==o)return B({fields:["friends","info"],userId:t||o,callback:e=>r(e)})}),[m,t,o]),Object(n.useEffect)((()=>{(null===i||void 0===i?void 0:i.info.id)?(u.current=i.info.id===o?"requests"===s?"My friend requests":"My friends":`${i.info.name} ${i.info.lastName}'s friends`,j.current&&f(u.current),l||d(!0),m.current.setExpected(Object.keys("requests"===s?{...null===a||void 0===a?void 0:a.received}:{...i.friends}).length,h)):null===i&&(d(!0),b())}),[m,b,i,j,h,s,f,l,null===a||void 0===a?void 0:a.received,o]),!l)return null;if(!i)return Object(k.jsx)(He,{});const p=Object.values({...i.friends}),v=Object.values({...null===a||void 0===a?void 0:a.received}),O=i.info.id===o&&"requests"===s;return Object(k.jsxs)("section",{className:"friends",children:[Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"friends__wrapper",children:[Object(k.jsx)("div",{className:"friends__header",children:Object(k.jsx)(c.b,{className:"friends__title",to:"/id"+i.info.id,children:O?`Your friend requests (${v.length})`:(i.info.id!==o?`${i.info.name}'s`:"Your")+` friends (${p.length})`})}),(O?v:p).length>0&&Object(k.jsx)("div",{className:"users-list",children:(O?v:p).map((e=>Object(k.jsx)(ct,{fetchedItems:m,friendId:e.userId,friendRequestDate:O&&e.date,loadingCallback:h},e.userId)))})]})}),i.info.id===o&&Object(k.jsx)("aside",{className:"sidebar",children:Object(k.jsxs)("div",{className:"sidebar__wrapper",children:[Object(k.jsx)(c.b,{className:"sidebar__button"+("requests"!==s?" sidebar__button--active":""),to:"/friends",children:`Friends (${p.length})`}),Object(k.jsx)(c.b,{className:"sidebar__button"+("requests"===s?" sidebar__button--active":""),to:"?tab=requests",children:`Friend requests (${v.length})`})]})})]})}function ct({fetchedItems:e,friendId:t,friendRequestDate:s,loadingCallback:o}){const[a,c]=Object(n.useState)();return Object(n.useEffect)((()=>B({fields:["connections","info"],userId:t,callback:s=>{c(s),e.current.incrementQty(t,o)}})),[e,t,o]),a?Object(k.jsx)(Ge,{requestDate:s,singleUser:a}):null}let it;function rt(){const e=Object(a.b)(),t=Object(S.useHistory)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{formState:{errors:o},handleSubmit:i,register:l}=Object(C.a)(),{AsyncButton:d,buttonLoadingRef:u,setButtonLoading:m}=A(),[b,j]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{s?t.replace("/news"):void 0===s&&(document.title="Log in | Social App")}),[t,s]),void 0!==s?null:Object(k.jsx)("section",{className:"home",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"home__wrapper",children:[Object(k.jsxs)("div",{className:"home__info",children:[Object(k.jsx)("h1",{className:"home__info-title",children:"Social App"}),Object(k.jsx)("p",{className:"home__info-text",children:"Connect with your friends and communities on Social App."})]}),Object(k.jsxs)("div",{className:"home__content",children:[Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onChange:()=>m(!1),onSubmit:i((function(s){var n;u.current||(m(),null===(n=it)||void 0===n||n(),it=q("users").orderByChild("account/email").equalTo(s.email).on((n=>{if(it(),u.current){if(n){const o=Object.values(n)[0];(null===o||void 0===o?void 0:o.account.email)===s.email&&O(o.account.password)===s.password?(e(we(o)),e($e()),t.replace("/news")):j(!0)}else j(!0);m(!1)}})))})),children:[Object(k.jsx)(U,{autoFocus:!0,id:"home__form-email",onInput:()=>j(!1),opts:{obj:F.find((e=>"email"===e.id)),errors:o,label:!0,placeholder:!0,register:l}}),Object(k.jsx)(U,{id:"home__form-password",onInput:()=>j(!1),opts:{obj:F.find((e=>"existingPassword"===e.id)),errors:o,label:!0,placeholder:!0,register:l}}),b&&Object(k.jsx)("p",{className:"error-text",children:"Wrong email or password."}),Object(k.jsx)(d,{text:"Log in",type:"submit"})]}),Object(k.jsx)(c.b,{className:"home__content-forgot-password",to:"#todo",children:"Forgot password?"}),Object(k.jsx)("hr",{className:"home__content-hr"}),Object(k.jsx)(re,{preset:"secondary",text:"Sign up",onClick:()=>e(r("sign-up"))})]})]})})})}function lt(){const e=Object(S.useHistory)(),t=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[o,a]=Object(n.useState)(),{fetchedItems:c,finishLoading:i}=R(),r=Object(n.useCallback)((()=>i("Messages")),[i]);return Object(n.useEffect)((()=>{if(!s)return;return q("conversations/").on((e=>{const t=Object.values(e).filter((e=>e.participants.includes(s)));t.sort(((e,t)=>t.lastMessage.date-e.lastMessage.date)),a(t),c.current.setExpected(t.length,r)}))}),[c,r,s]),Object(n.useEffect)((()=>{void 0===s&&e.push("/")}),[e,s]),void 0!==s&&o?Object(k.jsx)("section",{className:"messages",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsx)("div",{className:"messages__wrapper",children:o.length?o.map((e=>Object(k.jsx)(dt,{conversation:e,fetchedItems:c,loadingCallback:r,userAvatar:t,userId:s},e.id))):Object(k.jsx)("p",{className:"no-content",children:"No messages"})})})}):null}function dt({conversation:e,fetchedItems:t,loadingCallback:s,userAvatar:o,userId:a}){const[c,i]=Object(n.useState)();return Object(n.useEffect)((()=>B({userId:e.participants.find((e=>e!==a)),callback:e=>{i(e.info),t.current.incrementQty(e.info.id,s)}})),[e.participants,t,s,a]),c?Object(k.jsx)("div",{className:"messages__item",children:Object(k.jsx)(be,{bottomText:e.lastMessage&&Y(e.lastMessage.date,!0),childrenBottom:e.messages?Object(k.jsxs)("div",{className:"messages__item-last-message",children:[Object(k.jsx)("img",{className:"avatar__img-small",src:e.lastMessage.authorId===a?o:c.avatar,alt:"Avatar"}),Object(k.jsx)("p",{className:"messages__item-last-message-content",children:"text"===e.lastMessage.content[0].type?e.lastMessage.content[0].value:"Photo"})]}):Object(k.jsx)("p",{className:"messages__item-no-messages",children:"No messages yet"}),userInfo:c,wrapperLink:"/conversation"+e.id})}):null}function ut(){const e=Object(S.useHistory)(),t=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[o,a]=Object(n.useState)([]),{fetchedItems:c,finishLoading:i}=R(),r=Object(n.useCallback)((()=>i("News")),[i]);return Object(n.useEffect)((()=>{if(void 0===s&&e.replace("/"),s)return q("posts/").on((e=>{const t=Object.values(e);a(t.sort(((e,t)=>+t.id-+e.id))),c.current.setExpected(t.length,r)}))}),[c,e,r,s]),s&&o.length?Object(k.jsx)("section",{className:"news",children:Object(k.jsxs)("div",{className:"content-width",children:[Object(k.jsx)(ue,{addToPhotosButton:!0,avatar:t,userId:s}),o.map(((e,t)=>Object(k.jsx)(Xe,{fetchedItems:c,index:t,loadingCallback:r,post:e},e.id)))]})}):null}function mt(){const e=Object(a.b)(),{ownerId:t}=Object(S.useParams)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[o,i]=Object(n.useState)(),[l,d]=Object(n.useState)();Object(n.useEffect)((()=>{if(null!==s)return B({fields:["info","photos","profilePhotos"],userId:t||s,callback:e=>{const t=[];for(const s in null===e||void 0===e?void 0:e.profilePhotos)(null===e||void 0===e?void 0:e.photos)&&t.push(e.photos[s]);t.sort(((e,t)=>t.date-e.date)),i(t),d(e)}})}),[t,s]);const{finishLoading:u,loaded:m,setTitle:b}=R();return Object(n.useEffect)((()=>{const e=t!==s&&t?`${null===l||void 0===l?void 0:l.info.name} ${null===l||void 0===l?void 0:l.info.lastName}'s photos`:"My photos";m.current?b(e):l?u(e):null===l&&u()}),[m,t,l,u,s,b]),void 0===l?null:l?Object(k.jsx)("section",{className:"photos",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"photos__wrapper",children:[Object(k.jsx)("div",{className:"photos__header",children:Object(k.jsx)(c.b,{className:"photos__title",to:"/id"+l.info.id,children:(t!==s&&t?`${l.info.name}'s`:"My")+` photos (${null===o||void 0===o?void 0:o.length})`})}),o.length>0&&Object(k.jsx)("div",{className:"photos__items",children:Object(k.jsx)("div",{className:"photos__items-wrapper",children:o.map(((t,s)=>Object(k.jsx)(c.b,{className:"photos__item",to:"#javascript",onClick:t=>{e(r("gallery",{gallery:{author:l,content:o,initialSlide:s}})),t.preventDefault()},children:Object(k.jsx)("div",{className:"photos__item-wrapper",children:Object(k.jsx)("img",{className:"photos__item-img",src:t.src,alt:""})})},t.id)))})})]})})}):Object(k.jsx)(He,{})}function bt(){const{postId:e}=Object(S.useParams)(),[t,s]=Object(n.useState)(),{fetchedItems:o,finishLoading:a}=R(),c=Object(n.useCallback)((()=>a("Post")),[a]);return Object(n.useEffect)((()=>q("posts/post"+e).on((e=>{e?(s(e),o.current.setExpected(1)):(a(),s(null))}))),[o,a,e]),void 0===t?null:null===t?Object(k.jsx)(He,{}):Object(k.jsx)("section",{className:"post-page",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsx)(Xe,{fetchedItems:o,loadingCallback:c,post:t,renderComments:!0})})})}function jt({profileOwner:e,profilePhotos:t}){var s,n,o,i;const l=Object(a.b)(),{ownerId:d}=Object(S.useParams)(),u=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.friendRequests})),m=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));function b(){l(r("action-confirm",{actionConfirm:{text:"Are you sure you want to remove this friend?",callback:()=>q().update({[`users/user${d}/friends/user${m}`]:null,[`users/user${m}/friends/user${d}`]:null})}}))}const j=Object.values({...e.friends});return Object(k.jsxs)("div",{className:"profile__left",children:[Object(k.jsx)(ie,{avatar:t.current.find((t=>t.src===e.info.avatar)),user:e}),Object(k.jsx)("div",{className:"profile__left-online-status",children:Object(k.jsx)("p",{className:"profile__left-online-status-text",children:K(e)})}),e.info.deleted?(null===(i=e.friends)||void 0===i?void 0:i["user"+m])&&Object(k.jsx)("div",{className:"profile__left-buttons",children:Object(k.jsx)(re,{afterIconClass:"fas fa-user-minus",preset:"remove",text:"Remove friend",onClick:b})}):Object(k.jsxs)(k.Fragment,{children:[m&&(d!==m?Object(k.jsxs)("div",{className:"profile__left-buttons",children:[(null===(s=e.friends)||void 0===s?void 0:s["user"+m])?Object(k.jsx)(re,{afterIconClass:"fas fa-user-minus",preset:"remove",text:"Remove friend",onClick:b}):(null===u||void 0===u||null===(n=u.received)||void 0===n?void 0:n["user"+d])?Object(k.jsx)(re,{afterIconClass:"fas fa-user-plus",text:"Accept friend request",onClick:()=>Q({reqUserId:d,userId:m})}):(null===u||void 0===u||null===(o=u.sent)||void 0===o?void 0:o["user"+d])?Object(k.jsx)(re,{afterIconClass:"fas fa-user-times",preset:"remove",text:"Cancel friend request",onClick:function(){q().update({[`users/user${d}/friendRequests/received/user${m}`]:null,[`users/user${m}/friendRequests/sent/user${d}`]:null})}}):Object(k.jsx)(re,{afterIconClass:"fas fa-user-plus",text:"Add friend",onClick:function(){q().update({[`users/user${d}/friendRequests/received/user${m}`]:{date:P,userId:m},[`users/user${m}/friendRequests/sent/user${d}`]:{date:P,userId:d}})}}),Object(k.jsx)(re,{afterIconClass:"far fa-comment-alt",text:"Send message",to:"/conversation?interlocutor="+d})]}):Object(k.jsx)("div",{className:"profile__left-buttons",children:Object(k.jsx)(re,{afterIconClass:"fas fa-portrait",preset:"secondary",text:"Change avatar",onClick:()=>l(r("change-avatar"))})})),Object(k.jsxs)("div",{className:"profile__left-friends",children:[Object(k.jsx)("div",{className:"profile__left-friends-header",children:Object(k.jsx)(c.b,{className:"profile__left-friends-title",to:"/friends"+(d!==m?d:""),children:`Friends (${j.length})`})}),j.length>0&&Object(k.jsx)("div",{className:"profile__left-friends-items",children:Object(k.jsx)("div",{className:"profile__left-friends-items-wrapper",children:j.map((e=>Object(k.jsx)(ft,{friendId:e.userId},e.userId)))})})]})]})]})}function ft({friendId:e}){const[t,s]=Object(n.useState)();return Object(n.useEffect)((()=>B({userId:e,callback:e=>s(e.info)})),[e]),t?Object(k.jsxs)("div",{className:"profile__left-friends-item",children:[Object(k.jsx)(ce,{size:"small",src:t.avatar,userId:e}),Object(k.jsx)(c.b,{className:"profile__left-friends-item-name",to:"/id"+e,children:t.name})]}):null}function ht(){var e;const t=Object(a.b)(),s=Object(S.useHistory)(),{ownerId:o}=Object(S.useParams)(),i=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),l=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),d=Object(n.useRef)(),u=Object(n.useRef)(),[m,b]=Object(n.useState)(),[j,f]=Object(n.useState)(),{fetchedItems:h,finishLoading:p,loaded:v,setTitle:O}=R(),x=Object(n.useCallback)((()=>{p((null===j||void 0===j?void 0:j.info.name)+" "+(null===j||void 0===j?void 0:j.info.lastName))}),[p,null===j||void 0===j?void 0:j.info.lastName,null===j||void 0===j?void 0:j.info.name]),_=Object(n.useCallback)((e=>{if(e){if(document.activeElement.blur(),u.current=[],e.profilePhotos){for(const s in e.profilePhotos){var t;(null===(t=e.photos)||void 0===t?void 0:t[s])&&u.current.push(e.photos[s])}u.current.sort(((e,t)=>t.date-e.date))}d.current=q("posts/").orderByChild("authorId").equalTo(o).on((e=>{const t=Object.values({...e});b(t.sort(((e,t)=>+t.id-+e.id))),h.current.setExpected(t.length)}))}else f(null)}),[h,o]);return Object(n.useEffect)((()=>{v.current?O((null===j||void 0===j?void 0:j.info.name)+" "+(null===j||void 0===j?void 0:j.info.lastName)):m?x():null!==m&&null!==j||p()}),[p,v,x,o,m,j,O,l]),Object(n.useEffect)((()=>{if(null===l)return;const e=B({fields:["connections","friendRequests","friends","info","photos","profilePhotos"],userId:o,callback:e=>{var t;null===(t=d.current)||void 0===t||t.call(d),_(e),f(e)}});return()=>{var t;e(),null===(t=d.current)||void 0===t||t.call(d)}}),[o,_,l]),void 0===j?null:j?Object(k.jsx)("section",{className:"profile",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"profile__wrapper",children:[Object(k.jsx)(jt,{profileOwner:j,profilePhotos:u}),Object(k.jsxs)("div",{className:"profile__content",children:[Object(k.jsxs)("div",{className:"profile__content-info",children:[Object(k.jsxs)("div",{className:"profile__content-info-header",children:[Object(k.jsxs)("div",{className:"profile__content-info-header-container",children:[Object(k.jsx)("h1",{className:"profile__content-info-header-name",children:`${j.info.name} ${j.info.lastName}`}),o!==l&&!j.info.deleted&&Object(k.jsxs)(de,{bookmarkType:"user",itemId:o,children:[Object(k.jsx)(re,{text:"Report",onClick:()=>!l&&s.push("/")}),i&&Object(k.jsx)(re,{text:"Delete user",onClick:function(){t(r("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this account?",irreversible:!0,password:!0,callback:()=>J(o)}}))}})]})]}),Object(k.jsx)(le,{className:"user-status",databaseRef:`users/user${o}/info/status`,emptyButtonText:"Set status",field:j.info.status,ownerId:o,renderInputId:"status"})]}),(j.info.birthday||j.info.country||j.info.city)&&Object(k.jsxs)("div",{className:"profile__content-info-middle",children:[j.info.birthday&&Object(k.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(k.jsx)("span",{className:"profile__content-info-middle-item-title",children:"Birthday: "}),Object(k.jsx)("span",{className:"profile__content-info-middle-item-value",children:j.info.birthday})]}),j.info.country&&Object(k.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(k.jsx)("span",{className:"profile__content-info-middle-item-title",children:"Country: "}),Object(k.jsx)("span",{className:"profile__content-info-middle-item-value",children:j.info.country})]}),j.info.city&&Object(k.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(k.jsx)("span",{className:"profile__content-info-middle-item-title",children:"City: "}),Object(k.jsx)("span",{className:"profile__content-info-middle-item-value",children:j.info.city})]})]}),Object(k.jsxs)("div",{className:"profile__content-info-footer",children:[(null===(e=j.friendRequests)||void 0===e?void 0:e.received)&&Object(k.jsxs)("div",{className:"profile__content-info-footer-item",children:[Object(k.jsx)("p",{className:"profile__content-info-footer-item-number",children:Object.keys(j.friendRequests.received).length}),Object(k.jsx)("p",{className:"profile__content-info-footer-item-title",children:"followers"})]}),j.profilePhotos&&Object(k.jsxs)(c.b,{className:"profile__content-info-footer-button",to:"/photos"+(o!==l?o:""),children:[Object(k.jsx)("p",{className:"profile__content-info-footer-button-number",children:Object.keys(j.profilePhotos).length}),Object(k.jsx)("p",{className:"profile__content-info-footer-button-title",children:"photos"})]}),Object(k.jsxs)(c.b,{className:"profile__content-info-footer-button",to:"#todo",children:[Object(k.jsx)("p",{className:"profile__content-info-footer-button-number",children:(null===m||void 0===m?void 0:m.length)||0}),Object(k.jsx)("p",{className:"profile__content-info-footer-button-title",children:"posts"})]})]})]}),!j.info.deleted&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("div",{className:"profile__content-photos",children:[Object(k.jsx)(c.b,{className:"profile__content-photos-title",to:"/photos"+(o!==l?o:""),children:"Photos: "+Object.keys({...j.profilePhotos}).length}),u.current.length>0&&Object(k.jsx)("div",{className:"profile__content-photos-container",children:u.current.map(((e,s)=>s<4&&Object(k.jsx)(c.b,{className:"profile__content-photos-img-container",to:"#javascript",onClick:e=>{t(r("gallery",{gallery:{author:j,content:u.current,initialSlide:s}})),e.preventDefault()},children:Object(k.jsx)("div",{className:"profile__content-photos-img-inner-container",children:Object(k.jsx)("img",{className:"profile__content-photos-img",src:e.src,alt:""})})},e.id)))})]}),Object(k.jsxs)("div",{className:"profile__content-posts",children:[Object(k.jsx)("div",{className:"profile__content-posts-header",children:Object(k.jsx)(c.b,{className:"profile__content-posts-title",to:"#todo",children:"Posts"})}),null===m||void 0===m?void 0:m.map(((e,t)=>Object(k.jsx)(Xe,{fetchedItems:h,index:t,loadingCallback:x,post:e},e.id)))]})]})]})]})})}):Object(k.jsx)(He,{})}function pt(){const e=Object(S.useHistory)(),{finishLoading:t}=R(),{search:s}=Object(S.useLocation)(),o=new URLSearchParams(s).get("query"),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[c,i]=Object(n.useState)(),[r,l]=Object(n.useState)(""),d=Object(n.useCallback)((e=>!o||e.toLowerCase().includes(o.toLowerCase())),[o]);return Object(n.useEffect)((()=>{const e=[];let t=!1;return q("contentData/nextUserId").once((s=>{if(t)return;const n=parseInt(s,10)-1,o=[!0],a=[];for(let t=1;t<=n;t++)e[t]=B({fields:["connections","info"],userId:`${t}`,callback:e=>{o[t]||e.info.deleted||!d(e.info.name)&&!d(e.info.lastName)||a.push(e),o[t]=!0,o.includes(void 0)||o.length-1!==n||i(a.sort(((e,t)=>+e.info.id-+t.info.id)))}})})),()=>{t=!0,e.forEach((e=>e()))}}),[d]),Object(n.useEffect)((()=>{c&&t(o?"Search results for "+o:"Search")}),[t,c,o]),Object(n.useEffect)((()=>l(o||"")),[o]),Object(n.useEffect)((()=>{const t=setTimeout((()=>{(o||"")!==r&&e.push("?query="+(r||""))}),250);return()=>clearTimeout(t)}),[e,o,r]),null===a?null:Object(k.jsx)("section",{className:"search",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"search__wrapper",children:[Object(k.jsxs)("div",{className:"search__header",children:[Object(k.jsx)("h1",{className:"search__title",children:`Search users (${null===c||void 0===c?void 0:c.length})`}),Object(k.jsx)(me,{onChange:e=>l(e.target.value),onSubmit:e=>e.preventDefault(),value:r})]}),Object(k.jsx)("div",{className:"search__content",children:(null===c||void 0===c?void 0:c.length)?Object(k.jsx)(Ge,{users:c}):Object(k.jsx)("p",{className:"search__no-results",children:"No results."})})]})})})}function vt(){const e=Object(S.useHistory)(),{search:t}=Object(S.useLocation)(),s=new URLSearchParams(t).get("tab"),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{finishLoading:a}=R(),i=["account","security"].find((e=>e===s))||"information";return Object(n.useEffect)((()=>{void 0===o?e.push("/"):o&&a("Settings")}),[a,e,o]),o?Object(k.jsxs)("section",{className:"settings",children:[Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"settings__wrapper",children:[Object(k.jsx)("div",{className:"settings__header",children:Object(k.jsxs)("h1",{className:"settings__title",children:["information"===i&&"Main information","security"===i&&"Security","account"===i&&"Account"]})}),"information"===i&&Object(k.jsx)(Ot,{}),"security"===i&&Object(k.jsx)(xt,{}),"account"===i&&Object(k.jsx)(_t,{})]})}),Object(k.jsx)("aside",{className:"sidebar",children:Object(k.jsxs)("div",{className:"sidebar__wrapper",children:[Object(k.jsx)(c.b,{className:"sidebar__button"+("information"===i?" sidebar__button--active":""),to:"/settings",children:"Information"}),Object(k.jsx)(c.b,{className:"sidebar__button"+("security"===i?" sidebar__button--active":""),to:"?tab=security",children:"Security"}),Object(k.jsx)(c.b,{className:"sidebar__button"+("account"===i?" sidebar__button--active":""),to:"?tab=account",children:"Account"})]})})]}):null}function Ot(){const e=y((e=>e.user.info)),{formState:{errors:t},handleSubmit:s,register:n,reset:o}=Object(C.a)(),{AsyncButton:a,buttonLoadingRef:c,setButtonLoading:i}=A();return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:s((function(t){if(!c.current){i(),t=V(t);for(const e in t)t[e]||(t[e]=null);q(`users/user${e.id}/info`).update(t).then((()=>{i(!1),o()}))}})),children:[F.filter((e=>["name","lastName"].includes(e.id))).map((s=>Object(k.jsx)(U,{opts:{obj:s,defaultValue:e[s.id],errors:t,label:!0,register:n}},s.id))),Object(k.jsx)(z,{register:n,userGender:e.gender}),F.filter((e=>["country","city"].includes(e.id))).map((s=>Object(k.jsx)(U,{opts:{obj:s,defaultValue:e[s.id],errors:t,label:!0,register:n}},s.id))),Object(k.jsxs)("div",{className:"settings__buttons",children:[Object(k.jsx)(a,{text:"Save",type:"submit"}),Object(k.jsx)(re,{preset:"secondary",text:"Cancel",onClick:()=>o()})]})]})}function xt(){const e=y((e=>e.user.account)),t=y((e=>e.user.account.id)),{formState:{errors:s},handleSubmit:o,register:a,reset:c}=Object(C.a)(),{AsyncButton:i,buttonLoadingRef:r,setButtonLoading:l}=A(),d=Object(n.useRef)(),[u,m]=Object(n.useState)(!1);return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:o((function(s){var n;r.current||(l(),null===(n=d.current)||void 0===n||n.call(d),d.current=q("users/").orderByChild("account/email").equalTo(s.email.toLowerCase()).on((n=>{if(d.current(),n&&!n["user"+t])return s.email=e.email,l(!1),void m(!0);q(`users/user${e.id}/account`).update({email:s.email.toLowerCase(),password:v(s.password,t)}).then((()=>{if(O(e.password)!==s.password){const e={id:t,password:s.password};document.cookie=`USER_DATA=${JSON.stringify(e)}; expires=${new Date(Date.now()+31536e6)}`}l(!1),c()}))})))})),children:[Object(k.jsx)(U,{onInput:()=>m(!1),opts:{obj:F.find((e=>"email"===e.id)),defaultValue:e.email,errors:s,label:!0,register:a}}),u&&Object(k.jsx)("p",{className:"error-text",children:"This email is already used."}),Object(k.jsx)(U,{opts:{obj:F.find((e=>"password"===e.id)),defaultValue:O(e.password),errors:s,label:!0,register:a}}),Object(k.jsxs)("div",{className:"settings__buttons",children:[Object(k.jsx)(i,{text:"Save",type:"submit"}),Object(k.jsx)(re,{preset:"secondary",text:"Cancel",onClick:()=>{c(),m(!1)}})]})]})}function _t(){const e=Object(a.b)(),t=y((e=>e.user.account.id));return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:function(s){s.preventDefault(),e(r("action-confirm",{actionConfirm:{text:"Are you sure you want to delete your account?",irreversible:!0,password:!0,callback:()=>{e({type:"LOG_OUT"}),setTimeout((()=>J(t)),0)}}}))},children:[Object(k.jsx)("h3",{className:"primary-form__title",children:"Account removal"}),Object(k.jsx)(re,{preset:"remove",text:"Delete account",type:"submit"})]})}function gt(){const{pathname:e}=Object(S.useLocation)(),t=Object(a.b)(),s=y((e=>e.modal)),o=Object(n.useRef)(null);return o.current=s.currentModal,Object(n.useEffect)((()=>{t(l(o.current))}),[t,e]),null}function Nt(){return window.history.scrollRestoration="manual",Object(k.jsx)(c.a,{children:Object(k.jsxs)(a.a,{store:w,children:[Object(k.jsx)(gt,{}),Object(k.jsx)(Ue,{}),Object(k.jsx)(qe,{}),Object(k.jsx)("main",{className:"main",children:Object(k.jsxs)("div",{className:"page-width",children:[Object(k.jsx)(Fe,{}),Object(k.jsxs)(i.Switch,{loadingScreen:()=>Object(k.jsxs)("div",{className:"loading-screen",children:[Object(k.jsx)("div",{}),Object(k.jsx)("div",{}),Object(k.jsx)("div",{}),Object(k.jsx)("div",{})]}),children:[Object(k.jsx)(i.Route,{path:"/",exact:!0,component:rt}),Object(k.jsx)(i.Route,{path:"/bookmarks",component:et,loading:!0}),Object(k.jsx)(i.Route,{path:"/communities",component:tt,loading:!0}),Object(k.jsx)(i.Route,{path:"/community:communityId",component:st,loading:!0}),Object(k.jsx)(i.Route,{path:"/conversation",component:nt,loading:!0}),Object(k.jsx)(i.Route,{path:"/friends",component:at,loading:!0}),Object(k.jsx)(i.Route,{path:"/messages",component:lt,loading:!0}),Object(k.jsx)(i.Route,{path:"/news",component:ut,loading:!0}),Object(k.jsx)(i.Route,{path:"/photos",component:mt,loading:!0}),Object(k.jsx)(i.Route,{path:"/search",component:pt,loading:!0}),Object(k.jsx)(i.Route,{path:"/settings",component:vt,loading:!0}),Object(k.jsx)(i.Route,{path:"/conversation:conversationId",component:nt,loading:!0}),Object(k.jsx)(i.Route,{path:"/friends:ownerId",component:at,loading:!0}),Object(k.jsx)(i.Route,{path:"/photos:ownerId",component:mt,loading:!0}),Object(k.jsx)(i.Route,{path:"/post:postId",component:bt,loading:!0}),Object(k.jsx)(i.Route,{path:"/id:ownerId",component:ht,loading:!0}),Object(k.jsx)(i.Route,{path:"/",component:He})]})]})}),Object(k.jsx)(Te,{}),Object(k.jsx)(Pe,{}),Object(k.jsx)(ze,{})]})})}var yt=e=>{e&&e instanceof Function&&s.e(3).then(s.bind(null,61)).then((({getCLS:t,getFID:s,getFCP:n,getLCP:o,getTTFB:a})=>{t(e),s(e),n(e),o(e),a(e)}))};Object(o.render)(Object(k.jsx)(n.StrictMode,{children:Object(k.jsx)(Nt,{})}),document.getElementById("app")),yt()}},[[53,1,2]]]);