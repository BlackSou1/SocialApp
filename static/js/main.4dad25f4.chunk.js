(this["webpackJsonpreact-project"]=this["webpackJsonpreact-project"]||[]).push([[0],{49:function(e,t,s){},53:function(e,t,s){"use strict";s.r(t);var n=s(1),a=s(19),o=s(3),r=s(2),c=s(12);s(48),s(49);const i=(e,t={})=>({type:"OPEN_MODAL",name:e,opts:t}),l=e=>({type:"CLOSE_MODAL",name:e});var d=s(26),u=s(34);let m;function j(){const e=window.innerWidth-document.body.offsetWidth+"px";m=document.querySelectorAll(".fixed-item"),document.body.style.overflow="hidden",document.body.style.marginRight=e,m.forEach((t=>t.style.paddingRight=e))}function b(){document.body.style.overflow="",document.body.style.marginRight="",m.forEach((e=>e.style.paddingRight=""))}var f=(e=!1,t)=>{switch(t.type){case"OPEN_HAMBURGER":return j(),!0;case"CLOSE_HAMBURGER":return!1;default:return e}};const h={activeModals:[],currentModal:null,gallery:{content:[]},modals:{},zoom:{}};var p=(e=h,t)=>{var s;const n={...e,actionConfirm:{...e.actionConfirm},activeModals:[...e.activeModals],modals:{...e.modals},zoom:{...e.zoom}};switch(t.type){case"OPEN_MODAL":return j(),n.modals[t.name]=!0,n.activeModals.push(t.name),n.currentModal=t.name,n.actionConfirm=t.opts.actionConfirm,n.actionError=t.opts.actionError,n.changeAvatarCommunityId=t.opts.changeAvatarCommunityId,t.opts.gallery&&(n.gallery=t.opts.gallery),(null===(s=t.opts.zoom)||void 0===s?void 0:s.img)&&(n.zoom.img=t.opts.zoom.img,n.zoom.alt=t.opts.zoom.alt||""),n;case"CLOSE_MODAL":return n.modals[t.name]=!1,n.activeModals.includes(t.name)&&(n.activeModals.splice(n.activeModals.indexOf(t.name)),n.currentModal=n.activeModals[n.activeModals.length-1]),n;default:return e}};function v(e,t){let s=0;[...e].forEach((e=>s+=e.charCodeAt(0)));const n=n=>(s+e.length+parseInt(t.toString(),36)%(n+1)**2)%26+(2===n?0:10),a=e=>e.toString(36),o=n(1),r=n(2),c=n(3),i=n(4);let l="";return[...e].forEach(((e,t)=>{l+=String.fromCharCode(e.charCodeAt(0)+o+r+c+i-Math.min(t%60,t%65,t%70))})),l=btoa(l),l[0]+a(o)+a(r)+a(c)+l.slice(1,-2)+a(i)+l.slice(-2)}function O(e){const t=parseInt(e[1],36),s=parseInt(e[2],36),n=parseInt(e[3],36),a=parseInt(e[e.length-3],36),o=e[0]+e.slice(4,-3)+e.slice(-2);let r="";return[...atob(o)].forEach(((e,o)=>{r+=String.fromCharCode(e.charCodeAt(0)-t-s-n-a+Math.min(o%60,o%65,o%70))})),r}const x={account:{id:null},info:{avatar:"",gender:"",id:"",lastName:"",lastSeen:0,name:""}};var _=(e=x,t)=>{const s=localStorage.getItem("loggedIn");let n;switch(t.type){case"LOG_IN":return n={id:t.user.account.id,password:O(t.user.account.password)},document.cookie=`USER_DATA=${JSON.stringify(n)}; expires=${new Date(Date.now()+31536e6)}`,localStorage.setItem("loggedIn","true"),t.user;case"LOG_OUT":return document.cookie=`USER_DATA=; expires=${new Date}`,localStorage.removeItem("loggedIn"),null;case"LOG_SYNC":return s?t.user:(document.cookie=`USER_DATA=; expires=${new Date}`,null);default:return e}};const g=Object(d.b)({user:_,hamburger:f,modal:p}),N=Object(d.c)(g,Object(d.a)(u.a)),y=o.c;var w=N,k=s(0);function I({children:e,className:t,contentClassName:s,modalName:a,zoomImg:r}){const c=Object(o.b)(),i=y((e=>e.modal)),d=Object(n.useRef)(null),u=Object(n.useRef)(null),m=Object(n.useCallback)((()=>{c(l(a))}),[c,a]);const j=Object(n.useCallback)((e=>{"Escape"===e.key&&i.currentModal===a&&m()}),[m,i.currentModal,a]);Object(n.useEffect)((()=>(window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j))),[j]);const f=Object(n.useRef)(!1);return Object(k.jsx)("div",{className:i.modals[a]?t+" modal--open":t,ref:d,onMouseDown:function(e){e.target===u.current&&(f.current=!0)},onMouseUp:function(e){f.current&&e.target===u.current&&m(),f.current=!1},onTransitionEnd:function(e){null==i.currentModal&&e.target===d.current&&b()},children:Object(k.jsx)("div",{className:"modal__wrapper",ref:u,children:Object(k.jsxs)("div",{className:s,onClick:e=>e.stopPropagation(),children:[Object(k.jsx)("button",{className:"modal__close","aria-label":"Close modal",onClick:m,children:"\xd7"}),e,r&&Object(k.jsx)("img",{className:"modal-zoom__img",src:i.zoom.img||"#",alt:i.zoom.alt||""})]})})})}var C=s(14),S=s(11);var $=[{id:"name",name:"name",title:"Name",errors:{maxLength:{value:32,message:"A name cannot contain more than 32 characters"},required:"Enter your name"}},{id:"lastName",name:"lastName",title:"Last name",errors:{maxLength:{value:32,message:"A last name cannot contain more than 32 characters"},required:"Enter your last name"}},{id:"country",name:"country",title:"Country",errors:{maxLength:{value:56,message:"A country cannot contain more than 56 characters"}}},{id:"city",name:"city",title:"City",errors:{maxLength:{value:85,message:"A city cannot contain more than 85 characters"}}},{id:"email",name:"email",title:"Email",errors:{maxLength:{value:320,message:"An email cannot contain more than 320 characters"},pattern:{value:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,message:"Enter a correct email address!"},required:"Enter an email address"}},{id:"password",name:"password",type:"password",title:"Password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},minLength:{value:2,message:"A password must be at least 2 characters long"},pattern:{value:/^[a-zA-Z0-9!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~-]*$/,message:"A password can only contain letters (a-z, A-Z), numbers, and symbols !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~, and cannot contain spaces"},required:"Enter a password"}},{id:"existingPassword",name:"password",type:"password",title:"Password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},required:"Enter your password"}},{id:"confirmPassword",name:"password",type:"password",title:"Confirm password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},required:"Confirm your password"}},{autoComplete:"off",id:"status",name:"status",title:"Status",errors:{maxLength:{value:80,message:"A status cannot contain more than 80 characters"}}},{id:"title",name:"title",title:"Title",errors:{maxLength:{value:32,message:"A title cannot contain more than 32 characters"},required:"Enter community title"}},{id:"description",name:"text",title:"Description",errors:{maxLength:{value:256,message:"A description cannot contain more than 256 characters"}}},{id:"shortDescription",name:"text",title:"Short description",errors:{maxLength:{value:100,message:"A short description cannot contain more than 100 characters"}}}],E=s(24);s(51),s(54);E.a.initializeApp({apiKey:"AIzaSyBiW6i54kOJNamqNFqxO6ZB78uSGIbRqEM",authDomain:"social-app-bs.firebaseapp.com",databaseURL:"https://social-app-bs-default-rtdb.europe-west1.firebasedatabase.app",projectId:"social-app-bs",storageBucket:"social-app-bs.appspot.com",messagingSenderId:"129896299882",appId:"1:129896299882:web:7bf515fc32dcf9a735f913"});const P=E.a.database(),R=E.a.database.ServerValue.TIMESTAMP,T=E.a.storage(),L=({register:e,userGender:t})=>Object(k.jsxs)("div",{className:"gender",children:[Object(k.jsx)("h4",{className:"gender__title",children:"Gender"}),Object(k.jsx)("div",{className:"gender__items",children:["Male","Female"].map((s=>Object(k.jsxs)("label",{className:"gender__item",children:[Object(k.jsx)("input",{className:"gender__input",defaultChecked:s.toLowerCase()===(t||"male"),type:"radio",value:s.toLowerCase(),...e("gender")}),Object(k.jsx)("p",{className:"gender__text",children:s})]},s)))})]});var A=({opts:{defaultValue:e,errors:t,label:s,labelText:a,obj:o,placeholder:r,register:c},...i})=>{const[l,d]=Object(n.useState)(!1),u={id:o.id,autoComplete:o.autoComplete||"on",defaultValue:e||"",placeholder:r?o.title:""};return Object(k.jsxs)("div",{className:"primary-form__item",children:[s&&Object(k.jsx)("label",{className:"primary-form__label",htmlFor:i.id||o.id,children:a||o.title}),["password","existingPassword"].includes(o.id)?Object(k.jsxs)("div",{className:"primary-form__password",children:[Object(k.jsx)("input",{className:"primary-form__input-password primary-form__input",autoCapitalize:"off",...u,spellCheck:!1,type:l?"text":"password",...i,...c("password",o.errors)}),Object(k.jsx)("button",{className:"primary-form__password-show",type:"button","aria-label":"Toggle password visibility",onClick:()=>d(!l),children:Object(k.jsx)("i",{className:l?"far fa-eye":"far fa-eye-slash"})})]}):Object(k.jsx)("input",{className:"primary-form__input",autoCapitalize:["confirmPassword","email"].includes(o.id)?"off":"on",...u,spellCheck:!["confirmPassword","email"].includes(o.id),type:o.type||"text",...i,...c(o.id,o.errors)}),t[o.id]&&Object(k.jsx)("p",{className:"error-text",children:t[o.id].message})]})};function D(e=!0){const[t,s]=Object(n.useState)([]);return{addImgPreview:n=>{const a=[...n.target.files];e||(a.length=1);let o=a.length;n.target.value="";const r=[];a.forEach((e=>{let n,a;["jpg","jpeg","png"].includes(e.name.split(".").pop().toLowerCase())||(a=!0,o--);const c={lastModified:e.lastModified,name:e.name,size:e.size,type:e.type};for(const s of t)if(JSON.stringify(s.props)===JSON.stringify(c)){n=!0,o--;break}if(!n||!a){const n=new FileReader;n.onload=()=>{r.push({props:c,file:e,result:n.result}),r.length===o&&s([...t,...r])},n.readAsDataURL(e)}}))},imgPreview:t,setImgPreview:s}}function M(e,t,s="s"){return`${t} ${e}${1!==t?s:""}`}function q(e,t){const s=new Date(e),n=Date.now()+1e3,a=new Date(n),o=(n-e)/1e3,r=o/60,c=r/60,i=s;return r<1?`${M("second",Math.floor(o))} ago`:c<1?`${M("minute",Math.floor(r))} ago`:c<3&&a.getDate()===s.getDate()?`${M("hour",Math.floor(c))} ago`:c<24&&a.getDate()===s.getDate()?t?"today":`today at ${i.getHours()}:${i.getMinutes()<10?0:""}${i.getMinutes()}`:c<48&&new Date(n-864e5).getDate()===s.getDate()?t?"yesterday":`yesterday at ${i.getHours()}:${i.getMinutes()<10?0:""}${i.getMinutes()}`:a.getFullYear()===s.getFullYear()?t?`${i.toLocaleString("en-US",{month:"long"})} ${i.getDate()}`:`${i.toLocaleString("en-US",{month:"long"})} ${i.getDate()} at ${i.getHours()}:${i.getMinutes()<10?0:""}${i.getMinutes()}`:t?`${i.toLocaleString("en-US",{month:"long"})} ${i.getDate()} ${i.getFullYear()}`:`${i.toLocaleString("en-US",{month:"long"})} ${i.getDate()} ${i.getFullYear()} at ${i.getHours()}:${i.getMinutes()<10?0:""}${i.getMinutes()}`}function z(e,t){if(e)return(e=e.trim()).length>t&&(e=e.slice(0,t)),e}function F(e){for(const t in e)e[t]=z(e[t]);return e}const U=({reqUserId:e,userId:t})=>{P.ref(`users/user${e}/friendRequests/sent/user${t}`).remove(),P.ref(`users/user${t}/friendRequests/received/user${e}`).remove(),P.ref(`users/user${e}/friends/user${t}`).set({friendAddDate:R,userId:t}),P.ref(`users/user${t}/friends/user${e}`).set({friendAddDate:R,userId:e})},H=({posts:e,userId:t})=>{P.ref("users/user"+t).update({account:{deleted:!0,id:t},bookmarks:null,connections:null,info:{avatar:"img/user-deleted.svg",deleted:!0,id:t,lastName:"account",name:"Deleted"},photos:null,profilePhotos:null}),e.map((e=>P.ref("posts/post"+e.id).remove()))},B=e=>{P.ref("posts").once("value",(t=>{const s=Object.values({...t.val()});P.ref("communities/community"+e).update({avatar:"img/community-deleted.svg",banner:null,deleted:!0,description:null,id:e,photos:null,profilePhotos:null,shortDescription:null,title:"Deleted community"}),T.ref(`img/community${e}_banner`).delete(),s.filter((t=>t.communityId===e)).map((e=>P.ref("posts/post"+e.id).remove()))}))},G=e=>e.info.deleted?"This user account has been removed":e.connections?"Online":"Last seen "+q(e.info.lastSeen),Y=({condition:e,contentId:t,contentRef:s,history:n,userId:a,userRef:o})=>{if(!a)return void n.push("/");const r=P.ref(s),c=P.ref(o);e?(r.remove(),c.remove()):(r.set({date:R,userId:a}),c.set({commentId:t}))},V=({callback:e,communityId:t,e:s,imgPreview:n,inputText:a,setImgPreview:o,userId:r})=>{if("keypress"===s.type&&("Enter"!==s.key||s.shiftKey))return;const c=z(a.current,5e3),i=n,l=[];if(s.preventDefault(),s.target.closest("form").reset(),a.current=null,o([]),i.length||c){i.length||d();const e=({id:e,index:t})=>{l[t]=e,l.length!==i.length||l.includes(void 0)||d()};i.forEach(((s,n)=>Z({addToPhotos:s.addToPhotos,callback:e,communityId:t,file:s.file,index:n,userId:r})))}function d(){const t=l.map((e=>({type:"img",value:e})));c&&t.unshift({type:"text",value:c}),e(t)}},Q=(e,t,s,n)=>{if(!s)return void t.push("/");const a=`communities/community${e}/subscribers/user${s}`;n?P.ref(a).remove():P.ref(a).set({date:R,userId:s})},J=e=>{e?localStorage.setItem("darkTheme","true"):localStorage.removeItem("darkTheme")},W=()=>localStorage.getItem("darkTheme"),K=()=>{const e=localStorage.getItem("darkTheme");document.documentElement.classList[e?"add":"remove"]("dark"),document.querySelector("meta[name=theme-color]").content=e?"#1773a8":"#22aeff"},Z=({addToPhotos:e,callback:t,communityId:s,createId:n=!0,file:a,imgPath:o="photos",index:r,storagePrefix:c="",userId:l})=>{const d=n?P.ref().push().key:o,u=T.ref("img/"+(c?c+"_":"")+d).put(a);u.on("state_changed",(()=>0),(()=>w.dispatch(i("action-error",{actionError:"Failed to load image to our database. Try again."}))),(()=>u.snapshot.ref.getDownloadURL().then((a=>new Promise((()=>{const c=s?"communities/community"+s:"/users/user"+l;P.ref(`${c}/${o}${n?"/"+d:""}`).set({date:R,id:n?d:null,src:a}),e&&P.ref(`${c}/profilePhotos/${d}`).set({id:d}),null===t||void 0===t||t({id:d,index:r,link:a})}))))))};function X({addToPhotosHandler:e,imgPreview:t,removeOnClick:s}){const n=Object(o.b)();return Object(k.jsxs)("div",{className:"upload-preview",children:[Object(k.jsxs)("div",{className:"upload-preview__header",children:[Object(k.jsx)("button",{className:"upload-preview__header-remove",type:"button",onClick:s,children:"\xd7"}),Object(k.jsx)("button",{className:"upload-preview__header-img-container",type:"button",onClick:()=>n(i("zoom",{zoom:{img:t.result,alt:""}})),children:Object(k.jsx)("img",{className:"upload-preview__header-img",src:t.result,alt:""})})]}),Object(k.jsx)("div",{className:"upload-preview__footer",children:Object(k.jsxs)("div",{className:"upload-preview__footer-wrapper",children:[Object(k.jsx)("h4",{className:"upload-preview__title upload-preview__footer-item",children:t.props.name}),e&&Object(k.jsxs)("label",{className:"upload-preview__checkbox upload-preview__footer-item",children:[Object(k.jsx)("input",{className:"upload-preview__checkbox-input",type:"checkbox",name:"checkbox",onChange:e}),Object(k.jsx)("p",{className:"upload-preview__checkbox-text",children:"Add to my photos"})]})]})})]})}const ee=({community:e,nameIsLink:t=!0,onClick:s,onlyName:n,text:a,textLink:o,userInfo:c})=>{const i=t?r.b:"h4",l=o?r.b:"p";return Object(k.jsxs)("div",{className:"author-info",children:[Object(k.jsx)(i,{className:"author-info__name",to:t?"/"+(e?"community":"id")+c.id:null,onClick:s,children:c.name+(n?"":" "+c.lastName)}),a&&Object(k.jsx)(l,{className:"author-info__text",to:o,children:a})]})},te=({community:e,onClick:t,size:s="medium",src:n,userId:a})=>Object(k.jsx)(r.b,{className:"avatar",to:"/"+(e?"community":"id")+a,onClick:t,children:Object(k.jsx)("img",{className:"avatar__img-"+s+" avatar__img",src:n,alt:"Avatar"})}),se=({avatar:e,user:t})=>{const s=Object(o.b)();return t.info.avatar.endsWith(".svg")?Object(k.jsx)("div",{className:"avatar-gallery-btn--default",children:Object(k.jsx)("img",{className:"avatar-gallery-btn__img",src:t.info.avatar,alt:"Avatar"})}):Object(k.jsx)(r.b,{className:"avatar-gallery-btn",to:"#javascript",onClick:n=>{s(i("gallery",{gallery:{author:t,content:[e],initialSlide:0}})),n.preventDefault()},children:Object(k.jsx)("img",{className:"avatar-gallery-btn__img",src:t.info.avatar,alt:"Avatar"})})},ne=({afterIconClass:e,beforeIconClass:t,className:s="",href:n,preset:a="primary",onClick:o,text:c,to:i,type:l="button"})=>{const d=e=>e&&Object(k.jsx)("i",{className:(s&&s+"__icon ")+a+"-button__icon button__icon "+e}),u=n?"a":i?r.b:"button";return Object(k.jsxs)(u,{className:(s&&s+" ")+a+"-button button",href:n,to:i,type:"button"===u?l:null,onClick:o,children:[d(t),Object(k.jsx)("p",{className:(s&&s+"__text ")+a+"-button__text button__text",children:c}),d(e)]})},ae=({className:e,databaseRef:t,disabled:s,emptyButtonText:a,emptyFieldText:o,field:r,ownerId:c,renderInputId:i})=>{const{formState:{errors:l},handleSubmit:d,register:u,reset:m}=Object(C.a)(),j=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[b,f]=Object(n.useState)(!1);return Object(k.jsx)("div",{className:(e?e+" ":"")+"editable-field",children:c!==j||s?Object(k.jsx)("p",{className:(e?e+"__text ":"")+"editable-field__text",children:r||o}):b?Object(k.jsxs)("form",{className:(e?e+"__form ":"")+"editable-field__form",action:"#",method:"post",onSubmit:d((function(e){P.ref(t).set(e[i].trim()||null),f(!1)})),children:[Object(k.jsx)(A,{autoFocus:!0,opts:{obj:$.find((e=>e.id===i)),defaultValue:r,errors:l,placeholder:!0,register:u}}),Object(k.jsxs)("div",{className:(e?e+"__form-buttons ":"")+"editable-field__form-buttons",children:[Object(k.jsx)(ne,{text:"Save",type:"submit"}),Object(k.jsx)(ne,{preset:"secondary",text:"Cancel",onClick:()=>f(!1)})]})]}):Object(k.jsxs)("button",{className:(e?e+"__button ":"")+"editable-field__button",onClick:()=>{f(!0),m()},children:[Object(k.jsx)("i",{className:(e?e+"__icon ":"")+"editable-field__icon fas fa-edit"}),Object(k.jsx)("p",{className:(e?e+"__text ":"")+"editable-field__text",children:r||a})]})})},oe=({addImgPreview:e})=>Object(k.jsxs)("label",{className:"form-photo",htmlFor:"form-photo__input",children:[Object(k.jsx)("button",{className:"form-photo__button",type:"button",onClick:e=>e.target.closest("label").click(),"aria-label":"Photo",children:Object(k.jsx)("i",{className:"form-photo__icon fas fa-camera"})}),Object(k.jsx)("input",{className:"form-photo__input",id:"form-photo__input",type:"file",accept:".jpg, .jpeg, .png",multiple:!0,hidden:!0,onChange:e})]}),re=({bookmarkedItems:e,bookmarkRef:t,children:s,itemId:n})=>{const a=Object(S.useHistory)(),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(k.jsxs)("div",{className:"interaction-submenu",children:[Object(k.jsx)("div",{className:"interaction-submenu__icon",tabIndex:0,children:Object(k.jsx)("i",{className:"fas fa-chevron-down"})}),Object(k.jsxs)("div",{className:"interaction-submenu__wrapper",children:[Object(k.jsx)(ne,{text:((null===e||void 0===e?void 0:e[n])?"Remove from":"Add to")+" bookmarks",onClick:()=>(({bmId:e,bmRef:t,history:s,userBmItems:n,userId:a})=>{if(!a)return void s.push("/");const o=P.ref(`users/user${a}/bookmarks/${t}/${e}`);(null===n||void 0===n?void 0:n[e])?o.remove():o.set({date:R,id:e})})({bmId:n,bmRef:t,history:a,userBmItems:e,userId:o})}),s]})]})},ce=({avatar:e,community:t,userId:s})=>{const a=t?s:null,{addImgPreview:o,imgPreview:r,setImgPreview:c}=D(),i=Object(n.useRef)();function l(e){V({callback:e=>{P.ref("contentData/nextPostId").once("value",(t=>{const n={authorId:s||null,communityId:a,content:e,date:R,id:t.val(),shares:0};P.ref("posts/post"+t.val()).set(n),P.ref("contentData/nextPostId").set(`${parseInt(t.val(),10)+1}`)}))},communityId:a,e:e,imgPreview:r,inputText:i,setImgPreview:c,userId:s})}return Object(k.jsxs)("div",{className:"post-publish",children:[Object(k.jsx)(te,{community:t,size:"small",src:e,userId:s}),Object(k.jsxs)("form",{className:"post-publish__form",action:"#",method:"post",onSubmit:l,children:[Object(k.jsx)("textarea",{className:"post-publish__form-input",placeholder:"Share your thoughts...",maxLength:5e3,onKeyPress:l,onChange:e=>i.current=e.target.value}),Object(k.jsxs)("div",{className:"post-publish__form-footer",children:[Object(k.jsxs)("div",{className:"post-publish__form-footer-inputs",children:[Object(k.jsx)(oe,{addImgPreview:o}),Object(k.jsx)(ne,{text:"Post",type:"submit"})]}),Object(k.jsx)("div",{className:"upload-previews",children:r.map(((e,t)=>Object(k.jsx)(X,{addToPhotosHandler:e=>(({e:e,i:t,imgPreview:s,setImgPreview:n})=>{n(s.map(((s,n)=>(n===t&&(s.addToPhotos=e.target.checked),s))))})({e:e,i:t,imgPreview:r,setImgPreview:c}),imgPreview:e,removeOnClick:()=>c(r.filter((t=>t.result!==e.result)))},t)))})]})]})]})},ie=({onChange:e,onSubmit:t,value:s})=>Object(k.jsxs)("form",{className:"search-bar",action:"#",method:"post",onSubmit:t,children:[Object(k.jsx)("input",{className:"search-bar__input primary-form__input",type:"text",name:"search",placeholder:"Search...",value:s,onChange:e}),Object(k.jsx)("button",{className:"search-bar__button",children:Object(k.jsx)("i",{className:"search-bar__button-icon fas fa-search"})})]}),le=({avatarSize:e="medium",bottomText:t,bottomTextLink:s,children:n,childrenBottom:a,community:o,linksOnClick:c,userInfo:i,wrapperLink:l})=>{const d=l?r.b:"div";return Object(k.jsxs)("div",{className:"user",children:[Object(k.jsx)(te,{community:o,size:e,src:i.avatar,userId:i.id,onClick:c}),Object(k.jsxs)(d,{className:"user__wrapper",to:l,children:[Object(k.jsxs)("div",{className:"user__header",children:[Object(k.jsx)(ee,{community:o,nameIsLink:!l,text:t,textLink:s,userInfo:i,onClick:c}),n]}),a&&Object(k.jsx)("div",{className:"user__bottom",children:a})]})]})};function de(){const e=Object(o.b)(),t=y((e=>e.modal.actionConfirm)),s=y((e=>e.modal.activeModals)),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.password})),{formState:{errors:r},handleSubmit:c,register:i,reset:d}=Object(C.a)(),u=Object(n.useRef)(!1),[m,j]=Object(n.useState)(!1);function b(s){s.password&&O(a)!==s.password?j(!0):(e(l("action-confirm")),null===t||void 0===t||t.callback())}return Object(n.useEffect)((()=>{!u.current&&s.includes("action-confirm")?(u.current=!0,j(!1),d()):u.current=!1}),[s,d]),Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"modal-action-confirm__header",children:Object(k.jsx)("h4",{className:"modal-action-confirm__title",children:"Confirm action"})}),Object(k.jsxs)("div",{className:"modal-action-confirm__wrapper",children:[Object(k.jsx)("p",{className:"modal-action-confirm__text",children:null===t||void 0===t?void 0:t.text}),(null===t||void 0===t?void 0:t.password)&&Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",autoComplete:"off",onSubmit:c(b),children:[Object(k.jsx)(A,{id:"modal-action-confirm__form-input",onInput:()=>j(!1),opts:{obj:$.find((e=>"existingPassword"===e.id)),errors:r,label:!0,labelText:"Enter your password to continue",placeholder:!0,register:i}}),m&&Object(k.jsx)("p",{className:"error-text",children:"Wrong password."})]}),Object(k.jsxs)("div",{className:"modal-action-confirm__buttons",children:[Object(k.jsx)(ne,{afterIconClass:"fas fa-check",preset:"secondary",text:"Yes",type:"submit",onClick:c(b)}),Object(k.jsx)(ne,{afterIconClass:"fas fa-times",preset:"remove",text:"No",onClick:()=>e(l("action-confirm"))})]})]})]})}function ue(){const e=Object(o.b)(),t=y((e=>e.modal.actionError));return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"modal-action-error__header",children:Object(k.jsx)("h4",{className:"modal-action-error__title",children:"Error"})}),Object(k.jsxs)("div",{className:"modal-action-error__wrapper",children:[Object(k.jsx)("p",{className:"modal-action-error__text",children:t}),Object(k.jsx)("div",{className:"modal-action-error__buttons",children:Object(k.jsx)(ne,{afterIconClass:"fas fa-check",text:"OK",onClick:()=>e(l("action-error"))})})]})]})}function me(){const e=Object(o.b)(),t=y((e=>e.modal.changeAvatarCommunityId)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),n=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),{addImgPreview:a,imgPreview:r,setImgPreview:c}=D(!1);return r.length?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(X,{imgPreview:r[0],removeOnClick:()=>c([])}),Object(k.jsx)(ne,{afterIconClass:"fas fa-check",className:"set-button",preset:"secondary",text:"Set as avatar",onClick:function(){e(l("change-avatar")),setTimeout((()=>c([])),300),Z({addToPhotos:!0,communityId:t,file:r[0].file,userId:s,callback:({link:e})=>{const n=t?"communities/community"+t:`users/user${s}/info`;P.ref(`/${n}/avatar`).set(e)}})}})]}):Object(k.jsxs)(k.Fragment,{children:[!t&&n&&Object(k.jsx)(ne,{afterIconClass:"fas fa-images",text:"Choose an existing photo",onClick:()=>e(i("choose-photo"))}),Object(k.jsxs)("label",{className:"modal-change-avatar__upload",htmlFor:"modal-change-avatar__upload-input",children:[Object(k.jsx)(ne,{afterIconClass:"fas fa-upload",preset:"secondary",text:"Upload photo",onClick:e=>{var t;return null===(t=e.target.closest("label"))||void 0===t?void 0:t.click()}}),Object(k.jsx)("input",{className:"modal-change-avatar__upload-input",id:"modal-change-avatar__upload-input",type:"file",accept:".jpg, .jpeg, .png",hidden:!0,onChange:a})]})]})}function je(){const e=Object(o.b)(),t=y((e=>e.modal.activeModals)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.photos})),r=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),c=Object(n.useRef)(!1),[i,d]=Object(n.useState)();return Object(n.useEffect)((()=>{const e=[];Object.keys({...r}).forEach((t=>e.push(null===a||void 0===a?void 0:a[t]))),e.includes(void 0)||(e.sort(((e,t)=>t.date-e.date)),d(e))}),[a,r]),t.includes("choose-photo")&&(c.current=!0),c.current?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"photos__header",children:Object(k.jsx)("h4",{className:"photos__title",children:`Your photos (${null===i||void 0===i?void 0:i.length})`})}),i.length>0&&Object(k.jsx)("div",{className:"photos__items",children:Object(k.jsx)("div",{className:"photos__items-wrapper",children:i.map((t=>Object(k.jsx)("button",{className:"photos__item",onClick:()=>{return n=t.src,P.ref(`/users/user${s}/info/avatar`).set(n),e(l("choose-photo")),void e(l("change-avatar"));var n},children:Object(k.jsx)("div",{className:"photos__item-wrapper",children:Object(k.jsx)("img",{className:"photos__item-img",src:t.src,alt:""})})},t.id)))})})]}):null}function be(){const e=Object(o.b)(),{formState:{errors:t},handleSubmit:s,register:n}=Object(C.a)(),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:s((function(t){t=F(t);for(const e in t)t[e]||(t[e]=null);e(l("create-community")),P.ref("contentData/nextCommunityId").once("value",(e=>{const s={avatar:"img/community-default.svg",creationTime:R,creatorId:a,id:e.val(),...t};P.ref("communities/community"+e.val()).set(s),P.ref("contentData/nextCommunityId").set(`${parseInt(e.val(),10)+1}`)}))})),children:[$.filter((e=>["title","description","shortDescription"].includes(e.id))).map((e=>Object(k.jsx)(A,{opts:{obj:e,errors:t,placeholder:!0,register:n}},e.id))),Object(k.jsx)(ne,{text:"Create community",type:"submit"})]})}var fe=s(59),he=s(56),pe=s(57),ve=s(60),Oe=s(58);function xe(){const e=Object(o.b)(),t=y((e=>e.modal.gallery)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),a=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),r=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),d=Object(n.useRef)(null),u=Object(n.useRef)(null),[m,j]=Object(n.useState)(),[b,f]=Object(n.useState)();function h(){e(l("gallery"))}return Object(n.useEffect)((()=>{m&&b&&(m.params.navigation.prevEl=d.current,m.params.navigation.nextEl=u.current,m.controller.control=b,b.controller.control=m)}),[m,b]),Object(n.useEffect)((()=>{m&&(m[t.content.length>1?"enable":"disable"](),m.update(),m.slideToLoop(t.initialSlide,0))}),[t,m]),t.author?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)(ve.a,{className:"gallery-swiper__container",autoHeight:!0,navigation:{prevEl:d.current,nextEl:u.current},onBeforeInit:e=>{e.params.navigation.prevEl=d.current,e.params.navigation.nextEl=u.current},onSwiper:j,speed:600,children:[t.content.map((n=>{var o;return Object(k.jsxs)(Oe.a,{className:"gallery-swiper__slide",children:[Object(k.jsx)("div",{className:"modal-gallery__img-container",children:Object(k.jsx)("img",{className:"modal-gallery__img",src:n.src,alt:""})}),Object(k.jsxs)("div",{className:"modal-gallery__info",children:[Object(k.jsx)(le,{avatarSize:"small",bottomText:q(n.date),community:!!(null===(o=t.author)||void 0===o?void 0:o.info.title),linksOnClick:h,userInfo:t.author.info}),r===t.author.info.id&&n.src!==a&&(null===c||void 0===c?void 0:c[n.id])&&Object(k.jsx)(ne,{beforeIconClass:"fas fa-user-circle",preset:"secondary",text:"Set as avatar",onClick:()=>{return e=n.src,P.ref(`/users/user${r}/info/avatar`).set(e),void h();var e}}),(r===t.author.info.id||s)&&Object(k.jsx)(ne,{beforeIconClass:"fas fa-trash-alt",preset:"remove",text:"Delete photo",onClick:()=>function(s){const n=t.author.info.title,a=n?"communities/community":"users/user";e(i("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this photo? This action is irreversible!",callback:()=>{P.ref(`${a+t.author.info.id}/photos/${s.id}`).remove(),P.ref(`${a+t.author.info.id}/profilePhotos/${s.id}`).remove(),T.ref("img/"+s.id).delete(),t.author.info.avatar===s.src&&P.ref(`${a+t.author.info.id}/${n?"":"info/"}avatar`).set(n?"img/community-default.svg":"img/user-default.svg"),h()}}}))}(n)})]})]},n.id)})),Object(k.jsx)("button",{className:"gallery-swiper__button-prev swiper-button-prev",ref:d,children:Object(k.jsx)("i",{className:"fas fa-chevron-left"})}),Object(k.jsx)("button",{className:"gallery-swiper__button-next swiper-button-next",ref:u,children:Object(k.jsx)("i",{className:"fas fa-chevron-right"})})]}),Object(k.jsx)(ve.a,{className:"gallery-thumbs__container",breakpoints:{768:{slidesPerView:6}},centeredSlides:!0,onSwiper:f,slidesPerView:4,slideToClickedSlide:!0,spaceBetween:10,speed:600,children:t.content.map((e=>Object(k.jsx)(Oe.a,{className:"gallery-thumbs__slide",children:Object(k.jsx)("button",{className:"gallery-thumbs__slide-button",children:Object(k.jsx)("img",{className:"gallery-thumbs__slide-img",src:e.src,alt:""})})},e.id)))})]}):null}function _e(e,t){const s=P.ref(e),n=s.on("value",(e=>t(e.val())));return()=>s.off("value",n)}function ge({callback:e,fields:t=["info"],userId:s}){const n={},a=[],o=t.map((e=>{const t=e.split("/");return t[t.length-1]}));return t.forEach(((t,r)=>{a.push(_e(`users/user${s}/${t}`,(t=>{n[o[r]]=t,o.map((e=>n[e])).includes(void 0)||e(n.info?n:null)})))})),()=>a.forEach((e=>e()))}fe.a.use([he.a,pe.a]);const Ne=e=>({type:"LOG_IN",user:e}),ye=e=>({type:"LOG_SYNC",user:e});let we,ke,Ie,Ce;var Se=()=>e=>{var t,s;null===(t=ke)||void 0===t||t.off("value",Ie),null===(s=Ce)||void 0===s||s(),document.cookie.split(";").forEach((t=>{try{we=JSON.parse(t.replace("USER_DATA=",""))}catch(s){return void e(ye(null))}""!==we.id?(ke=P.ref(`users/user${we.id}/account`),Ie=ke.orderByValue().equalTo(v(we.password,we.id)).on("value",(t=>{ke.off("value",Ie),t.val()?Ce=ge({fields:["account","bookmarks","friendRequests","info","photos","profilePhotos"],userId:we.id,callback:t=>{var s;(null===t||void 0===t?void 0:t.account.deleted)?e({type:"LOG_OUT"}):t?(e(ye(t)),(null===t||void 0===t||null===(s=t.account.preferences)||void 0===s?void 0:s.darkTheme)?J(!0):J(!1),K()):e({type:"LOG_OUT"})}}):e(ye(null))}))):e(ye(null))}))};let $e,Ee;function Pe(){const e=Object(o.b)(),{formState:{errors:t},handleSubmit:s,register:a}=Object(C.a)(),[r,c]=Object(n.useState)({});return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:s((function(t){var s;t=F(t),null===(s=$e)||void 0===s||s.off("value",Ee),$e=P.ref("users/"),Ee=$e.orderByChild("account/email").equalTo(t.email).on("value",(s=>{$e.off("value",Ee);const n=function(e){const t={...r};return e.password!==e.confirmPassword&&(t.wrongConfirmPassword=!0),c(t),t}(t);s.val()&&(c({...n,emailExists:!0}),n.emailExists=!0),Object.values(n).includes(!0)||(e(l("sign-up")),P.ref("contentData/nextUserId").once("value",(s=>{const n=s.val();t.confirmPassword=null;const a={account:{email:t.email,id:n,password:v(t.password,n),preferences:{darkTheme:!!W()||null},registrationTime:R},info:{avatar:"img/user-default.svg",gender:t.gender,id:n,lastName:t.lastName,lastSeen:R,name:t.name}};P.ref("users/user"+n).set(a),P.ref("contentData/nextUserId").set(`${parseInt(n,10)+1}`),setTimeout((()=>{e(Ne(a)),e(Se())}),300)})))}))})),children:[$.filter((e=>["name","lastName"].includes(e.id))).map((e=>Object(k.jsx)(A,{opts:{obj:e,errors:t,placeholder:!0,register:a}},e.id))),Object(k.jsx)(L,{register:a}),Object(k.jsx)(A,{onInput:()=>c({...r,emailExists:!1}),opts:{obj:$.find((e=>"email"===e.id)),errors:t,placeholder:!0,register:a}}),r.emailExists&&Object(k.jsx)("p",{className:"error-text",children:"This email is already used."}),$.filter((e=>["password","confirmPassword"].includes(e.id))).map((e=>Object(k.jsx)(A,{onInput:()=>c({...r,wrongConfirmPassword:!1}),opts:{obj:e,errors:t,placeholder:!0,register:a}},e.id))),r.wrongConfirmPassword&&Object(k.jsx)("p",{className:"error-text",children:"Wrong confirm password."}),Object(k.jsx)(ne,{text:"Sign up",type:"submit"})]})}function Re(){const e=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(k.jsxs)("div",{className:"modals",children:[!e&&Object(k.jsx)(I,{className:"modal-sign-up modal",modalName:"sign-up",contentClassName:"modal-sign-up__content modal__content",children:Object(k.jsx)(Pe,{})}),e&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(I,{className:"modal-create-community modal",modalName:"create-community",contentClassName:"modal-create-community__content modal__content",children:Object(k.jsx)(be,{})}),Object(k.jsx)(I,{className:"modal-change-avatar modal",modalName:"change-avatar",contentClassName:"modal-change-avatar__content modal__content",children:Object(k.jsx)(me,{})}),Object(k.jsx)(I,{className:"modal-choose-photo modal",modalName:"choose-photo",contentClassName:"modal-choose-photo__content modal__content",children:Object(k.jsx)(je,{})})]}),Object(k.jsx)(I,{className:"modal-gallery modal",modalName:"gallery",contentClassName:"modal-gallery__content modal__content",children:Object(k.jsx)(xe,{})}),Object(k.jsx)(I,{className:"modal-action-confirm modal",modalName:"action-confirm",contentClassName:"modal-action-confirm__content modal__content",children:Object(k.jsx)(de,{})}),Object(k.jsx)(I,{className:"modal-action-error modal",modalName:"action-error",contentClassName:"modal-action-error__content modal__content",children:Object(k.jsx)(ue,{})}),Object(k.jsx)(I,{zoomImg:!0,className:"modal-zoom modal",modalName:"zoom",contentClassName:"modal-zoom__content modal__content"})]})}function Te(){const e=Object(o.b)(),t=y((e=>e.hamburger)),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[a,c]=Object(n.useState)(!0),i=Object(n.useRef)(null),l=Object(n.useCallback)((()=>{c(!1),e({type:"CLOSE_HAMBURGER"})}),[e]);const d=Object(n.useCallback)((e=>{"Escape"===e.key&&t&&l()}),[l,t]);return Object(n.useEffect)((()=>(window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d))),[d]),s?Object(k.jsx)("div",{className:"hamburger"+(!a||t?" hamburger--open":""),onClick:l,children:Object(k.jsx)("div",{className:"hamburger__wrapper"+(t?" hamburger__wrapper--open":""),ref:i,onClick:e=>e.stopPropagation(),onTransitionEnd:function(e){t||e.target!==i.current||(c(!0),b())},children:Object(k.jsxs)("nav",{className:"hamburger__nav",children:[Object(k.jsx)(r.b,{className:"hamburger__nav-link",to:"/id"+s,onClick:l,children:"My Profile"}),Object(k.jsx)(r.b,{className:"hamburger__nav-link",to:"/news",onClick:l,children:"News"}),Object(k.jsx)(r.b,{className:"hamburger__nav-link",to:"/messages",onClick:l,children:"Messages"}),Object(k.jsx)(r.b,{className:"hamburger__nav-link",to:"/friends",onClick:l,children:"Friends"}),Object(k.jsx)(r.b,{className:"hamburger__nav-link",to:"/communities",onClick:l,children:"Communities"}),Object(k.jsx)(r.b,{className:"hamburger__nav-link",to:"/bookmarks",onClick:l,children:"Bookmarks"}),Object(k.jsx)(r.b,{className:"hamburger__nav-link",to:"/search",onClick:l,children:"Search"})]})})}):null}function Le(){const[e,t]=Object(n.useState)("scroll-to-top__button");return Object(n.useEffect)((()=>{const e=setInterval((()=>{t("scroll-to-top__button"+(window.pageYOffset<window.innerHeight?" scroll-to-top__button--hidden":""))}),100);return()=>clearInterval(e)}),[]),Object(k.jsx)("div",{className:"scroll-to-top",children:Object(k.jsx)("div",{className:"page-width",children:Object(k.jsx)("div",{className:"scroll-to-top__wrapper",children:Object(k.jsx)("button",{className:e,"aria-label":"Scroll to top",onClick:function(){document.body.scrollIntoView({behavior:"smooth",block:"start"})},children:Object(k.jsx)("i",{className:"fas fa-chevron-up"})})})})})}function Ae(){return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("footer",{className:"footer",children:Object(k.jsx)("div",{className:"page-width"})}),Object(k.jsx)(Te,{}),Object(k.jsx)(Re,{}),Object(k.jsx)(Le,{})]})}const De=Object(n.createContext)(null);function Me({opts:e={},...t}){let{openState:s,setOpenState:a,submenuClass:o,tag:r}=e;const c=r||n.Fragment;"string"!==typeof o&&(o="submenu");const[i,l]=Object(n.useState)(!1);null!=s&&a||([s,a]=[i,l]);const d=Object(n.useRef)();return Object(k.jsx)(De.Provider,{value:{buttonRef:d,openState:s,setOpenState:a,submenuClass:o},children:Object(k.jsx)(c,{...t})})}function qe({Tag:e,...t}){const{buttonRef:s,openState:a,setOpenState:o,submenuClass:r}=Object(n.useContext)(De);return Object(k.jsx)(e,{...t,ref:s,className:t.className+(a?` ${r}__button--open`:""),onClick:()=>o(!a)})}function ze({Tag:e="div",...t}){const{buttonRef:s,openState:a,setOpenState:o,submenuClass:r}=Object(n.useContext)(De),c=Object(n.useRef)(),i=Object(n.useCallback)((e=>{!s.current||s.current.contains(e.target)||c.current.contains(e.target)||o(!1)}),[s,o]);return Object(n.useEffect)((()=>(window.addEventListener("click",i),()=>window.removeEventListener("click",i))),[i]),Object(k.jsx)(e,{...t,ref:c,className:t.className+(a?` ${r}__wrapper--open`:"")})}function Fe(){const e=Object(o.b)(),t=Object(S.useHistory)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info})),c=Object(n.useRef)(),[i,l]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{if(W()){document.body.style.transitionDuration="0s",K();document.body.scrollHeight;document.body.style.transitionDuration=""}}),[]),Object(k.jsx)("header",{className:"header fixed-item",children:Object(k.jsx)("div",{className:"page-width",children:Object(k.jsxs)("div",{className:"header__wrapper",children:[Object(k.jsx)(r.b,{className:"header__logo",to:s?"/news":"/","aria-label":"Homepage",children:"Social App"}),Object(k.jsxs)("div",{className:"header__right",children:[Object(k.jsx)(ie,{onChange:e=>c.current=e.target.value,onSubmit:function(e){e.preventDefault(),t.push("/search?query="+(c.current||""))}}),void 0===s&&Object(k.jsx)(Ue,{}),s&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"header__user",children:Object(k.jsxs)(Me,{opts:{openState:i,setOpenState:l},children:[Object(k.jsxs)(qe,{Tag:"button",className:"header__user-button",children:[Object(k.jsx)("p",{className:"header__user-button-name",children:a.name}),Object(k.jsx)("img",{className:"avatar__img-small",src:a.avatar,alt:"Avatar"}),Object(k.jsx)("i",{className:"header__user-button-icon fas fa-chevron-down"})]}),Object(k.jsxs)(ze,{className:"header__user-submenu submenu__wrapper",children:[Object(k.jsx)(Ue,{}),Object(k.jsx)(r.b,{className:"header__user-submenu-button",to:"/settings",onClick:()=>l(!1),children:"Settings"}),Object(k.jsx)("button",{className:"header__user-submenu-button",onClick:()=>{l(!1),e({type:"LOG_OUT"}),e(Se()),t.push("/")},children:"Log out"})]})]})}),Object(k.jsx)("button",{className:"header__hamburger","aria-label":"Open navigation",onClick:()=>e({type:"OPEN_HAMBURGER"}),children:Object(k.jsx)("i",{className:"fas fa-bars"})})]})]})]})})})}function Ue(){const e=y((e=>{var t,s,n;return null===(t=e.user)||void 0===t||null===(s=t.account)||void 0===s||null===(n=s.preferences)||void 0===n?void 0:n.darkTheme})),t=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[s,a]=Object(n.useState)("true"===W());return Object(n.useEffect)((()=>{a(t?!0===e:"true"===W())}),[e,t]),Object(k.jsx)("label",{className:"change-theme"+(s?" change-theme--checked":""),children:Object(k.jsxs)("div",{className:"change-theme__wrapper",children:[Object(k.jsx)("input",{className:"change-theme__input",type:"checkbox","aria-label":"Toggle dark theme",checked:s,onChange:function(){if(t){const s=`users/user${t}/account/preferences/darkTheme`;e?P.ref(s).remove():P.ref(s).set(!0),a(!e)}else J(!W()),K(),a(!W())}}),Object(k.jsx)("i",{className:"change-theme__icon fas fa-cloud-moon"})]})})}function He(){const e=Object(o.b)(),t=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));Object(n.useEffect)((()=>{if(!t)return;const e="/users/user"+t;let s;const n=_e(".info/connected",(t=>{var n;t&&(null===(n=s)||void 0===n||n.remove(),s=P.ref(e+"/connections").push(),s.set(!0),s.onDisconnect().remove(),P.ref(e+"/info/lastSeen").onDisconnect().set(R))}));return()=>{s.remove(),P.ref(e+"/info/lastSeen").onDisconnect().cancel(),P.ref(e+"/info/lastSeen").set(R),n()}}),[e,t]);const s=Object(n.useCallback)((()=>{e(Se())}),[e]);return Object(n.useEffect)((()=>(s(),window.addEventListener("storage",s),()=>window.removeEventListener("storage",s))),[s]),null}var Be=Object(n.memo)((()=>{const e=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return e?Object(k.jsx)("nav",{className:"navigation",children:Object(k.jsxs)("div",{className:"navigation__wrapper",children:[Object(k.jsxs)(r.b,{className:"navigation__link",to:"/id"+e,children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-user-circle"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"My Profile"})]}),Object(k.jsxs)(r.b,{className:"navigation__link",to:"/news",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-newspaper"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"News"})]}),Object(k.jsxs)(r.b,{className:"navigation__link",to:"/messages",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-comment"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Messages"})]}),Object(k.jsxs)(r.b,{className:"navigation__link",to:"/friends",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-user-friends"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Friends"})]}),Object(k.jsxs)(r.b,{className:"navigation__link",to:"/communities",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-users"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Communities"})]}),Object(k.jsxs)(r.b,{className:"navigation__link",to:"/bookmarks",children:[Object(k.jsx)("i",{className:"navigation__link-icon fas fa-bookmark"}),Object(k.jsx)("p",{className:"navigation__link-text",children:"Bookmarks"})]})]})}):null}));function Ge(){const e=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(n.useEffect)((()=>document.title="404 Not Found | Social App"),[]),Object(k.jsx)("section",{className:"error-404",children:Object(k.jsxs)("div",{className:"page-width",style:e?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"error-404__wrapper",children:[Object(k.jsx)("p",{className:"error-404__number",children:"404"}),Object(k.jsx)("h2",{className:"error-404__title",children:"Not Found"}),Object(k.jsx)("p",{className:"error-404__text",children:"The requested page was not found on our server. It may have been removed."})]})})]})})}function Ye({communities:e=[],renderSubscribeButton:t=!0,subscribed:s}){const n=Object(o.b)(),a=Object(S.useHistory)(),r=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),c=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.bookmarks)||void 0===s?void 0:s.communities})),l=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(k.jsx)("div",{className:"communities-list",children:e.map((e=>Object(k.jsx)("div",{className:"communities-list__item",children:Object(k.jsx)(le,{childrenBottom:Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("p",{className:"communities-list__item-description",children:e.deleted?"This community has been deleted.":e.shortDescription||"No description provided."}),t&&Object(k.jsx)(ne,{preset:s?"remove":"primary",text:s?"Unsubscribe":"Subscribe",onClick:()=>Q(e.id,a,l,s)})]}),community:!!e.id,userInfo:{...e,lastName:"",name:e.title},children:!e.deleted&&Object(k.jsxs)(re,{bookmarkedItems:c,bookmarkRef:"communities",itemId:e.id,children:[Object(k.jsx)(ne,{text:"Report",onClick:()=>!l&&a.push("/")}),r&&Object(k.jsx)(ne,{text:"Delete community",onClick:()=>{return t=e.id,void n(i("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this community? This action is irreversible!",password:!0,callback:()=>B(t)}}));var t}})]})})},e.id)))})}function Ve({button:e,requestDate:t,singleUser:s,users:n}){const a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=s=>Object(k.jsx)("div",{className:"users-list__item",children:Object(k.jsx)(le,{bottomText:t?q(t):G(s),childrenBottom:Object(k.jsxs)(k.Fragment,{children:["bookmarks"===e&&!t&&Object(k.jsx)(ne,{text:"Remove from bookmarks",onClick:()=>P.ref(`users/user${a}/bookmarks/users/${s.info.id}`).remove()}),t&&Object(k.jsx)(ne,{text:"Accept friend request",onClick:()=>U({reqUserId:s.info.id,userId:a})})]}),userInfo:s.info})},s.info.id);return s?o(s):Object(k.jsx)("div",{className:"users-list",children:n.map((e=>o(e)))})}const Qe=Object(n.createContext)(null);function Je(e){const{loadItem:t,opts:s}=Object(n.useContext)(Qe),a=Object(n.useRef)(),o=Object(n.useRef)(),r=Object(n.useRef)(!1),[c,i]=Object(n.useState)({src:"#",alt:""}),l=Object(n.useCallback)((()=>{window.removeEventListener("load",d),window.removeEventListener("resize",d),window.removeEventListener("scroll",d),clearInterval(a.current)}),[]),d=Object(n.useCallback)((()=>{if(!o.current)return;const t=o.current,n=t.getBoundingClientRect().top+window.pageYOffset+s.scrollOffset-window.innerHeight;window.pageYOffset>=n&&t.offsetParent&&"hidden"!==getComputedStyle(t).visibility&&(r.current=!0,i({src:e.src,alt:e.alt||""}),l())}),[l,s.scrollOffset,e.alt,e.src]);return Object(n.useEffect)((()=>(r.current||(d(),window.addEventListener("load",d),window.addEventListener("resize",d),window.addEventListener("scroll",d),s.autoCheck&&(a.current=setInterval(d,s.autoCheckInterval))),l)),[l,d,s.autoCheck,s.autoCheckInterval]),Object(k.jsx)("img",{ref:o,...e,...c,onLoad:t})}var We=function({opts:e={},tag:t="div",...s}){const a=t,o="string"===typeof e.animationClass?" "+e.animationClass:" lazy-animation";e.autoCheck="boolean"!==typeof e.autoCheck||e.autoCheck,e.autoCheckInterval=Number.isInteger(e.autoCheckInterval)?e.autoCheckInterval:2e3,e.scrollOffset=Number.isInteger(e.scrollOffset)?e.scrollOffset:0;const[r,c]=Object(n.useState)(!1),i=Object(n.useCallback)((()=>c(!0)),[]);return Object(k.jsx)(Qe.Provider,{value:{loadItem:i,opts:e},children:Object(k.jsx)(a,{...s,className:s.className+(r?"":o)})})};function Ke({author:e,content:t,lazyLoadEnabled:s,linkStopPropagation:a,msgIndex:c,renderReplyToAuthorText:l}){const d=Object(o.b)(),u=t.filter((e=>"img"===e.type)).map((t=>Object.values({...e.photos}).find((e=>e.id===t.value)))),m=u.filter((e=>e));return Object(k.jsx)("div",{className:"user-message",children:t.map(((t,o)=>{var j;return Object(k.jsx)(n.Fragment,{children:"text"===t.type?l?l(t,!0):Object(k.jsx)("p",{className:"user-message__text user-message__item",children:t.value}):Object(k.jsxs)(k.Fragment,{children:[l&&0===o&&l(t),u.find((e=>(null===e||void 0===e?void 0:e.id)===t.value))?!s||c<4?Object(k.jsx)(r.b,{className:"user-message__img-container user-message__item",to:"#javascript",onClick:s=>{d(i("gallery",{gallery:{author:e,content:m,initialSlide:m.indexOf(m.find((e=>e.id===t.value)))}})),s.preventDefault(),a&&s.stopPropagation()},children:Object(k.jsx)("img",{className:"user-message__img",src:null===(j=u.find((e=>(null===e||void 0===e?void 0:e.id)===t.value)))||void 0===j?void 0:j.src,alt:""})}):Object(k.jsx)(We,{opts:{scrollOffset:-1e3},tag:r.b,className:"user-message__img-container user-message__item",to:"#javascript",onClick:s=>{d(i("gallery",{gallery:{author:e,content:u,initialSlide:u.indexOf(u.find((e=>e.id===t.value)))}})),s.preventDefault()},children:Object(k.jsx)(Je,{className:"user-message__img",src:u.find((e=>e.id===t.value)).src,alt:""})}):Object(k.jsx)("p",{className:"user-message__deleted-photo user-message__item",children:"Deleted photo"})]})},o)}))})}function Ze({post:e}){const{hash:t}=Object(S.useLocation)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info.avatar})),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{addImgPreview:o,imgPreview:r,setImgPreview:c}=D(),i=Object(n.useRef)(),l=Object(n.useRef)(null),[d,u]=Object(n.useState)(null),[m,j]=Object(n.useState)();function b({commentId:t,e:s,replyText:n,replyToId:o,tempImgPreview:l,tempSetImgPreview:d}){V({callback:s=>{const n=P.ref().push().key;P.ref(`posts/post${e.id}/comments${t?`/${t}/replies`:""}/${n}`).set({authorId:a,content:s,date:R,id:n,replyTo:o||null}),setTimeout((()=>u(null)),0)},e:s,imgPreview:l||r,inputText:n||i,setImgPreview:d||c,userId:a})}Object(n.useEffect)((()=>{"#comments"===t&&setTimeout((()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.scrollIntoView({behavior:"auto",block:"start"})}),0)}),[t]);const f=Object.values({...e.comments}).sort(((e,t)=>t.date-e.date));return Object(k.jsx)("div",{ref:l,className:"post__comments-container",children:Object(k.jsxs)("div",{className:"post__comments",children:[Object(k.jsx)("div",{className:"post__comments-title",children:`Comments (${f.length})`}),Object(k.jsx)("div",{className:"post__comments-wrapper",children:f.map((t=>Object(k.jsx)(Xe,{comment:t,handleSubmit:b,postId:e.id,replyComment:d,selectedReply:m,setReplyComment:u,setSelectedReply:j},t.id)))}),a&&Object(k.jsxs)("div",{className:"post__comments-form-container",children:[Object(k.jsx)(te,{size:"small",src:s,userId:a}),Object(k.jsxs)("form",{className:"post__comments-form",action:"#",method:"post",onSubmit:e=>b({e:e}),children:[Object(k.jsx)("textarea",{className:"post__comments-form-input",placeholder:"Leave a comment...",maxLength:5e3,onKeyPress:e=>b({e:e}),onChange:e=>i.current=e.target.value}),Object(k.jsxs)("div",{className:"post__comments-form-footer",children:[Object(k.jsx)(oe,{addImgPreview:o}),Object(k.jsx)(ne,{text:"Comment",type:"submit"})]}),Object(k.jsx)("div",{className:"upload-previews",children:r.map(((e,t)=>Object(k.jsx)(X,{imgPreview:e,removeOnClick:()=>c(r.filter((t=>t.result!==e.result)))},t)))})]})]})]})})}function Xe({comment:e,handleSubmit:t,postId:s,replyComment:a,selectedReply:c,setReplyComment:l,setSelectedReply:d}){const u=Object(o.b)(),m=Object(S.useHistory)(),j=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),b=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info.avatar})),f=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{addImgPreview:h,imgPreview:p,setImgPreview:v}=D(),O=Object(n.useRef)(),[x,_]=Object(n.useState)(),[g,N]=Object(n.useState)([]),[w,I]=Object(n.useState)([]);function C(s){t({commentId:e.id,e:s,replyText:O,replyToId:a.reply.id,tempImgPreview:p,tempSetImgPreview:v})}Object(n.useEffect)((()=>{const t=Object.values({...e.replies});N(t)}),[e.replies]),Object(n.useEffect)((()=>{const t=ge({fields:["info","photos"],userId:e.authorId,callback:e=>_(e)}),s=[],n=[];return g.forEach(((e,t)=>{s.push(ge({fields:["info","photos"],userId:e.authorId,callback:e=>{n[t]=e,n.length!==g.length||n.includes(void 0)||I([...n])}}))})),()=>{t(),s.forEach((e=>e()))}}),[e.authorId,g]);const $=({replies:t,replyLikes:n,replyTo:o,tempAuthor:_,tempComment:N})=>Object(k.jsxs)("div",{className:"post__comment",children:[Object(k.jsx)(te,{src:_.info.avatar,userId:_.info.id}),Object(k.jsxs)("div",{className:"post__comment-wrapper"+(N.id===c?" post__comment-wrapper--selected":""),children:[Object(k.jsx)(ee,{text:q(N.date),userInfo:_.info}),Object(k.jsx)(Ke,{author:_,content:N.content,renderReplyToAuthorText:(e,t)=>{var s;return Object(k.jsxs)("p",{className:"user-message__text user-message__item",children:[o&&Object(k.jsxs)(r.b,{className:"user-message__reply-to",to:"/id"+o.info.id,children:[Object(k.jsx)("span",{className:"user-message__reply-to-name",children:null===(s=w.find((e=>{var t;return e.info.id===(null===(t=g.find((e=>e.id===N.replyTo)))||void 0===t?void 0:t.authorId)})))||void 0===s?void 0:s.info.name}),", "]}),t&&e.value]})}}),Object(k.jsxs)("div",{className:"post__comment-footer",children:[Object(k.jsxs)("button",{className:"post__comment-footer-button",onClick:(a,o=!t&&N.id)=>Y({condition:!!(n||E).find((e=>e.userId===f)),contentId:e.id,contentRef:`posts/post${s}/comments/${e.id+(o?`/replies/${o}`:"")}/likes/user${f}`,history:m,userId:f,userRef:`users/user${f}/likes/comments/post${s}/${o?`reply${o}`:`comment${e.id}`}`}),children:[Object(k.jsx)("i",{className:"post__comment-footer-button-icon"+((n||E).find((e=>e.userId===f))?" fas fa-heart":" far fa-heart")}),Object(k.jsx)("p",{className:"post__comment-footer-button-text",children:(n||E).length||0})]}),Object(k.jsxs)("button",{className:"post__comment-footer-button",onClick:()=>{return t=N,void(f?l({author:w.find((e=>e.info.id===t.authorId))||x,commentId:e.id,reply:t}):m.push("/"));var t},children:[Object(k.jsx)("i",{className:"post__comment-footer-button-icon fas fa-reply"}),Object(k.jsx)("p",{className:"post__comment-footer-button-text",children:"reply"})]}),(_.info.id===f||j)&&Object(k.jsxs)("button",{className:"post__comment-footer-delete-button",onClick:()=>function(t){const n=P.ref(`posts/post${s}/comments/${e.id}`+(t?"/replies/"+t:""));u(i("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this comment? This action is irreversible!",callback:()=>n.remove()}}))}(t?"":N.id),children:[Object(k.jsx)("i",{className:"post__comment-footer-delete-button-icon fas fa-trash-alt"}),Object(k.jsx)("p",{className:"post__comment-footer-delete-button-text",children:"Delete"})]})]}),(null===t||void 0===t?void 0:t.length)>0&&Object(k.jsx)("div",{className:"post__comment-replies",children:t}),(null===a||void 0===a?void 0:a.commentId)===e.id&&t&&Object(k.jsxs)("div",{className:"post__comments-form-container",children:[Object(k.jsx)(te,{size:"small",src:b,userId:f}),Object(k.jsxs)("form",{className:"post__comments-form",action:"#",method:"post",onSubmit:C,children:[Object(k.jsxs)("button",{className:"post__comments-form-reply-to",type:"button",onClick:()=>{return e=a.reply.id,d(e),void setTimeout((()=>d(null)),0);var e},children:[Object(k.jsx)("p",{className:"post__comments-form-reply-to-text",children:`reply to ${a.author.info.name} ${a.author.info.lastName}`}),Object(k.jsx)("i",{className:"post__comments-form-reply-to-icon fas fa-level-up-alt"})]}),Object(k.jsx)("textarea",{className:"post__comments-form-input",placeholder:"Leave a comment...",maxLength:5e3,onChange:e=>O.current=e.target.value,onKeyPress:C}),Object(k.jsxs)("div",{className:"post__comments-form-footer",children:[Object(k.jsx)(oe,{addImgPreview:h}),Object(k.jsx)(ne,{text:"Reply",type:"submit"})]}),Object(k.jsx)("div",{className:"upload-previews",children:p.map(((e,t)=>Object(k.jsx)(X,{imgPreview:e,removeOnClick:()=>v(p.filter((t=>t.result!==e.result)))},t)))})]})]})]})]},N.id),E=Object.values({...e.likes}),R=[];return g.forEach((e=>R.push(Object.values({...e.likes})))),x?$({tempAuthor:x,tempComment:e,replies:g.map(((e,t)=>w[t]&&$({tempAuthor:w[t],tempComment:e,replyTo:w.find((t=>{var s;return t.info.id===(null===(s=g.find((t=>t.id===e.replyTo)))||void 0===s?void 0:s.authorId)})),replyLikes:R[t]})))}):null}function et({fetchedItems:e,index:t=0,loadingCallback:s,post:a,renderComments:c}){var l;const d=Object(o.b)(),u=Object(S.useHistory)(),m=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),j=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.bookmarks)||void 0===s?void 0:s.posts})),b=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),f=Object(n.useRef)(null),[h,p]=Object(n.useState)();Object(n.useEffect)((()=>{let t;const n=t=>{a.communityId?p({info:{...t,lastName:"",name:t.title},photos:t.photos}):p(t),e.current.incrementQty(a.id,s)};return t=a.communityId?_e("communities/community"+a.communityId,n):ge({fields:["info","photos"],userId:a.authorId,callback:n}),t}),[e,s,a.authorId,a.communityId,a.id]);const v=null===(l=a.views)||void 0===l?void 0:l["user"+b];if(Object(n.useEffect)((()=>{if(!(null===h||void 0===h?void 0:h.info.id)||!b||v)return;let e;const t=new IntersectionObserver((([t])=>{t.isIntersecting?e=setTimeout((()=>{P.ref(`posts/post${a.id}/views/user${b}`).set({date:R,userId:b})}),5e3):clearInterval(e)}),{threshold:.5});return t.observe(f.current),()=>{t.disconnect(),clearTimeout(e)}}),[a.id,null===h||void 0===h?void 0:h.info.id,v,b]),!h)return null;const O=Object.values({...a.likes}),x=Object.values({...a.comments});return Object(k.jsxs)("article",{className:"post",ref:f,children:[Object(k.jsxs)("div",{className:"post__main",children:[Object(k.jsx)(le,{bottomText:q(a.date),bottomTextLink:"/post"+a.id,community:!!a.communityId,userInfo:h.info,children:Object(k.jsx)(re,{bookmarkedItems:j,bookmarkRef:"posts",itemId:a.id,children:(h.info.id===b||h.info.creatorId===b||m)&&Object(k.jsx)(ne,{text:"Delete post",onClick:function(){d(i("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this post? This action is irreversible!",callback:()=>P.ref("posts/post"+a.id).remove()}}))}})})}),Object(k.jsx)(Ke,{author:h,content:a.content,lazyLoadEnabled:!0,msgIndex:t}),Object(k.jsxs)("div",{className:"post__footer",children:[Object(k.jsxs)("div",{className:"post__footer-left",children:[Object(k.jsxs)("button",{className:"post__footer-button post__footer-item",onClick:()=>Y({condition:!!O.find((e=>e.userId===b)),contentId:a.id,contentRef:`posts/post${a.id}/likes/user${b}`,history:u,userId:b,userRef:`users/user${b}/likes/posts/post${a.id}`}),children:[Object(k.jsx)("i",{className:"post__footer-button-icon"+(O.find((e=>e.userId===b))?" fas fa-heart":" far fa-heart")}),Object(k.jsx)("p",{className:"post__footer-button-text",children:O.length})]}),Object(k.jsxs)(r.b,{className:"post__footer-button post__footer-item",to:`/post${a.id}#comments`,children:[Object(k.jsx)("i",{className:"post__footer-button-icon far fa-comment"}),Object(k.jsx)("p",{className:"post__footer-button-text",children:x.length})]}),Object(k.jsxs)("button",{className:"post__footer-button post__footer-item",children:[Object(k.jsx)("i",{className:"post__footer-button-icon far fa-share-square"}),Object(k.jsx)("p",{className:"post__footer-button-text",children:a.shares})]})]}),Object(k.jsx)("div",{className:"post__footer-right",children:Object(k.jsxs)("div",{className:"post__footer-item",children:[Object(k.jsx)("i",{className:"post__footer-button-icon fas fa-eye"}),Object(k.jsx)("p",{className:"post__footer-button-text",children:Object.values({...a.views}).length})]})})]})]}),c&&Object(k.jsx)(Ze,{post:a})]})}function tt(){const e=Object(n.useContext)(c.LoadingContext),t=Object(n.useRef)({qty:[],incrementQty(e,t){this.qty.includes(e)||(this.qty.push(e),this.qty.length===this.expectedQty&&t())},setExpected(e,t){this.expectedQty||(this.expectedQty=e,t&&0===this.expectedQty&&t())}}),s=Object(n.useRef)(),a=Object(n.useCallback)((e=>document.title=e+" | Social App"),[]);return{fetchedItems:t,finishLoading:Object(n.useCallback)((t=>{t&&a(t),s.current=!0,e.done(),window.scrollTo(0,0)}),[e,a]),loaded:s,setTitle:a}}function st(){var e;const t=Object(S.useHistory)(),{search:s}=Object(S.useLocation)(),a=new URLSearchParams(s).get("tab"),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.bookmarks})),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),i=["users","communities"].find((e=>e===a))||"posts",l=Object(n.useRef)(),[d,u]=Object(n.useState)([]),{fetchedItems:m,finishLoading:j}=tt(),b=Object(n.useCallback)((()=>j("Bookmarks")),[j]);Object(n.useEffect)((()=>{if(void 0===c&&t.replace("/"),!c)return;const e=Object.values({...null===o||void 0===o?void 0:o[i]}).sort(((e,t)=>t.date-e.date));e.length||(b(),u([]));const s=[],n=[],a=(t,s,a)=>{n[a]=t||{id:s.id,unavailable:!0},t||m.current.incrementQty(s.id,b),n.length!==e.length||n.includes(void 0)||(u([...n]),["users","communities"].includes(i)?b():m.current.setExpected(n.length,b))};return e.forEach(((e,t)=>{"users"===i?s.push(ge({fields:["connections","info"],userId:e.id,callback:s=>a(s,e,t)})):s.push(_e(("communities"===i?"communities/community":"posts/post")+e.id,(s=>a(s,e,t))))})),()=>s.forEach((e=>e()))}),[i,m,t,b,o,c]),Object(n.useEffect)((()=>l.current=i),[i]);const f=d.filter((e=>!e.unavailable)),h=null===(e=d.filter((e=>e.unavailable)))||void 0===e?void 0:e.length;return Object(k.jsx)("section",{className:"bookmarks",children:Object(k.jsxs)("div",{className:"page-width",children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"bookmarks__wrapper",children:[Object(k.jsxs)("div",{className:"bookmarks__header",children:[Object(k.jsx)("h1",{className:"bookmarks__header-title",children:`${i} bookmarks (${d.length})`}),h>0&&Object(k.jsxs)("p",{className:"bookmarks__header-unavailable",children:[h+" unavailable item(s) are hidden ",Object(k.jsx)("button",{className:"bookmarks__header-unavailable-remove",onClick:function(){d.forEach((e=>e.unavailable&&P.ref(`users/user${c}/bookmarks/${i}/${e.id}`).remove()))},children:"(Remove)."})]})]}),Object(k.jsx)("div",{className:"bookmarks__content",children:i===l.current&&("posts"===i?f.map(((e,t)=>Object(k.jsx)(et,{fetchedItems:m,index:t,loadingCallback:b,post:e},e.id))):"users"===i?Object(k.jsx)(Ve,{button:"bookmarks",users:f}):Object(k.jsx)(Ye,{communities:f}))})]})}),Object(k.jsx)("aside",{className:"sidebar",children:Object(k.jsxs)("div",{className:"sidebar__wrapper",children:[Object(k.jsx)(r.b,{className:"sidebar__button"+("posts"===i?" sidebar__button--active":""),to:"/bookmarks",children:`Posts (${Object.values({...null===o||void 0===o?void 0:o.posts}).length})`}),Object(k.jsx)(r.b,{className:"sidebar__button"+("users"===i?" sidebar__button--active":""),to:"?tab=users",children:`Users (${Object.values({...null===o||void 0===o?void 0:o.users}).length})`}),Object(k.jsx)(r.b,{className:"sidebar__button"+("communities"===i?" sidebar__button--active":""),to:"?tab=communities",children:`Communities (${Object.values({...null===o||void 0===o?void 0:o.communities}).length})`})]})})]})})}function nt(){const e=Object(o.b)(),t=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[s,r]=Object(n.useState)(),[c,l]=Object(n.useState)(),[d,u]=Object(n.useState)(),{finishLoading:m}=tt();return Object(n.useEffect)((()=>{if(null!==t)return _e("communities",(e=>{m("Communities");const s=Object.values({...e}),n=s.filter((e=>e.creatorId!==t));Object(a.unstable_batchedUpdates)((()=>{r(s.filter((e=>e.creatorId===t))),l(n.filter((e=>{var s;return!(null===(s=e.subscribers)||void 0===s?void 0:s["user"+t])&&!e.deleted}))),u(n.filter((e=>{var s;return null===(s=e.subscribers)||void 0===s?void 0:s["user"+t]})))}))}))}),[m,t]),c?Object(k.jsx)("section",{className:"communities",children:Object(k.jsxs)("div",{className:"page-width",style:t?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsxs)("div",{className:"content-width",children:[Object(k.jsxs)("div",{className:"communities__header",children:[Object(k.jsx)("h1",{className:"communities__title",children:"Communities"}),Object(k.jsx)(ne,{text:"Create new community",onClick:()=>e(i("create-community"))})]}),s.length>0&&Object(k.jsxs)("div",{className:"communities__item",children:[Object(k.jsx)("div",{className:"communities__item-header",children:Object(k.jsx)("h2",{className:"communities__item-title",children:`My communities (${s.length})`})}),Object(k.jsx)("div",{className:"communities__item-content",children:Object(k.jsx)(Ye,{communities:s,renderSubscribeButton:!1})})]}),d.length>0&&Object(k.jsxs)("div",{className:"communities__item",children:[Object(k.jsx)("div",{className:"communities__item-header",children:Object(k.jsx)("h2",{className:"communities__item-title",children:`Subscribed (${d.length})`})}),Object(k.jsx)("div",{className:"communities__item-content",children:Object(k.jsx)(Ye,{communities:d,subscribed:!0})})]}),c.length>0&&Object(k.jsxs)("div",{className:"communities__item",children:[Object(k.jsx)("div",{className:"communities__item-header",children:Object(k.jsx)("h2",{className:"communities__item-title",children:`Explore (${c.length})`})}),Object(k.jsx)("div",{className:"communities__item-content",children:Object(k.jsx)(Ye,{communities:c})})]})]})]})}):null}function at(){var e;const t=Object(o.b)(),s=Object(S.useHistory)(),{communityId:a}=Object(S.useParams)(),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),l=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{addImgPreview:d,imgPreview:u,setImgPreview:m}=D(!1),j=Object(n.useRef)(),[b,f]=Object(n.useState)(),[h,p]=Object(n.useState)(),[v,O]=Object(n.useState)(),[x,_]=Object(n.useState)(!1),{fetchedItems:g,finishLoading:N,loaded:w,setTitle:I}=tt(),C=Object(n.useCallback)((()=>N(b.title)),[b,N]);if(Object(n.useEffect)((()=>{if(null===l)return;let e,t,s;const n=_e("communities/community"+a,(n=>{if(j.current=[],null===n||void 0===n?void 0:n.profilePhotos){for(const e in n.profilePhotos){var o;(null===(o=n.photos)||void 0===o?void 0:o[e])&&j.current.push(n.photos[e])}j.current.sort(((e,t)=>t.date-e.date))}f(n),n?((t=>{var s;null===(s=e)||void 0===s||s(),e=ge({userId:t.creatorId,callback:e=>{p([e.info])}})})(n),(()=>{var e;null===(e=t)||void 0===e||e.off("value",s),t=P.ref("posts"),s=t.orderByChild("communityId").equalTo(a).on("value",(e=>{const t=Object.values({...e.val()});O(t.sort(((e,t)=>t.id-e.id))),g.current.setExpected(t.length)}))})()):N()}));return()=>{var a,o;n(),null===(a=e)||void 0===a||a(),null===(o=t)||void 0===o||o.off("value",s)}}),[a,g,N,l]),Object(n.useEffect)((()=>{w.current&&b?I(b.title):v?C():null!==v&&null!==b||N()}),[b,N,w,C,v,I]),void 0===b)return null;if(!b)return Object(k.jsx)(Ge,{});const $=!!(null===(e=b.subscribers)||void 0===e?void 0:e["user"+l]);return Object(k.jsx)("section",{className:"community",children:Object(k.jsxs)("div",{className:"page-width",style:l?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"community__content",children:[Object(k.jsxs)("div",{className:"community__header",children:[l!==b.creatorId&&!c||b.deleted?b.banner&&Object(k.jsx)("div",{className:"community__banner",children:Object(k.jsx)("img",{className:"community__banner-img",src:b.banner.src,alt:""})}):u[0]?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("div",{className:"community__banner",children:Object(k.jsx)("img",{className:"community__banner-img",src:u[0].result,alt:""})}),Object(k.jsxs)("div",{className:"community__header-buttons",children:[Object(k.jsx)(ne,{text:"Confirm banner",onClick:function(){m([]),Z({communityId:a,createId:!1,file:u[0].file,imgPath:"banner",storagePrefix:"community"+a})}}),Object(k.jsx)(ne,{preset:"secondary",text:"Cancel",onClick:()=>m([])})]})]}):Object(k.jsxs)("label",{className:"modal-change-avatar__upload",htmlFor:"community__banner-overlay-input",children:[Object(k.jsxs)("button",{className:"community__banner-button community__banner",onClick:e=>{var t;return null===(t=e.target.closest("label"))||void 0===t?void 0:t.click()},children:[b.banner?Object(k.jsx)("img",{className:"community__banner-img",src:b.banner.src,alt:""}):Object(k.jsx)("p",{className:"community__banner-placeholder",children:"No banner"}),Object(k.jsxs)("div",{className:"community__banner-overlay",children:[Object(k.jsx)("i",{className:"community__banner-overlay-icon far fa-image"}),Object(k.jsx)("p",{className:"community__banner-overlay-text",children:(b.banner?"Change":"Set")+" banner"})]})]}),Object(k.jsx)("input",{className:"community__banner-overlay-input",id:"community__banner-overlay-input",type:"file",accept:".jpg, .jpeg, .png",hidden:!0,onChange:d})]}),Object(k.jsxs)("div",{className:"community__info",children:[Object(k.jsxs)("div",{className:"community__info-content",children:[Object(k.jsx)(se,{avatar:j.current.find((e=>e.src===b.avatar)),user:{info:{...b,lastName:"",name:b.title}}}),Object(k.jsxs)("div",{className:"community__info-text",children:[Object(k.jsx)(ae,{className:"community-title",databaseRef:`communities/community${a}/title`,disabled:b.deleted,field:b.title,ownerId:b.creatorId,renderInputId:"title"}),Object(k.jsx)("p",{className:"community__info-subscribers",children:M("subscriber",Object.keys({...b.subscribers}).length)})]})]}),Object(k.jsx)(ne,{className:"community-subscribe",preset:$?"remove":"primary",text:$?"Unsubscribe":"Subscribe",onClick:()=>Q(a,s,l,$)})]})]}),Object(k.jsxs)("div",{className:"community__description",children:[Object(k.jsx)("h3",{className:"community__description-title",children:"Description"}),Object(k.jsxs)("div",{className:"community__description-wrapper",children:[Object(k.jsx)(ae,{databaseRef:`communities/community${a}/description`,disabled:b.deleted,emptyButtonText:"Set description",emptyFieldText:"No description provided.",field:b.deleted?"This community has been deleted.":b.description,ownerId:b.creatorId,renderInputId:"description"}),x&&Object(k.jsxs)("div",{className:"community__description-short",children:[Object(k.jsx)("h4",{className:"community__description-short-title",children:"Short description:"}),Object(k.jsx)(ae,{databaseRef:`communities/community${a}/shortDescription`,disabled:b.deleted,emptyButtonText:"Set short description",emptyFieldText:"No description provided.",field:b.deleted?"This community has been deleted.":b.shortDescription,ownerId:b.creatorId,renderInputId:"shortDescription"})]}),(l===b.creatorId||c)&&!b.deleted&&Object(k.jsx)("button",{className:"community__description-show",onClick:()=>_(!x),children:(x?"Hide":"Show")+" short description"})]})]}),l===b.creatorId&&!b.deleted&&Object(k.jsx)(ce,{avatar:b.avatar,community:!!a,userId:a}),!b.deleted&&Object(k.jsxs)("div",{className:"community__posts",children:[Object(k.jsx)("div",{className:"community__posts-header",children:Object(k.jsx)(r.b,{className:"community__posts-title",to:"#todo",children:"Posts"})}),null===v||void 0===v?void 0:v.map(((e,t)=>Object(k.jsx)(et,{fetchedItems:g,index:t,loadingCallback:C,post:e},e.id)))]})]})}),Object(k.jsxs)("aside",{className:"community__sidebar sidebar",children:[Object(k.jsx)("h3",{className:"community__sidebar-title",children:`Contacts (${null===h||void 0===h?void 0:h.length})`}),Object(k.jsx)("div",{className:"community__sidebar-content",children:null===h||void 0===h?void 0:h.map((e=>Object(k.jsx)(le,{avatarSize:"small",bottomText:"Creator",userInfo:e},e.id)))}),(l===b.creatorId||c)&&!b.deleted&&Object(k.jsxs)("div",{className:"community__sidebar-buttons",children:[Object(k.jsx)(ne,{text:"Change avatar",onClick:()=>t(i("change-avatar",{changeAvatarCommunityId:a}))}),Object(k.jsx)(ne,{preset:"remove",text:"Delete community",onClick:function(){t(i("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this community? This action is irreversible!",password:!0,callback:()=>B(a)}}))}})]})]})]})})}function ot(){const e=Object(o.b)(),t=Object(S.useHistory)(),{search:s}=Object(S.useLocation)(),r=new URLSearchParams(s).get("interlocutor"),{conversationId:c}=Object(S.useParams)(),l=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),d=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info})),u=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.photos})),m=Object(n.useRef)(),[j,b]=Object(n.useState)(null),[f,h]=Object(n.useState)(null),[p,v]=Object(n.useState)(),[O,x]=Object(n.useState)([]),{addImgPreview:_,imgPreview:g,setImgPreview:N}=D(),w=Object(n.useRef)(),I=Object(n.useRef)(),{finishLoading:C,loaded:$}=tt(),E=Object(n.useCallback)((()=>{b(null),h(null),v([]),$.current||C()}),[C,$]),T=Object(n.useCallback)((e=>{l&&(I.current=ge({fields:["connections","info","photos"],userId:e.participants.find((e=>e!==l)),callback:t=>{$.current||C(e.participants.includes(l)?"Conversation":null),Object(a.unstable_batchedUpdates)((()=>{b(e),h(t),v([{info:d,photos:u},t])}))}}))}),[C,$,l,d,u]);Object(n.useEffect)((()=>{if(!c&&r&&l){if(l!==r)return P.ref("conversations/").once("value",(e=>{const s=Object.values(e.val());for(const n of s)if(n.participants.includes(l)&&n.participants.includes(r))return void t.replace("/conversation"+n.id);T({id:"0",messages:[],nextMessageId:"1",participants:[l,r]})})),()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.call(I)};E()}}),[c,T,t,E,r,l]),Object(n.useEffect)((()=>{if(!c||!l)return;const e=_e("conversations/conversation"+c,(e=>{e&&e.participants.includes(l)?(e.messages=Object.values({...e.messages}).sort(((e,t)=>e.id-t.id)),T(e)):E()}));return()=>{var t;e(),null===(t=I.current)||void 0===t||t.call(I)}}),[c,T,E,l]),Object(n.useEffect)((()=>{c||r||E()}),[c,E,r]);const L=Object(n.useCallback)((()=>!(void 0===l||!p||!f||!(null===j||void 0===j?void 0:j.participants.includes(l)))),[null===j||void 0===j?void 0:j.participants,f,p,l]);function A(e){if(O.find((t=>t.id===e.id))){const t=[...O];t.splice(O.indexOf(e),1),x(t)}else x([...O,e])}Object(n.useEffect)((()=>{void 0===l&&t.push("/")}),[t,l]);const q=Object(n.useRef)(),z=Object(n.useRef)(),F=Object(n.useRef)(),[U,H]=Object(n.useState)(""),[B,Y]=Object(n.useState)(""),Q=Object(n.useCallback)((()=>{Y(`${z.current.offsetHeight}px 0 ${F.current.offsetHeight}px`),H(q.current.offsetWidth)}),[]);return Object(n.useEffect)((()=>{if(L())return window.addEventListener("resize",Q),window.addEventListener("load",Q),()=>{window.removeEventListener("resize",Q),window.removeEventListener("load",Q)}}),[Q,L]),Object(n.useEffect)((()=>{w.current&&setTimeout((()=>{Q(),window.innerHeight<w.current.offsetHeight&&window.scrollTo(0,w.current.offsetHeight)}),0)}),[null===j||void 0===j?void 0:j.id,Q]),p?L()?Object(k.jsx)("section",{className:"conversation fixed-item",ref:w,children:Object(k.jsxs)("div",{className:"page-width",children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",ref:q,children:Object(k.jsxs)("div",{className:"conversation__wrapper",children:[Object(k.jsx)("div",{className:"conversation__header",ref:z,style:{width:U},children:Object(k.jsxs)("div",{className:"conversation__header-wrapper",children:[Object(k.jsxs)("div",{className:"conversation__header-interlocutor",children:[Object(k.jsx)(te,{size:"small",src:f.info.avatar,userId:f.info.id}),Object(k.jsx)(ee,{text:G(f),userInfo:f.info})]}),O.length>0&&Object(k.jsxs)("div",{className:"conversation__header-overlay",children:[Object(k.jsxs)("button",{className:"conversation__header-overlay-qty",onClick:()=>x([]),children:[Object(k.jsx)("i",{className:"conversation__header-overlay-qty-icon",children:"\xd7"}),M("message",O.length)]}),Object(k.jsx)("div",{className:"conversation__header-overlay-buttons",children:Object(k.jsx)(ne,{afterIconClass:"fas fa-trash-alt",preset:"remove",text:"Delete forever",onClick:function(){O.find((e=>e.authorId!==l))?e(i("action-error",{actionError:"You can't delete someone else's messages. Try to select only your own messages and try again."})):e(i("action-confirm",{actionConfirm:{text:`Are you sure you want to delete ${M("message",O.length)}? This action is irreversible!`,callback:()=>{x([]);for(const e of O)P.ref(`conversations/conversation${c}/messages/message${e.id}`).remove()}}}))}})})]})]})}),Object(k.jsx)("div",{className:"conversation__content",style:{padding:B},children:j.messages.map(((e,t)=>Object(k.jsx)(rt,{index:t,message:e,participants:p,previousMessage:j.messages[t-1],selectedMessages:O,selectMessage:A},e.id)))}),Object(k.jsx)("div",{className:"conversation__footer",ref:F,style:{width:U},children:Object(k.jsx)("div",{className:"conversation__footer-wrapper",children:Object(k.jsxs)("form",{className:"conversation__footer-form",action:"#",method:"post",children:[Object(k.jsx)(oe,{addImgPreview:_}),Object(k.jsx)("textarea",{className:"conversation__footer-form-input",placeholder:"Your message...",maxLength:5e3,onKeyPress:function(e){function s(e,t){const s={authorId:l,content:e,date:R,id:j.nextMessageId};P.ref(`conversations/conversation${t}/lastMessage`).set(s),P.ref(`conversations/conversation${t}/messages/message${j.nextMessageId}`).set(s),P.ref(`conversations/conversation${t}/nextMessageId`).set(`${parseInt(j.nextMessageId,10)+1}`),setTimeout((()=>{window.innerHeight<w.current.offsetHeight&&window.scrollTo(0,w.current.offsetHeight)}),0)}m.current=e.target.value,V({callback:e=>{j.id&&"0"!==j.id?s(e,c):P.ref("contentData/nextConversationId").once("value",(n=>{P.ref("conversations/conversation"+n.val()).set({id:n.val(),participants:p.map((e=>e.info.id))}),P.ref("contentData/nextConversationId").set(`${parseInt(n.val(),10)+1}`),s(e,n.val()),t.replace("/conversation"+n.val())}))},e:e,imgPreview:g,inputText:m,setImgPreview:N,userId:l})}}),Object(k.jsx)("div",{className:"upload-previews",children:g.map(((e,t)=>Object(k.jsx)(X,{imgPreview:e,removeOnClick:()=>N(g.filter((t=>t.result!==e.result)))},t)))})]})})})]})})]})}):Object(k.jsx)(Ge,{}):null}function rt({index:e,message:t,participants:s,previousMessage:n,selectedMessages:a,selectMessage:o}){const r=s.find((e=>e.info.id===t.authorId)),c=0===e||t.authorId!==n.authorId||t.date>n.date+3e5;return Object(k.jsxs)("button",{className:"conversation__message"+(a.find((e=>e.id===t.id))?" conversation__message--selected":""),onClick:()=>o(t),children:[c&&Object(k.jsx)(te,{size:"small",src:s.find((e=>e.info.id===t.authorId)).info.avatar,userId:t.authorId,onClick:e=>e.stopPropagation()}),Object(k.jsxs)("div",{className:"conversation__message-wrapper",children:[c&&Object(k.jsx)(ee,{onlyName:!0,text:q(t.date),userInfo:s.find((e=>e.info.id===t.authorId)).info,onClick:e=>e.stopPropagation()}),Object(k.jsx)(Ke,{author:r,content:t.content,linkStopPropagation:!0})]})]})}function ct(){const{search:e}=Object(S.useLocation)(),{ownerId:t}=Object(S.useParams)(),s=new URLSearchParams(e).get("tab"),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.friendRequests})),[c,i]=Object(n.useState)(),[l,d]=Object(n.useState)(!1),u=Object(n.useRef)(""),{fetchedItems:m,finishLoading:j,loaded:b,setTitle:f}=tt(),h=Object(n.useCallback)((()=>j(u.current)),[j]);if(Object(n.useEffect)((()=>{if(null!==a)return ge({fields:["friends","info"],userId:t||a,callback:e=>i(e)})}),[m,t,a]),Object(n.useEffect)((()=>{(null===c||void 0===c?void 0:c.info.id)?(u.current=c.info.id===a?"requests"===s?"My friend requests":"My friends":`${c.info.name} ${c.info.lastName}'s friends`,b.current&&f(u.current),l||d(!0),m.current.setExpected(Object.keys("requests"===s?{...null===o||void 0===o?void 0:o.received}:{...c.friends}).length,h)):null===c&&(d(!0),j())}),[m,j,c,b,h,s,f,l,null===o||void 0===o?void 0:o.received,a]),!l)return null;if(!c)return Object(k.jsx)(Ge,{});const p=Object.values({...c.friends}),v=Object.values({...null===o||void 0===o?void 0:o.received}),O=c.info.id===a&&"requests"===s;return Object(k.jsx)("section",{className:"friends",children:Object(k.jsxs)("div",{className:"page-width",style:a?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"friends__wrapper",children:[Object(k.jsx)("div",{className:"friends__header",children:Object(k.jsx)(r.b,{className:"friends__title",to:"/id"+c.info.id,children:O?`Your friend requests (${v.length})`:(c.info.id!==a?`${c.info.name}'s`:"Your")+` friends (${p.length})`})}),(O?v:p).length>0&&Object(k.jsx)("div",{className:"users-list",children:(O?v:p).map((e=>Object(k.jsx)(it,{fetchedItems:m,friendId:e.userId,friendRequestDate:O&&e.date,loadingCallback:h},e.userId)))})]})}),c.info.id===a&&Object(k.jsx)("aside",{className:"sidebar",children:Object(k.jsxs)("div",{className:"sidebar__wrapper",children:[Object(k.jsx)(r.b,{className:"sidebar__button"+("requests"!==s?" sidebar__button--active":""),to:"/friends",children:`Friends (${p.length})`}),Object(k.jsx)(r.b,{className:"sidebar__button"+("requests"===s?" sidebar__button--active":""),to:"?tab=requests",children:`Friend requests (${v.length})`})]})})]})})}function it({fetchedItems:e,friendId:t,friendRequestDate:s,loadingCallback:a}){const[o,r]=Object(n.useState)();return Object(n.useEffect)((()=>ge({fields:["connections","info"],userId:t,callback:s=>{r(s),e.current.incrementQty(t,a)}})),[e,t,a]),o?Object(k.jsx)(Ve,{requestDate:s,singleUser:o}):null}let lt,dt;function ut(){const e=Object(o.b)(),t=Object(S.useHistory)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{formState:{errors:a},handleSubmit:c,register:l}=Object(C.a)(),[d,u]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{s?t.replace("/news"):void 0===s&&(document.title="Log in | Social App")}),[t,s]),void 0!==s?null:Object(k.jsx)("section",{className:"home",children:Object(k.jsx)("div",{className:"page-width",children:Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"home__wrapper",children:[Object(k.jsxs)("div",{className:"home__info",children:[Object(k.jsx)("h1",{className:"home__info-title",children:"Social App"}),Object(k.jsx)("p",{className:"home__info-text",children:"Connect with your friends and communities on Social App."})]}),Object(k.jsxs)("div",{className:"home__content",children:[Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:c((function(s){var n;function a(n){(null===n||void 0===n?void 0:n.account.email)===s.email&&O(n.account.password)===s.password?(e(Ne(n)),e(Se()),t.replace("/news")):u(!0)}null===(n=lt)||void 0===n||n.off("value",dt),lt=P.ref("users"),dt=lt.orderByChild("account/email").equalTo(s.email).on("value",(e=>{lt.off("value",dt),e.val()?Object.values(e.val()).forEach((e=>a(e))):a()}))})),children:[Object(k.jsx)(A,{autoFocus:!0,id:"home__form-email",onInput:()=>u(!1),opts:{obj:$.find((e=>"email"===e.id)),errors:a,label:!0,placeholder:!0,register:l}}),Object(k.jsx)(A,{id:"home__form-password",onInput:()=>u(!1),opts:{obj:$.find((e=>"existingPassword"===e.id)),errors:a,label:!0,placeholder:!0,register:l}}),d&&Object(k.jsx)("p",{className:"error-text",children:"Wrong email or password."}),Object(k.jsx)(ne,{text:"Log in",type:"submit"})]}),Object(k.jsx)(r.b,{className:"home__content-forgot-password",to:"#todo",children:"Forgot password?"}),Object(k.jsx)("hr",{className:"home__content-hr"}),Object(k.jsx)(ne,{preset:"secondary",text:"Sign up",onClick:()=>e(i("sign-up"))})]})]})})})})}function mt(){const e=Object(S.useHistory)(),t=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[a,o]=Object(n.useState)(),{fetchedItems:r,finishLoading:c}=tt(),i=Object(n.useCallback)((()=>c("Messages")),[c]);return Object(n.useEffect)((()=>{if(!s)return;const e=P.ref("conversations/"),t=e.on("value",(e=>{const t=Object.values(e.val()).filter((e=>e.participants.includes(s)));t.sort(((e,t)=>t.lastMessage.date-e.lastMessage.date)),o(t),r.current.setExpected(t.length,i)}));return()=>e.off("value",t)}),[r,i,s]),Object(n.useEffect)((()=>{void 0===s&&e.push("/")}),[e,s]),void 0!==s&&a?Object(k.jsx)("section",{className:"messages",children:Object(k.jsxs)("div",{className:"page-width",children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsx)("div",{className:"messages__wrapper",children:a.length?a.map((e=>Object(k.jsx)(jt,{conversation:e,fetchedItems:r,loadingCallback:i,userAvatar:t,userId:s},e.id))):Object(k.jsx)("p",{className:"no-content",children:"No messages"})})})]})}):null}function jt({conversation:e,fetchedItems:t,loadingCallback:s,userAvatar:a,userId:o}){const[r,c]=Object(n.useState)();return Object(n.useEffect)((()=>ge({userId:e.participants.find((e=>e!==o)),callback:e=>{c(e.info),t.current.incrementQty(e.info.id,s)}})),[e.participants,t,s,o]),r?Object(k.jsx)("div",{className:"messages__item",children:Object(k.jsx)(le,{bottomText:e.lastMessage&&q(e.lastMessage.date,!0),childrenBottom:e.messages?Object(k.jsxs)("div",{className:"messages__item-last-message",children:[Object(k.jsx)("img",{className:"avatar__img-small",src:e.lastMessage.authorId===o?a:r.avatar,alt:"Avatar"}),Object(k.jsx)("p",{className:"messages__item-last-message-content",children:"text"===e.lastMessage.content[0].type?e.lastMessage.content[0].value:"Photo"})]}):Object(k.jsx)("p",{className:"messages__item-no-messages",children:"No messages yet"}),userInfo:r,wrapperLink:"/conversation"+e.id})}):null}function bt(){const e=Object(S.useHistory)(),t=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[a,o]=Object(n.useState)([]),{fetchedItems:r,finishLoading:c}=tt(),i=Object(n.useCallback)((()=>c("News")),[c]);return Object(n.useEffect)((()=>{if(void 0===s&&e.replace("/"),s)return _e("posts/",(e=>{const t=Object.values(e);o(t.sort(((e,t)=>t.id-e.id))),r.current.setExpected(t.length,i)}))}),[r,e,i,s]),s&&a.length?Object(k.jsx)("section",{className:"news",children:Object(k.jsxs)("div",{className:"page-width",children:[Object(k.jsx)(Be,{}),Object(k.jsxs)("div",{className:"content-width",children:[Object(k.jsx)(ce,{avatar:t,userId:s}),a.map(((e,t)=>Object(k.jsx)(et,{fetchedItems:r,index:t,loadingCallback:i,post:e},e.id)))]})]})}):null}function ft(){const e=Object(o.b)(),{ownerId:t}=Object(S.useParams)(),s=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[a,c]=Object(n.useState)(),[l,d]=Object(n.useState)();Object(n.useEffect)((()=>{if(null!==s)return ge({fields:["info","photos","profilePhotos"],userId:t||s,callback:e=>{const t=[];for(const s in null===e||void 0===e?void 0:e.profilePhotos)(null===e||void 0===e?void 0:e.photos)&&t.push(e.photos[s]);t.sort(((e,t)=>t.date-e.date)),c(t),d(e)}})}),[t,s]);const{finishLoading:u,loaded:m,setTitle:j}=tt();return Object(n.useEffect)((()=>{const e=t!==s&&t?`${null===l||void 0===l?void 0:l.info.name} ${null===l||void 0===l?void 0:l.info.lastName}'s photos`:"My photos";m.current?j(e):l?u(e):null===l&&u()}),[m,t,l,u,s,j]),void 0===l?null:l?Object(k.jsx)("section",{className:"photos",children:Object(k.jsxs)("div",{className:"page-width",style:s?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"photos__wrapper",children:[Object(k.jsx)("div",{className:"photos__header",children:Object(k.jsx)(r.b,{className:"photos__title",to:"/id"+l.info.id,children:(t!==s&&t?`${l.info.name}'s`:"My")+` photos (${null===a||void 0===a?void 0:a.length})`})}),a.length>0&&Object(k.jsx)("div",{className:"photos__items",children:Object(k.jsx)("div",{className:"photos__items-wrapper",children:a.map(((t,s)=>Object(k.jsx)(r.b,{className:"photos__item",to:"#javascript",onClick:t=>{e(i("gallery",{gallery:{author:l,content:a,initialSlide:s}})),t.preventDefault()},children:Object(k.jsx)("div",{className:"photos__item-wrapper",children:Object(k.jsx)("img",{className:"photos__item-img",src:t.src,alt:""})})},t.id)))})})]})})]})}):Object(k.jsx)(Ge,{})}function ht(){const{postId:e}=Object(S.useParams)(),t=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[s,a]=Object(n.useState)(),{fetchedItems:o,finishLoading:r}=tt(),c=Object(n.useCallback)((()=>r("Post")),[r]);return Object(n.useEffect)((()=>_e("posts/post"+e,(e=>{e?(a(e),o.current.setExpected(1)):(r(),a(null))}))),[o,r,e]),void 0===s?null:null===s?Object(k.jsx)(Ge,{}):Object(k.jsx)("section",{className:"post-page",children:Object(k.jsxs)("div",{className:"page-width",style:t?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsx)(et,{fetchedItems:o,loadingCallback:c,post:s,renderComments:!0})})]})})}function pt({profileOwner:e,profilePhotos:t}){var s,n,a,c;const l=Object(o.b)(),{ownerId:d}=Object(S.useParams)(),u=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.friendRequests})),m=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));function j(){l(i("action-confirm",{actionConfirm:{text:"Are you sure you want to remove this friend?",callback:()=>{P.ref(`users/user${d}/friends/user${m}`).remove(),P.ref(`users/user${m}/friends/user${d}`).remove()}}}))}const b=Object.values({...e.friends});return Object(k.jsxs)("div",{className:"profile__left",children:[Object(k.jsx)(se,{avatar:t.current.find((t=>t.src===e.info.avatar)),user:e}),Object(k.jsx)("div",{className:"profile__left-online-status",children:Object(k.jsx)("p",{className:"profile__left-online-status-text",children:G(e)})}),e.info.deleted?(null===(c=e.friends)||void 0===c?void 0:c["user"+m])&&Object(k.jsx)("div",{className:"profile__left-buttons",children:Object(k.jsx)(ne,{afterIconClass:"fas fa-user-minus",preset:"remove",text:"Remove friend",onClick:j})}):Object(k.jsxs)(k.Fragment,{children:[m&&(d!==m?Object(k.jsxs)("div",{className:"profile__left-buttons",children:[(null===(s=e.friends)||void 0===s?void 0:s["user"+m])?Object(k.jsx)(ne,{afterIconClass:"fas fa-user-minus",preset:"remove",text:"Remove friend",onClick:j}):(null===u||void 0===u||null===(n=u.received)||void 0===n?void 0:n["user"+d])?Object(k.jsx)(ne,{afterIconClass:"fas fa-user-plus",text:"Accept friend request",onClick:()=>U({reqUserId:d,userId:m})}):(null===u||void 0===u||null===(a=u.sent)||void 0===a?void 0:a["user"+d])?Object(k.jsx)(ne,{afterIconClass:"fas fa-user-times",preset:"remove",text:"Cancel friend request",onClick:function(){P.ref(`users/user${d}/friendRequests/received/user${m}`).remove(),P.ref(`users/user${m}/friendRequests/sent/user${d}`).remove()}}):Object(k.jsx)(ne,{afterIconClass:"fas fa-user-plus",text:"Add friend",onClick:function(){P.ref(`users/user${d}/friendRequests/received/user${m}`).set({date:R,userId:m}),P.ref(`users/user${m}/friendRequests/sent/user${d}`).set({date:R,userId:d})}}),Object(k.jsx)(ne,{afterIconClass:"far fa-comment-alt",text:"Send message",to:"/conversation?interlocutor="+d})]}):Object(k.jsx)("div",{className:"profile__left-buttons",children:Object(k.jsx)(ne,{afterIconClass:"fas fa-portrait",preset:"secondary",text:"Change avatar",onClick:()=>l(i("change-avatar"))})})),Object(k.jsxs)("div",{className:"profile__left-friends",children:[Object(k.jsx)("div",{className:"profile__left-friends-header",children:Object(k.jsx)(r.b,{className:"profile__left-friends-title",to:"/friends"+(d!==m?d:""),children:`Friends (${b.length})`})}),b.length>0&&Object(k.jsx)("div",{className:"profile__left-friends-items",children:Object(k.jsx)("div",{className:"profile__left-friends-items-wrapper",children:b.map((e=>Object(k.jsx)(vt,{friendId:e.userId},e.userId)))})})]})]})]})}function vt({friendId:e}){const[t,s]=Object(n.useState)();return Object(n.useEffect)((()=>ge({userId:e,callback:e=>s(e.info)})),[e]),t?Object(k.jsxs)("div",{className:"profile__left-friends-item",children:[Object(k.jsx)(te,{size:"small",src:t.avatar,userId:e}),Object(k.jsx)(r.b,{className:"profile__left-friends-item-name",to:"/id"+e,children:t.name})]}):null}function Ot(){var e;const t=Object(o.b)(),s=Object(S.useHistory)(),{ownerId:a}=Object(S.useParams)(),c=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),l=y((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.bookmarks)||void 0===s?void 0:s.users})),d=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),u=Object(n.useRef)(),m=Object(n.useRef)(),j=Object(n.useRef)(),[b,f]=Object(n.useState)(),[h,p]=Object(n.useState)(),{fetchedItems:v,finishLoading:O,loaded:x,setTitle:_}=tt(),g=Object(n.useCallback)((()=>{O((null===h||void 0===h?void 0:h.info.name)+" "+(null===h||void 0===h?void 0:h.info.lastName))}),[O,null===h||void 0===h?void 0:h.info.lastName,null===h||void 0===h?void 0:h.info.name]),N=Object(n.useCallback)((e=>{if(e){if(document.activeElement.blur(),j.current=[],e.profilePhotos){for(const s in e.profilePhotos){var t;(null===(t=e.photos)||void 0===t?void 0:t[s])&&j.current.push(e.photos[s])}j.current.sort(((e,t)=>t.date-e.date))}u.current=P.ref("posts/"),m.current=u.current.orderByChild("authorId").equalTo(a).on("value",(e=>{const t=Object.values({...e.val()});f(t.sort(((e,t)=>t.id-e.id))),v.current.setExpected(t.length)}))}else p(null)}),[v,a]);return Object(n.useEffect)((()=>{x.current?_((null===h||void 0===h?void 0:h.info.name)+" "+(null===h||void 0===h?void 0:h.info.lastName)):b?g():null!==b&&null!==h||O()}),[O,x,g,a,b,h,_,d]),Object(n.useEffect)((()=>{if(null===d)return;const e=ge({fields:["connections","friends","info","photos","profilePhotos"],userId:a,callback:e=>{var t;null===(t=u.current)||void 0===t||t.off("value",m.current),N(e),p(e)}});return()=>{var t;e(),null===(t=u.current)||void 0===t||t.off("value",m.current)}}),[a,N,d]),void 0===h?null:h?Object(k.jsx)("section",{className:"profile",children:Object(k.jsxs)("div",{className:"page-width",style:d?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"profile__wrapper",children:[Object(k.jsx)(pt,{profileOwner:h,profilePhotos:j}),Object(k.jsxs)("div",{className:"profile__content",children:[Object(k.jsxs)("div",{className:"profile__content-info",children:[Object(k.jsxs)("div",{className:"profile__content-info-header",children:[Object(k.jsxs)("div",{className:"profile__content-info-header-container",children:[Object(k.jsx)("h1",{className:"profile__content-info-header-name",children:`${h.info.name} ${h.info.lastName}`}),a!==d&&!h.info.deleted&&Object(k.jsxs)(re,{bookmarkedItems:l,bookmarkRef:"users",itemId:a,children:[Object(k.jsx)(ne,{text:"Report",onClick:()=>!d&&s.push("/")}),c&&Object(k.jsx)(ne,{text:"Delete user",onClick:function(){t(i("action-confirm",{actionConfirm:{text:"Are you sure you want to delete this account? This action is irreversible!",password:!0,callback:()=>{H({posts:b,userId:a})}}}))}})]})]}),Object(k.jsx)(ae,{className:"user-status",databaseRef:`users/user${a}/info/status`,emptyButtonText:"Set status",field:h.info.status,ownerId:a,renderInputId:"status"})]}),(h.info.birthday||h.info.country||h.info.city)&&Object(k.jsxs)("div",{className:"profile__content-info-middle",children:[h.info.birthday&&Object(k.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(k.jsx)("span",{className:"profile__content-info-middle-item-title",children:"Birthday: "}),Object(k.jsx)("span",{className:"profile__content-info-middle-item-value",children:h.info.birthday})]}),h.info.country&&Object(k.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(k.jsx)("span",{className:"profile__content-info-middle-item-title",children:"Country: "}),Object(k.jsx)("span",{className:"profile__content-info-middle-item-value",children:h.info.country})]}),h.info.city&&Object(k.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(k.jsx)("span",{className:"profile__content-info-middle-item-title",children:"City: "}),Object(k.jsx)("span",{className:"profile__content-info-middle-item-value",children:h.info.city})]})]}),Object(k.jsxs)("div",{className:"profile__content-info-footer",children:[(null===(e=h.friendRequests)||void 0===e?void 0:e.received)&&Object(k.jsxs)("div",{className:"profile__content-info-footer-item",children:[Object(k.jsx)("p",{className:"profile__content-info-footer-item-number",children:Object.keys(h.friendRequests.received).length}),Object(k.jsx)("p",{className:"profile__content-info-footer-item-title",children:"followers"})]}),h.profilePhotos&&Object(k.jsxs)(r.b,{className:"profile__content-info-footer-button",to:"/photos"+(a!==d?a:""),children:[Object(k.jsx)("p",{className:"profile__content-info-footer-button-number",children:Object.keys(h.profilePhotos).length}),Object(k.jsx)("p",{className:"profile__content-info-footer-button-title",children:"photos"})]}),Object(k.jsxs)(r.b,{className:"profile__content-info-footer-button",to:"#todo",children:[Object(k.jsx)("p",{className:"profile__content-info-footer-button-number",children:(null===b||void 0===b?void 0:b.length)||0}),Object(k.jsx)("p",{className:"profile__content-info-footer-button-title",children:"posts"})]})]})]}),!h.info.deleted&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("div",{className:"profile__content-photos",children:[Object(k.jsx)(r.b,{className:"profile__content-photos-title",to:"/photos"+(a!==d?a:""),children:"Photos: "+Object.keys({...h.profilePhotos}).length}),Object(k.jsx)("div",{className:"profile__content-photos-container",children:j.current.map(((e,s)=>s<4&&Object(k.jsx)(r.b,{className:"profile__content-photos-img-container",to:"#javascript",onClick:e=>{t(i("gallery",{gallery:{author:h,content:j.current,initialSlide:s}})),e.preventDefault()},children:Object(k.jsx)("div",{className:"profile__content-photos-img-inner-container",children:Object(k.jsx)("img",{className:"profile__content-photos-img",src:e.src,alt:""})})},e.id)))})]}),Object(k.jsxs)("div",{className:"profile__content-posts",children:[Object(k.jsx)("div",{className:"profile__content-posts-header",children:Object(k.jsx)(r.b,{className:"profile__content-posts-title",to:"#todo",children:"Posts"})}),null===b||void 0===b?void 0:b.map(((e,t)=>Object(k.jsx)(et,{fetchedItems:v,index:t,loadingCallback:g,post:e},e.id)))]})]})]})]})})]})}):Object(k.jsx)(Ge,{})}function xt(){const e=Object(S.useHistory)(),{finishLoading:t}=tt(),{search:s}=Object(S.useLocation)(),a=new URLSearchParams(s).get("query"),o=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[r,c]=Object(n.useState)(),[i,l]=Object(n.useState)(""),d=Object(n.useCallback)((e=>!a||e.toLowerCase().includes(a.toLowerCase())),[a]);return Object(n.useEffect)((()=>{const e=[];let t=!1;return P.ref("contentData/nextUserId").once("value",(s=>{if(t)return;const n=parseInt(s.val(),10)-1,a=[!0],o=[];for(let t=1;t<=n;t++)e[t]=ge({fields:["connections","info"],userId:`${t}`,callback:e=>{a[t]||e.info.deleted||!d(e.info.name)&&!d(e.info.lastName)||o.push(e),a[t]=!0,a.includes(void 0)||a.length-1!==n||c(o)}})})),()=>{t=!0,e.forEach((e=>e()))}}),[d]),Object(n.useEffect)((()=>{r&&t(a?"Search results for "+a:"Search")}),[t,r,a]),Object(n.useEffect)((()=>l(a||"")),[a]),Object(n.useEffect)((()=>{const t=setTimeout((()=>{e.push("?query="+(i||""))}),250);return()=>clearTimeout(t)}),[e,i]),null===o?null:Object(k.jsx)("section",{className:"search",children:Object(k.jsxs)("div",{className:"page-width",style:o?{}:{justifyContent:"center"},children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"search__wrapper",children:[Object(k.jsxs)("div",{className:"search__header",children:[Object(k.jsx)("h1",{className:"search__title",children:`Search users (${null===r||void 0===r?void 0:r.length})`}),Object(k.jsx)(ie,{onChange:e=>l(e.target.value),onSubmit:e=>e.preventDefault(),value:i})]}),Object(k.jsx)("div",{className:"search__content",children:(null===r||void 0===r?void 0:r.length)?Object(k.jsx)(Ve,{users:r}):Object(k.jsx)("p",{className:"search__no-results",children:"No results."})})]})})]})})}function _t(){const e=Object(S.useHistory)(),{search:t}=Object(S.useLocation)(),s=new URLSearchParams(t).get("tab"),a=y((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{finishLoading:o}=tt(),c=["account","security"].find((e=>e===s))||"information";return Object(n.useEffect)((()=>{void 0===a?e.push("/"):a&&o("Settings")}),[o,e,a]),a?Object(k.jsx)("section",{className:"settings",children:Object(k.jsxs)("div",{className:"page-width",children:[Object(k.jsx)(Be,{}),Object(k.jsx)("div",{className:"content-width",children:Object(k.jsxs)("div",{className:"settings__wrapper",children:[Object(k.jsx)("div",{className:"settings__header",children:Object(k.jsxs)("h1",{className:"settings__title",children:["information"===c&&"Main information","security"===c&&"Security","account"===c&&"Account"]})}),"information"===c&&Object(k.jsx)(gt,{}),"security"===c&&Object(k.jsx)(Nt,{}),"account"===c&&Object(k.jsx)(yt,{})]})}),Object(k.jsx)("aside",{className:"sidebar",children:Object(k.jsxs)("div",{className:"sidebar__wrapper",children:[Object(k.jsx)(r.b,{className:"sidebar__button"+("information"===c?" sidebar__button--active":""),to:"/settings",children:"Information"}),Object(k.jsx)(r.b,{className:"sidebar__button"+("security"===c?" sidebar__button--active":""),to:"?tab=security",children:"Security"}),Object(k.jsx)(r.b,{className:"sidebar__button"+("account"===c?" sidebar__button--active":""),to:"?tab=account",children:"Account"})]})})]})}):null}function gt(){const e=y((e=>e.user.info)),{formState:{errors:t},handleSubmit:s,register:n,reset:a}=Object(C.a)();return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:s((function(t){t=F(t);for(const e in t)t[e]||(t[e]=null);P.ref(`users/user${e.id}/info`).update(t).then(a)})),children:[$.filter((e=>["name","lastName"].includes(e.id))).map((s=>Object(k.jsx)(A,{opts:{obj:s,defaultValue:e[s.id],errors:t,label:!0,register:n}},s.id))),Object(k.jsx)(L,{register:n,userGender:e.gender}),$.filter((e=>["country","city"].includes(e.id))).map((s=>Object(k.jsx)(A,{opts:{obj:s,defaultValue:e[s.id],errors:t,label:!0,register:n}},s.id))),Object(k.jsxs)("div",{className:"settings__buttons",children:[Object(k.jsx)(ne,{text:"Save",type:"submit"}),Object(k.jsx)(ne,{preset:"secondary",text:"Cancel",onClick:()=>a()})]})]})}function Nt(){const e=y((e=>e.user.account)),t=y((e=>e.user.account.id)),{formState:{errors:s},handleSubmit:a,register:o,reset:r}=Object(C.a)(),c=Object(n.useRef)(),i=Object(n.useRef)(),[l,d]=Object(n.useState)(!1);return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:a((function(s){var n;null===(n=c.current)||void 0===n||n.off("value",i.current),c.current=P.ref("users/"),i.current=c.current.orderByChild("account/email").equalTo(s.email).on("value",(n=>{if(c.current.off("value",i.current),O(e.password)!==s.password){const e={id:t,password:s.password};document.cookie=`USER_DATA=${JSON.stringify(e)}; expires=${new Date(Date.now()+31536e6)}`}n.val()&&!n.val()["user"+t]&&(s.email=e.email,d(!0)),P.ref(`users/user${e.id}/account`).update({email:s.email,password:v(s.password,t)})}))})),children:[Object(k.jsx)(A,{onInput:()=>d(!1),opts:{obj:$.find((e=>"email"===e.id)),defaultValue:e.email,errors:s,label:!0,register:o}}),l&&Object(k.jsx)("p",{className:"error-text",children:"This email is already used."}),Object(k.jsx)(A,{opts:{obj:$.find((e=>"password"===e.id)),defaultValue:O(e.password),errors:s,label:!0,register:o}}),Object(k.jsxs)("div",{className:"settings__buttons",children:[Object(k.jsx)(ne,{text:"Save",type:"submit"}),Object(k.jsx)(ne,{preset:"secondary",text:"Cancel",onClick:()=>{r(),d(!1)}})]})]})}function yt(){const e=Object(o.b)(),t=y((e=>e.user.account.id));return Object(k.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:function(s){s.preventDefault(),e(i("action-confirm",{actionConfirm:{text:"Are you sure you want to delete your account? This action is irreversible!",password:!0,callback:()=>{e({type:"LOG_OUT"}),setTimeout((()=>{P.ref("posts").once("value",(e=>{const s=Object.values({...e.val()});H({posts:s.filter((e=>e.authorId===t)),userId:t})}))}),0)}}}))},children:[Object(k.jsx)("h3",{className:"primary-form__title",children:"Account removal"}),Object(k.jsx)(ne,{preset:"remove",text:"Delete account",type:"submit"})]})}function wt(){const{pathname:e}=Object(S.useLocation)(),t=Object(o.b)(),s=y((e=>e.modal)),a=Object(n.useRef)(null);return a.current=s.currentModal,Object(n.useEffect)((()=>{t(l(a.current))}),[t,e]),null}c.topbar.config({barColors:{0:"rgba(128, 215, 255, 1)"},className:"loading-bar",shadowBlur:5,shadowColor:"rgba(0, 0, 0, 1)"});const kt=()=>document.documentElement.style.setProperty("--page-height",window.innerHeight+"px");function It(){return window.history.scrollRestoration="manual",Object(k.jsx)(r.a,{children:Object(k.jsxs)(o.a,{store:w,children:[Object(k.jsx)(wt,{}),Object(k.jsx)(He,{}),Object(k.jsx)(Fe,{}),Object(k.jsx)("main",{className:"main",children:Object(k.jsxs)(c.Switch,{loadingScreen:()=>Object(k.jsxs)("div",{className:"loading-screen",children:[Object(k.jsx)("div",{}),Object(k.jsx)("div",{}),Object(k.jsx)("div",{}),Object(k.jsx)("div",{})]}),children:[Object(k.jsx)(c.Route,{path:"/",exact:!0,component:ut}),Object(k.jsx)(c.Route,{path:"/bookmarks",component:st,loading:!0}),Object(k.jsx)(c.Route,{path:"/communities",component:nt,loading:!0}),Object(k.jsx)(c.Route,{path:"/community:communityId",component:at,loading:!0}),Object(k.jsx)(c.Route,{path:"/conversation",component:ot,loading:!0}),Object(k.jsx)(c.Route,{path:"/friends",component:ct,loading:!0}),Object(k.jsx)(c.Route,{path:"/messages",component:mt,loading:!0}),Object(k.jsx)(c.Route,{path:"/news",component:bt,loading:!0}),Object(k.jsx)(c.Route,{path:"/photos",component:ft,loading:!0}),Object(k.jsx)(c.Route,{path:"/search",component:xt,loading:!0}),Object(k.jsx)(c.Route,{path:"/settings",component:_t,loading:!0}),Object(k.jsx)(c.Route,{path:"/conversation:conversationId",component:ot,loading:!0}),Object(k.jsx)(c.Route,{path:"/friends:ownerId",component:ct,loading:!0}),Object(k.jsx)(c.Route,{path:"/photos:ownerId",component:ft,loading:!0}),Object(k.jsx)(c.Route,{path:"/post:postId",component:ht,loading:!0}),Object(k.jsx)(c.Route,{path:"/id:ownerId",component:Ot,loading:!0}),Object(k.jsx)(c.Route,{path:"/",component:Ge})]})}),Object(k.jsx)(Ae,{})]})})}kt(),window.addEventListener("resize",kt);var Ct=e=>{e&&e instanceof Function&&s.e(3).then(s.bind(null,61)).then((({getCLS:t,getFID:s,getFCP:n,getLCP:a,getTTFB:o})=>{t(e),s(e),n(e),a(e),o(e)}))};Object(a.render)(Object(k.jsx)(n.StrictMode,{children:Object(k.jsx)(It,{})}),document.getElementById("app")),Ct()}},[[53,1,2]]]);