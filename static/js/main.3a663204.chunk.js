(this["webpackJsonpreact-project"]=this["webpackJsonpreact-project"]||[]).push([[0],{54:function(e,t,s){},70:function(e,t,s){"use strict";s.r(t);var n=s(2),o=s(21),c=s(0),a=s(6),i=s(3),r=s(14);s(53),s(54);const l=(e,t={})=>({type:"OPEN_MODAL",name:e,opts:t}),d=e=>({type:"CLOSE_MODAL",name:e});var u=s(28),m=s(36);let b;function j(){const e=window.innerWidth-document.body.offsetWidth+"px";b=document.querySelectorAll(".fixed-item"),document.body.style.overflow="hidden",document.body.style.marginRight=e,b.forEach((t=>t.style.paddingRight=e))}function h(){document.body.style.overflow="",document.body.style.marginRight="",b.forEach((e=>e.style.paddingRight=""))}var f=(e=!1,t)=>{switch(t.type){case"OPEN_HAMBURGER":return j(),!0;case"CLOSE_HAMBURGER":return!1;default:return e}};const p={activeModals:[],currentModal:null,gallery:null};var v=(e=p,t)=>{var s;const n={...e,actionConfirm:{...e.actionConfirm},activeModals:[...e.activeModals],zoom:{...e.zoom}};switch(t.type){case"OPEN_MODAL":return j(),n.activeModals.push(t.name),n.currentModal=t.name,n.actionConfirm=t.opts.actionConfirm,n.actionError=t.opts.actionError,n.changeAvatarCommunityId=t.opts.changeAvatarCommunityId,t.opts.gallery&&(n.gallery=t.opts.gallery),(null===(s=t.opts.zoom)||void 0===s?void 0:s.img)&&(n.zoom={img:t.opts.zoom.img,alt:t.opts.zoom.alt||""}),n;case"CLOSE_MODAL":return n.activeModals.includes(t.name)&&(n.activeModals.splice(n.activeModals.indexOf(t.name)),n.currentModal=n.activeModals[n.activeModals.length-1]),n;default:return e}};var O=(e=null,t)=>{switch(t.type){case"OPEN_TOAST":return{icon:t.icon,msg:t.msg};case"CLOSE_TOAST":return null;default:return e}};function x(e,t){let s=0;[...e].forEach((e=>s+=e.charCodeAt(0)));const n=n=>(s+e.length+parseInt(t.toString(),36)%(n+1)**2)%26+(2===n?0:10),o=e=>e.toString(36),c=n(1),a=n(2),i=n(3),r=n(4);let l="";return[...e].forEach(((e,t)=>{l+=String.fromCharCode(e.charCodeAt(0)+c+a+i+r-Math.min(t%60,t%65,t%70))})),l=btoa(l),l[0]+o(c)+o(a)+o(i)+l.slice(1,-2)+o(r)+l.slice(-2)}function _(e){const t=parseInt(e[1],36),s=parseInt(e[2],36),n=parseInt(e[3],36),o=parseInt(e[e.length-3],36),c=e[0]+e.slice(4,-3)+e.slice(-2);let a="";return[...atob(c)].forEach(((e,c)=>{a+=String.fromCharCode(e.charCodeAt(0)-t-s-n-o+Math.min(c%60,c%65,c%70))})),a}const g={account:{id:null},info:null};var y=(e=g,t)=>{const s=localStorage.getItem("loggedIn");let n;switch(t.type){case"LOG_IN":return n={id:t.user.account.id,password:_(t.user.account.password)},document.cookie=`USER_DATA=${JSON.stringify(n)}; expires=${new Date(Date.now()+31536e6)}`,localStorage.setItem("loggedIn","true"),t.user;case"LOG_OUT":return document.cookie=`USER_DATA=; expires=${new Date}`,localStorage.removeItem("loggedIn"),null;case"LOG_SYNC":return s?t.user:(document.cookie=`USER_DATA=; expires=${new Date}`,null);default:return e}};const N=Object(u.b)({user:y,hamburger:f,modal:v,toast:O}),w=Object(u.c)(N,Object(u.a)(m.a)),k=a.c;var I=w,C=s(1);function $({children:e,className:t,modalName:s,testId:o,zoomImg:c}){const i=Object(a.b)(),r=k((e=>e.modal.activeModals)),l=k((e=>e.modal.currentModal)),u=k((e=>e.modal.zoom)),m=Object(n.useRef)(r);m.current=r;const b=Object(n.useRef)(null),j=Object(n.useRef)(null),f=Object(n.useCallback)((()=>{i(d(s))}),[i,s]);const p=Object(n.useRef)(!1);const v=Object(n.useCallback)((e=>{"Escape"===e.key&&l===s&&f()}),[f,l,s]);return Object(n.useEffect)((()=>(window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v))),[v]),Object(n.useEffect)((()=>{if(l!==s)return;let e=document.activeElement;const t=s=>{"Tab"!==s.key||j.current.contains(document.activeElement)||(e=document.activeElement,s.preventDefault(),j.current.querySelector("button").focus(),window.removeEventListener("keydown",t))};return window.addEventListener("keydown",t),()=>{m.current.includes(s)||(e.focus({preventScroll:!0}),setTimeout((()=>document.activeElement.blur()),0)),window.removeEventListener("keydown",t)}}),[r,l,s]),Object(C.jsx)("div",{className:`${t?`${t} `:""}modal-${s} modal${r.includes(s)?" modal--open":""}`,ref:b,onMouseDown:function(e){e.target===j.current&&(p.current=!0)},onMouseUp:function(e){p.current&&e.target===j.current&&f(),p.current=!1},onTransitionEnd:function(e){l||e.target!==b.current||"visibility"!==e.nativeEvent.propertyName||h()},children:Object(C.jsx)("div",{className:"modal__wrapper",ref:j,children:Object(C.jsxs)("div",{className:`modal-${s}__content modal__content`,onClick:e=>e.stopPropagation(),children:[Object(C.jsx)("button",{className:"modal__close primary-button","aria-label":"Close modal",onClick:f,children:"\xd7"}),e,c&&Object(C.jsx)("img",{className:"modal-zoom__img",src:(null===u||void 0===u?void 0:u.img)||"#",alt:(null===u||void 0===u?void 0:u.alt)||""})]})})})}var S=s(15),E=s(4),L=s(12),T=s(25);s(56),s(71);T.a.initializeApp({apiKey:_("mpipaDQtqfMlLqnhbeCgLaZk5aos7aSibO5j3WYf3Nzr4x/gJiHpXkh/"),authDomain:"social-app-bs.firebaseapp.com",databaseURL:_("slelLu6tbd9cXCzrqGmnadnmqinY5enYJaWlpCjmaBYnJ2MiVSKmZWRkYVMlYKPj0tHfoCIenZ0hXZ0cIJuqqi5qnKpt7gY="),projectId:"social-app-bs",storageBucket:"social-app-bs.appspot.com",messagingSenderId:"129896299882",appId:"1:129896299882:web:7bf515fc32dcf9a735f913"});const P=T.a.database(),{increment:R}=T.a.database.ServerValue,A=T.a.database.ServerValue.TIMESTAMP,D=T.a.storage();function M(){const e=Object(n.useContext)(r.LoadingContext),t=Object(n.useRef)({qty:[],incrementQty(e,t){this.qty.includes(e)||(this.qty.push(e),this.qty.length===this.expectedQty&&t())},setExpected(e,t){this.expectedQty||(this.expectedQty=e,0===this.expectedQty&&(null===t||void 0===t||t()))}}),s=Object(n.useRef)(!1),o=Object(n.useCallback)((e=>document.title=e+" | Social App"),[]);return{fetchedItems:t,finishLoading:Object(n.useCallback)((t=>{t&&o(t),s.current=!0,e.done(),window.scrollTo(0,0)}),[e,o]),loaded:s,setTitle:o}}function q(){const e=Object(n.useRef)(!1),[t,s]=Object(n.useState)(!1),o=Object(n.useCallback)(((t=!0)=>{e.current=t,s(t)}),[]);return{AsyncButton:Object(n.useCallback)((e=>Object(C.jsx)(be,{loading:t,...e})),[t]),buttonLoading:t,buttonLoadingRef:e,setButtonLoading:o}}function B(e=!0){const[t,s]=Object(n.useState)([]);return{addImgPreview:n=>{const o=[...n.target.files];e||(o.length=1);let c=o.length;n.target.value="";const a=[];o.forEach((e=>{let n,o;["jpg","jpeg","png"].includes(e.name.split(".").pop().toLowerCase())||(o=!0,c--);const i={lastModified:e.lastModified,name:e.name,size:e.size,type:e.type};for(const s of t)if(JSON.stringify(s.props)===JSON.stringify(i)){n=!0,c--;break}if(!n||!o){const n=new FileReader;n.onload=()=>{a.push({props:i,file:e,result:n.result}),a.length===c&&s([...t,...a])},n.readAsDataURL(e)}}))},imgPreview:t,setImgPreview:s}}r.topbar.config({barColors:{0:"rgba(128, 215, 255, 1)"},className:"loading-bar",shadowBlur:5,shadowColor:"rgba(0, 0, 0, 1)"});const z=e=>P.ref(e);z().orderByChild("a");function F(e){const t=t=>({equalTo:s=>({on(n){const o=t.equalTo(s).on("value",(e=>n(e.val())));return()=>z(e).off("value",o)},once:e=>t.equalTo(s).once("value",(t=>e(t.val())))})});return{newKey:()=>z().push().key,on(t){const s=z(e).on("value",(e=>t(e.val())));return()=>z(e).off("value",s)},once:t=>z(e).once("value",(e=>t(e.val()))),onDisconnect:()=>z(e).onDisconnect(),orderByChild:s=>t(z(e).orderByChild(s)),orderByValue:()=>t(z(e).orderByValue()),push:()=>z(e).push(),remove:()=>z(e).remove(),set:t=>z(e).set(t),update:t=>z(e).update(t)}}function U(){const e=_("0tmtNva1dedkZDHxM3Jy767zcHGxIK4tYC0v7x9t7+6uHiuqXl7d3l5cW2kcG+daGtqnZljlmhpZl5laJRkmJ2YnZWYnZo0=");return new Promise((t=>fetch(e).then((e=>e.json())).then((e=>t({city:e.city,country:e.country_name,ip:e.IPv4})))))}function H(e){U().then((t=>{const s=`ipAddresses/${e}/${t.ip.split(".").join("\u2024")}/`;F().update({[s+"city"]:t.city,[s+"country"]:t.country,[`${s}/visits/${F().newKey()}`]:A})}))}function Y({callback:e,community:t,fields:s=["info"],userId:n}){const o={},c=[],a=s.map((e=>{const t=e.split("/");return t[t.length-1]}));return s.forEach(((s,i)=>{c.push(F(`${t?"communities/community":"users/user"}${n}/${s}`).on((t=>{o[a[i]]=t,a.map((e=>o[e])).includes(void 0)||e(o.info?{...o}:null)})))})),()=>c.forEach((e=>e()))}var G=[{id:"name",name:"name",title:"Name",errors:{maxLength:{value:32,message:"A name cannot contain more than 32 characters"},required:"Enter your name"}},{id:"lastName",name:"lastName",title:"Last name",errors:{maxLength:{value:32,message:"A last name cannot contain more than 32 characters"},required:"Enter your last name"}},{id:"country",name:"country",title:"Country",errors:{maxLength:{value:56,message:"A country cannot contain more than 56 characters"}}},{id:"city",name:"city",title:"City",errors:{maxLength:{value:85,message:"A city cannot contain more than 85 characters"}}},{autoComplete:"off",id:"status",name:"status",title:"Status",errors:{maxLength:{value:80,message:"A status cannot contain more than 80 characters"}}},{id:"email",name:"email",title:"Email",type:"email",errors:{maxLength:{value:320,message:"An email cannot contain more than 320 characters"},pattern:{value:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,message:"Enter a correct email address!"},required:"Enter an email address"}},{id:"password",name:"password",type:"password",title:"Password",autoComplete:"new-password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},minLength:{value:2,message:"A password must be at least 2 characters long"},pattern:{value:/^[a-zA-Z0-9!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~-]*$/,message:"A password can only contain letters (a-z, A-Z), numbers, and symbols !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~, and cannot contain spaces"},required:"Enter a password"}},{id:"existingPassword",name:"password",type:"password",title:"Password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},required:"Enter your password"}},{id:"confirmPassword",name:"password",type:"password",title:"Confirm password",autoComplete:"new-password",errors:{maxLength:{value:128,message:"A password cannot contain more than 128 characters"},required:"Confirm your password"}},{id:"title",name:"title",title:"Title",errors:{maxLength:{value:32,message:"A title cannot contain more than 32 characters"},required:"Enter community title"}},{id:"description",name:"text",title:"Description",errors:{maxLength:{value:256,message:"A description cannot contain more than 256 characters"}}},{id:"shortDescription",name:"text",title:"Short description",errors:{maxLength:{value:100,message:"A short description cannot contain more than 100 characters"}}}];const V=({register:e,userGender:t})=>Object(C.jsxs)("div",{className:"gender",children:[Object(C.jsx)("h4",{className:"gender__title",children:"Gender"}),Object(C.jsx)("div",{className:"gender__items",children:["Male","Female"].map((s=>Object(C.jsxs)("label",{className:"gender__item",children:[Object(C.jsx)("input",{className:"gender__input",defaultChecked:s.toLowerCase()===(t||"male"),type:"radio",value:s.toLowerCase(),...e("gender")}),Object(C.jsx)("p",{className:"gender__text",children:s})]},s)))})]});var J=({opts:{defaultValue:e,errors:t,label:s,labelText:o,obj:c,placeholder:a,register:i},...r})=>{const[l,d]=Object(n.useState)(!1),u={id:c.id,autoCapitalize:["password","email"].includes(c.name)?"off":"on",autoComplete:c.autoComplete||"on",defaultValue:e||"",placeholder:a?c.title:"",spellCheck:!["password","email"].includes(c.name),...r};return Object(C.jsxs)("div",{className:"primary-form__item",children:[s&&Object(C.jsx)("label",{className:"primary-form__label",htmlFor:r.id||c.id,children:o||c.title}),["password","existingPassword"].includes(c.id)?Object(C.jsxs)("div",{className:"primary-form__password",children:[Object(C.jsx)("input",{className:"primary-form__input-password primary-form__input",type:l?"text":"password",...u,...i("password",c.errors)}),Object(C.jsx)("button",{className:"primary-form__password-show",type:"button","aria-label":"Toggle password visibility",onClick:()=>d(!l),children:l?Object(C.jsx)(E.u,{size:"1.25em"}):Object(C.jsx)(E.v,{size:"1.25em"})})]}):Object(C.jsx)("input",{className:"primary-form__input",type:c.type||"text",...u,...i(c.id,{...c.errors,validate:e=>{if(c.errors.required&&!e.trim())return c.errors.required}})}),t[c.id]&&Object(C.jsx)("p",{className:"error-text",children:t[c.id].message})]})},K=s(37);function Z(e,t,s="s"){return`${t} ${e}${1!==t?s:""}`}function W(e,t){const s=new Date(e),n=Date.now()+1e3,o=new Date(n),c=(n-e)/1e3,a=c/60,i=a/60,r=s;return c<1?"just now":a<1?`${Z("second",Math.floor(c))} ago`:i<1?`${Z("minute",Math.floor(a))} ago`:i<3&&o.getDate()===s.getDate()?`${Z("hour",Math.floor(i))} ago`:i<24&&o.getDate()===s.getDate()?t?"today":`today at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`:i<48&&new Date(n-864e5).getDate()===s.getDate()?t?"yesterday":`yesterday at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`:o.getFullYear()===s.getFullYear()?t?`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()}`:`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()} at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`:t?`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()} ${r.getFullYear()}`:`${r.toLocaleString("en-US",{month:"long"})} ${r.getDate()} ${r.getFullYear()} at ${r.getHours()}:${r.getMinutes()<10?0:""}${r.getMinutes()}`}const Q=({reqUserId:e,userId:t})=>{const s=`users/user${e}/`,n=`users/user${t}/`;F().update({[`${s}friendRequests/sent/user${t}`]:null,[`${s}friends/user${t}`]:{friendAddDate:A,userId:t},[`${n}friendRequests/received/user${e}`]:null,[`${n}friends/user${e}`]:{friendAddDate:A,userId:e},[n+"fullInfo/followerCount"]:R(-1)})},X=e=>{F("posts").orderByChild("authorId").equalTo(e).once((t=>{const s=`users/user${e}/`,n={[s+"account"]:{deleted:!0,id:e},[s+"bookmarks"]:null,[s+"connections"]:null,[s+"info"]:{avatar:"img/user-deleted.svg",deleted:!0,gender:null,id:e,lastName:"account",lastSeen:null,name:"Deleted"},[s+"profilePhotos"]:null};Object.values({...t}).forEach((e=>n["posts/post"+e.id]=null)),F().update(n)}))},ee=(e,t,s)=>{F("posts").orderByChild("communityId").equalTo(e).once((n=>{const o=`communities/community${e}/`,c={[o+"fullInfo"]:null,[o+"info"]:{avatar:"img/community-deleted.svg",deleted:!0,id:e,subscriberCount:s||null,title:"Deleted community"},[o+"profilePhotos"]:null};Object.values({...n}).forEach((e=>c["posts/post"+e.id]=null)),F().update(c),t&&D.refFromURL(t).delete()}))};function te(e){for(const t in e)e[t]=e[t].trim();return e}const se=e=>e.info.deleted?"This user account has been removed":e.connections?"Online":"Last seen "+W(e.info.lastSeen),ne=({condition:e,contentId:t,contentPath:s,history:n,userId:o,userPath:c})=>{if(!o)return void n.push("/");const a=s+"/likeCounter",i=`${s}/likes/user${o}`,r=`users/user${o}/likes/${c}`;e?F().update({[a]:R(-1),[i]:null,[r]:null}):F().update({[a]:R(1),[i]:{date:A,userId:o},[r]:{date:A,id:t}})},oe=(e,t,s,n)=>{if(!s)return void t.push("/");const o="communities/community"+e,c=`${o}/subscribers/user${s}`,a=o+"/info/subscriberCount",i=`users/user${s}/communities/subscribed/community${e}`;n?F().update({[a]:R(-1),[c]:null,[i]:null}):F().update({[a]:R(1),[c]:s,[i]:{date:A,id:e}})},ce=e=>e?localStorage.setItem("darkTheme","true"):localStorage.removeItem("darkTheme"),ae=()=>localStorage.getItem("darkTheme"),ie=()=>{const e=localStorage.getItem("darkTheme"),t=document.querySelector("meta[name=theme-color]");document.documentElement.classList[e?"add":"remove"]("dark"),t&&(t.content=e?"#1773a8":"#22aeff")},re=async({addToPhotos:e,callback:t,communityId:s,createId:n=!0,file:o,imgParent:c,imgPath:a="photos",index:i,setLoadingPercentage:r,storagePrefix:d="",userId:u})=>{const m=n?F().newKey():a,b=await Object(K.a)(o,{initialQuality:.7,maxWidthOrHeight:3840}),j=b.name.split(".").slice(-1),h=D.ref(`img/${d?`${d}_`:""}${m}.${j}`).put(b,{cacheControl:"public, max-age=36000"});h.on("state_changed",(e=>{const t=Math.floor(e.bytesTransferred/e.totalBytes*100);null===r||void 0===r||r(t,i)}),(()=>I.dispatch(l("action-error",{actionError:"Failed to load image to our database. Try again."}))),(()=>h.snapshot.ref.getDownloadURL().then((o=>new Promise((()=>{const r=s?`communities/community${s}`:`/users/user${u}`,l={[`${r}/${c?`${c}/`:""}${a}${n?`/${m}`:""}`]:{date:A,id:n?m:null,src:o}};e&&(l[`${r}/profilePhotos/${m}`]={id:m}),F().update(l),null===t||void 0===t||t({id:m,index:i||0,link:o})}))))))};function le({addToPhotosHandler:e,community:t,imgPreview:s,loadingPercentage:n,removeOnClick:o}){const c=Object(a.b)(),i=Number.isInteger(n);return Object(C.jsxs)("div",{className:"upload-preview",children:[Object(C.jsxs)("div",{className:"upload-preview__header",children:[!i&&Object(C.jsx)("button",{className:"upload-preview__header-remove",type:"button",onClick:o,children:"\xd7"}),Object(C.jsxs)("button",{className:"upload-preview__header-img-container",type:"button",onClick:()=>c(l("zoom",{zoom:{img:s.result,alt:""}})),children:[Object(C.jsx)("img",{className:"upload-preview__header-img",src:s.result,alt:""}),i&&Object(C.jsxs)("div",{className:"upload-preview__header-img-overlay",children:[Object(C.jsx)("div",{className:"upload-preview__header-img-overlay-loading",style:{width:n+"%"}}),Object(C.jsx)("p",{className:"upload-preview__header-img-overlay-text",children:n+"%"})]})]})]}),Object(C.jsx)("div",{className:"upload-preview__footer",children:Object(C.jsxs)("div",{className:"upload-preview__footer-wrapper",children:[Object(C.jsx)("h4",{className:"upload-preview__title upload-preview__footer-item",children:s.props.name}),e&&Object(C.jsxs)("label",{className:"upload-preview__checkbox upload-preview__footer-item",children:[Object(C.jsx)("input",{className:"upload-preview__checkbox-input",disabled:i,type:"checkbox",name:"checkbox",onChange:e}),Object(C.jsx)("p",{className:"upload-preview__checkbox-text",children:`Add to ${t?"community":"my"} photos`})]})]})})]})}const de=({community:e,nameIsLink:t=!0,onClick:s,onlyName:n,text:o,textLink:c,userInfo:a})=>{const r=t?i.b:"h4",l=c?i.b:"p";return Object(C.jsxs)("div",{className:"author-info",children:[Object(C.jsx)(r,{className:"author-info__name",to:t?`/${e?"community":"id"}${a.id}`:null,onClick:s,children:a.title||a.name+(n?"":` ${a.lastName}`)}),o&&Object(C.jsx)(l,{className:"author-info__text",to:c,children:o})]})},ue=({community:e,onClick:t,size:s="medium",src:n,userId:o})=>Object(C.jsx)(i.b,{className:"avatar",to:`/${e?"community":"id"}${o}`,onClick:t,children:Object(C.jsx)("img",{className:`avatar__img-${s} avatar__img`,src:n,alt:"Avatar"})}),me=({avatar:e,userInfo:t})=>{const s=Object(a.b)();return t.avatar.endsWith(".svg")?Object(C.jsx)("div",{className:"avatar-gallery-btn--default",children:Object(C.jsx)("img",{className:"avatar-gallery-btn__img",src:t.avatar,alt:"Avatar"})}):Object(C.jsx)(i.b,{className:"avatar-gallery-btn",to:"#javascript",onClick:n=>{s(l("gallery",{gallery:{authorInfo:t,content:[e],initialSlide:0}})),n.preventDefault()},children:Object(C.jsx)("img",{className:"avatar-gallery-btn__img",src:t.avatar,alt:"Avatar"})})},be=({afterIcon:e,beforeIcon:t,className:s="",href:n,iconStyles:o,loading:c,preset:a="primary",onClick:r,testId:l,text:d,to:u,type:m="button"})=>{const b=n?"a":u?i.b:"button",j=e=>e&&Object(C.jsx)(e,{className:`${s&&s+"__icon "}${a}-button__icon button__icon `,size:null===o||void 0===o?void 0:o.size,style:{height:null===o||void 0===o?void 0:o.height,width:null===o||void 0===o?void 0:o.width}});return Object(C.jsxs)(b,{className:`${s&&s+" "}${a}-button button${c?" button--loading":""}`,href:n,to:u,type:"button"===b?m:null,onClick:r,children:[c&&Object(C.jsxs)("div",{className:"button__loading",children:[Object(C.jsx)("div",{}),Object(C.jsx)("div",{}),Object(C.jsx)("div",{}),Object(C.jsx)("div",{})]}),j(t),Object(C.jsx)("p",{className:`${s&&s+"__text "}${a}-button__text button__text`,children:d}),j(e)]})},je=({className:e,databaseRef:t,disabled:s,emptyButtonText:o,emptyFieldText:c,field:a,ownerId:i,renderInputId:r})=>{const{formState:{errors:l},handleSubmit:d,register:u,reset:m}=Object(S.a)(),b=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[j,h]=Object(n.useState)(!1);return Object(C.jsx)("div",{className:(e?`${e} `:"")+"editable-field",children:i!==b||s?Object(C.jsx)("p",{className:(e?`${e}__text `:"")+"editable-field__text",children:a||c}):j?Object(C.jsxs)("form",{className:(e?`${e}__form `:"")+"editable-field__form",action:"#",method:"post",onSubmit:d((function(e){F(t).set(e[r].trim()||null),h(!1)})),children:[Object(C.jsx)(J,{autoFocus:!0,opts:{obj:G.find((e=>e.id===r)),defaultValue:a,errors:l,placeholder:!0,register:u}}),Object(C.jsxs)("div",{className:(e?`${e}__form-buttons `:"")+"editable-field__form-buttons",children:[Object(C.jsx)(be,{text:"Save",type:"submit"}),Object(C.jsx)(be,{preset:"secondary",text:"Cancel",onClick:()=>h(!1)})]})]}):Object(C.jsxs)("button",{className:(e?`${e}__button `:"")+"editable-field__button",onClick:()=>{h(!0),m()},children:[Object(C.jsx)("div",{className:(e?`${e}__icon-container `:"")+"editable-field__icon-container",children:Object(C.jsx)(E.l,{className:(e?`${e}__icon `:"")+"editable-field__icon",size:"1.15em"})}),Object(C.jsx)("p",{className:(e?`${e}__text `:"")+"editable-field__text",children:a||o})]})})},he=({bookmarkType:e,children:t,itemId:s})=>{const n="community"===e?"communities":e+"s",o=Object(L.useHistory)(),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),a=k((t=>{var o,c,a,i;return null===(o=t.user)||void 0===o||null===(c=o.bookmarks)||void 0===c||null===(a=c[n])||void 0===a||null===(i=a[e+s])||void 0===i?void 0:i.id}));return Object(C.jsxs)("div",{className:"interaction-submenu",children:[Object(C.jsx)("div",{className:"interaction-submenu__icon-container",tabIndex:0,children:Object(C.jsx)(E.e,{className:"interaction-submenu__icon",style:{width:".9em"}})}),Object(C.jsxs)("div",{className:"interaction-submenu__wrapper",children:[Object(C.jsx)(be,{text:(a?"Remove from":"Add to")+" bookmarks",onClick:()=>{if(!c)return void o.push("/");const t=F(`users/user${c}/bookmarks/${n}/${e+s}`);a?t.remove():t.set({date:A,id:s})}}),t]})]})},fe=({addToPhotosButton:e,avatar:t,buttonText:s="Post",children:o,community:c,inputPlaceholder:a="Share your thoughts",uploadCallback:i,userId:r})=>{const l=c?r:null,d=Object(n.useRef)(),[u,m]=Object(n.useState)([]),{formState:{errors:b},handleSubmit:j,register:h,reset:f,setValue:p}=Object(S.a)(),{AsyncButton:v,buttonLoading:O,setButtonLoading:x}=q(),{addImgPreview:_,imgPreview:g,setImgPreview:y}=B(),{ref:N,...w}=h("msg",{maxLength:{value:5e3,message:"A message cannot contain more than 5000 characters"}});function k(e){if(O)return;const t=document.activeElement===d.current,s=new Array(g.length).fill(0),n=e.msg.trim(),o=[];if(g.length||n){x(),m(s),g.length||a();const e=({id:e,index:t})=>{o[t]=e,o.length!==g.length||o.includes(void 0)||a()};g.forEach(((t,n)=>re({addToPhotos:t.addToPhotos,callback:e,communityId:l,file:t.file,index:n,setLoadingPercentage:(e,t)=>{s[t]=e,m([...s])},userId:r})))}async function a(){const e={images:o,text:n||null},s=()=>{var e;f(),y([]),m([]),x(!1),t&&(null===(e=d.current)||void 0===e||e.focus())};i?(await i(e),s()):F("contentData/nextPostId").once((t=>{const n={authorId:c?null:r,communityId:l,content:e,date:A,id:t};F().update({["posts/post"+t]:n,"contentData/nextPostId":`${parseInt(t,10)+1}`}).then(s)}))}}return Object(C.jsxs)("div",{className:"post-msg",children:[Object(C.jsx)(ue,{community:c,size:"small",src:t,userId:r}),Object(C.jsxs)("form",{className:"post-msg__form",action:"#",method:"post",onSubmit:j(k),children:[o,Object(C.jsx)("textarea",{className:"post-msg__form-input"+(O?" input--disabled":""),disabled:O,placeholder:a+"...",ref:e=>{N(e),d.current=e},rows:1,onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p("msg",e.target.value),j(k)())},...w}),b.msg&&Object(C.jsx)("p",{className:"error-text",children:b.msg.message}),Object(C.jsxs)("div",{className:"post-msg__form-footer",children:[Object(C.jsxs)("div",{className:"post-msg__form-footer-inputs",children:[Object(C.jsxs)("label",{className:"post-msg__form-photo",children:[Object(C.jsx)("input",{className:"post-msg__form-photo-input",disabled:O,type:"file",accept:".jpg, .jpeg, .png",multiple:!0,hidden:!0,onChange:_}),Object(C.jsx)("button",{className:"post-msg__form-photo-button"+(O?" post-msg__form-photo-button--disabled":""),type:"button",onClick:e=>e.target.closest("label").click(),"aria-label":"Photo",children:Object(C.jsx)(E.c,{className:"post-msg__form-photo-icon"})})]}),Object(C.jsx)(v,{testId:"post-msg-btn",text:s,type:"submit"})]}),g.length>0&&Object(C.jsx)("div",{className:"upload-previews",children:Object(C.jsx)("div",{className:"upload-previews__wrapper",children:g.map(((t,s)=>Object(C.jsx)(le,{addToPhotosHandler:e?e=>function(e,t){y(g.map(((s,n)=>(n===t&&(s.addToPhotos=e.target.checked),s))))}(e,s):void 0,community:c,imgPreview:t,loadingPercentage:u[s],removeOnClick:()=>y(g.filter((e=>e.result!==t.result)))},s)))})})]})]})]})},pe=({link:e,onChange:t,onSubmit:s,value:n})=>{const o=e?i.b:"button";return Object(C.jsxs)("form",{className:"search-bar",action:"#",method:"post",onSubmit:s,children:[Object(C.jsx)("input",{className:"search-bar__input primary-form__input",type:"text",name:"search",placeholder:"Search...",value:n,onChange:t}),Object(C.jsx)(o,{className:"search-bar__button",to:e&&"/search?query="+n,children:Object(C.jsx)(E.B,{className:"search-bar__button-icon"})})]})},ve=({avatarSize:e="medium",bottomText:t,bottomTextLink:s,children:n,childrenBottom:o,community:c,linksOnClick:a,userInfo:r,wrapperLink:l})=>{const d=l?i.b:"div";return Object(C.jsxs)("div",{className:"user",children:[Object(C.jsx)(ue,{community:c,size:e,src:r.avatar,userId:r.id,onClick:a}),Object(C.jsxs)(d,{className:"user__wrapper",to:l,children:[Object(C.jsxs)("div",{className:"user__header",children:[Object(C.jsx)(de,{community:c,nameIsLink:!l,text:t,textLink:s,userInfo:r,onClick:a}),n]}),o&&Object(C.jsx)("div",{className:"user__bottom",children:o})]})]})};function Oe(){const e=Object(a.b)(),t=k((e=>e.modal.actionConfirm)),s=k((e=>e.modal.activeModals)),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.password})),{formState:{errors:c},handleSubmit:i,register:r,reset:l}=Object(S.a)(),u=Object(n.useRef)(!1),[m,b]=Object(n.useState)(!1);function j(s){s.password&&_(o)!==s.password?b(!0):(e(d("action-confirm")),null===t||void 0===t||t.callback())}return Object(n.useEffect)((()=>{!u.current&&s.includes("action-confirm")?(u.current=!0,l(),b(!1)):u.current=!1}),[s,l]),(null===t||void 0===t?void 0:t.text)?Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)("div",{className:"modal-action-confirm__header",children:Object(C.jsx)("h4",{className:"modal-action-confirm__title",children:"Confirm action"})}),Object(C.jsxs)("div",{className:"modal-action-confirm__wrapper",children:[Object(C.jsx)("p",{className:"modal-action-confirm__text",children:t.text+(t.irreversible?" This action is irreversible!":"")}),t.password&&Object(C.jsxs)("form",{className:"primary-form",action:"#",method:"post",autoComplete:"off",onSubmit:i(j),children:[Object(C.jsx)(J,{id:"modal-action-confirm__form-input",onInput:()=>b(!1),opts:{obj:G.find((e=>"existingPassword"===e.id)),errors:c,label:!0,labelText:"Enter your password to continue",placeholder:!0,register:r}}),m&&Object(C.jsx)("p",{className:"error-text",children:"Wrong password."})]}),Object(C.jsxs)("div",{className:"modal-action-confirm__buttons",children:[Object(C.jsx)(be,{afterIcon:E.d,preset:"secondary",testId:"action-confirm-yes",text:"Yes",type:"submit",onClick:i(j)}),Object(C.jsx)(be,{afterIcon:E.C,iconStyles:{width:".7em"},preset:"remove",text:"No",onClick:()=>e(d("action-confirm"))})]})]})]}):null}function xe(){const e=Object(a.b)(),t=k((e=>e.modal.actionError));return t?Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)("div",{className:"modal-action-error__header",children:Object(C.jsx)("h4",{className:"modal-action-error__title",children:"Error"})}),Object(C.jsxs)("div",{className:"modal-action-error__wrapper",children:[Object(C.jsx)("p",{className:"modal-action-error__text",children:t}),Object(C.jsx)("div",{className:"modal-action-error__buttons",children:Object(C.jsx)(be,{afterIcon:E.d,text:"OK",onClick:()=>e(d("action-error"))})})]})]}):null}function _e(){const e=Object(a.b)(),t=k((e=>e.modal.changeAvatarCommunityId)),s=k((e=>e.modal.currentModal)),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),{AsyncButton:i,buttonLoading:r,setButtonLoading:u}=q(),{addImgPreview:m,imgPreview:b,setImgPreview:j}=B(!1),h=Object(n.useRef)(!1),[f,p]=Object(n.useState)();return"change-avatar"===s&&(h.current=!0),h.current?b.length?Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(le,{imgPreview:b[0],loadingPercentage:f,removeOnClick:()=>j([])}),Object(C.jsx)(i,{afterIcon:E.d,className:"set-button",preset:"secondary",text:"Set as avatar",onClick:function(){r||(u(),p(0),re({addToPhotos:!0,callback:({link:s})=>{F(`/${t?`communities/community${t}`:`users/user${o}`}/info/avatar`).set(s).then((()=>{e(d("change-avatar")),setTimeout((()=>{u(!1),j([]),p(null)}),400)}))},communityId:t,file:b[0].file,setLoadingPercentage:e=>p(e),userId:o}))}})]}):Object(C.jsxs)(C.Fragment,{children:[!t&&c&&Object(C.jsx)(be,{afterIcon:E.o,iconStyles:{width:"1.15em"},text:"Choose an existing photo",onClick:()=>e(l("choose-photo"))}),Object(C.jsxs)("label",{className:"modal-change-avatar__upload",htmlFor:"modal-change-avatar__upload-input",children:[Object(C.jsx)(be,{afterIcon:E.E,preset:"secondary",text:"Upload photo",onClick:e=>{var t;return null===(t=e.target.closest("label"))||void 0===t?void 0:t.click()}}),Object(C.jsx)("input",{className:"modal-change-avatar__upload-input",id:"modal-change-avatar__upload-input",type:"file",accept:".jpg, .jpeg, .png",hidden:!0,onChange:m})]})]}):null}function ge(){const e=Object(a.b)(),t=k((e=>e.modal.currentModal)),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.photos})),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),i=Object(n.useRef)(!1),[r,l]=Object(n.useState)([]);return Object(n.useEffect)((()=>{const e=[];Object.keys({...c}).forEach((t=>e.push(null===o||void 0===o?void 0:o[t]))),e.includes(void 0)||l(e.sort(((e,t)=>t.date-e.date)))}),[o,c]),"choose-photo"===t&&(i.current=!0),i.current?Object(C.jsxs)("div",{className:"modal-choose-photo__photos",children:[Object(C.jsx)("div",{className:"photos__header",children:Object(C.jsx)("h4",{className:"photos__title",children:`Your photos (${r.length})`})}),Object(C.jsx)("div",{className:"photos__items",children:r.map((t=>Object(C.jsx)("button",{className:"photos__item",onClick:()=>{return n=t.src,F(`/users/user${s}/info/avatar`).set(n),e(d("choose-photo")),void e(d("change-avatar"));var n},children:Object(C.jsx)("img",{className:"photos__item-img",src:t.src,alt:""})},t.id)))})]}):null}function ye(){const e=Object(a.b)(),t=k((e=>e.modal.currentModal)),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{formState:{errors:o},handleSubmit:c,register:i,reset:r}=Object(S.a)(),{AsyncButton:l,buttonLoadingRef:u,setButtonLoading:m}=q(),b=Object(n.useRef)(!1);return"create-community"===t&&(b.current=!0),b.current?Object(C.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:c((function(t){if(!u.current){m(),t=te(t);for(const e in t)t[e]||(t[e]=null);F("contentData/nextCommunityId").once((n=>{const o={fullInfo:{creationTime:A,description:t.description},info:{avatar:"img/community-default.svg",creatorId:s,id:n,shortDescription:t.shortDescription,title:t.title}};F().update({["communities/community"+n]:o,"contentData/nextCommunityId":`${parseInt(n,10)+1}`}).then((()=>{e(d("create-community")),setTimeout((()=>{r(),m(!1)}),400)}))}))}})),children:[G.filter((e=>["title","description","shortDescription"].includes(e.id))).map((e=>Object(C.jsx)(J,{opts:{obj:e,errors:o,placeholder:!0,register:i}},e.id))),Object(C.jsx)(l,{testId:"create-community-btn",text:"Create community",type:"submit"})]}):null}var Ne=s(78),we=s(73),ke=s(74),Ie=s(75),Ce=s(76),$e=s(79),Se=s(77);function Ee(){const e=Object(a.b)(),t=k((e=>e.modal.gallery)),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),o=k((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),i=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.profilePhotos})),r=Object(n.useRef)(null),u=Object(n.useRef)(null),[m,b]=Object(n.useState)(),[j,h]=Object(n.useState)();Object(n.useEffect)((()=>{m&&j&&(m.params.navigation.prevEl=r.current,m.params.navigation.nextEl=u.current,m.controller.control=j,j.controller.control=m)}),[m,j]),Object(n.useEffect)((()=>{t&&m&&(m[t.content.length>1?"enable":"disable"](),m.update(),m.slideToLoop(t.initialSlide,0))}),[t,m]);const f=()=>e(d("gallery"));if(!t)return null;return Object(C.jsxs)(C.Fragment,{children:[Object(C.jsxs)($e.a,{className:"gallery-swiper__container",autoHeight:!0,keyboard:!0,navigation:{prevEl:r.current,nextEl:u.current},onBeforeInit:e=>{e.params.navigation.prevEl=r.current,e.params.navigation.nextEl=u.current},onSwiper:b,pagination:{type:"fraction"},speed:600,children:[t.content.map((n=>{var a;return Object(C.jsxs)(Se.a,{className:"gallery-swiper__slide",children:[Object(C.jsx)("div",{className:"modal-gallery__img-container",children:Object(C.jsx)("img",{className:"modal-gallery__img",src:n.src,alt:""})}),Object(C.jsxs)("div",{className:"modal-gallery__info",children:[Object(C.jsx)(ve,{avatarSize:"small",bottomText:W(n.date),community:!!(null===(a=t.authorInfo)||void 0===a?void 0:a.title),linksOnClick:f,userInfo:t.authorInfo}),Object(C.jsxs)("div",{className:"modal-gallery__info-buttons",children:[t.authorInfo.id===c&&n.src!==o&&(null===i||void 0===i?void 0:i[n.id])&&Object(C.jsx)(be,{beforeIcon:E.F,preset:"secondary",text:"Set as avatar",onClick:()=>{return e=n.src,F(`/users/user${c}/info/avatar`).set(e),void f();var e}}),(t.authorInfo.id===c||t.authorInfo.creatorId&&t.authorInfo.creatorId===c||s)&&Object(C.jsx)(be,{beforeIcon:E.D,preset:"remove",text:"Delete photo",onClick:()=>(s=>{const n=t.authorInfo.title,o=(n?"communities/community":"users/user")+t.authorInfo.id;e(l("action-confirm",{actionConfirm:{callback:()=>{const e={[`${o}/photos/${s.id}`]:null,[`${o}/profilePhotos/${s.id}`]:null};t.authorInfo.avatar===s.src&&(e[`${o}/info/avatar`]=`img/${n?"community":"user"}-default.svg`),F().update(e),D.refFromURL(s.src).delete(),f()},irreversible:!0,text:"Are you sure you want to delete this photo?"}}))})(n)})]})]})]},n.id)})),Object(C.jsx)("button",{className:"gallery-swiper__button-prev swiper-button-prev",ref:r,children:Object(C.jsx)(E.f,{})}),Object(C.jsx)("button",{className:"gallery-swiper__button-next swiper-button-next",ref:u,children:Object(C.jsx)(E.g,{})})]}),Object(C.jsx)($e.a,{className:"gallery-thumbs__container",breakpoints:{768:{slidesPerView:6}},centeredSlides:!0,onSwiper:h,slidesPerView:4,slideToClickedSlide:!0,spaceBetween:10,speed:600,children:t.content.map((e=>Object(C.jsx)(Se.a,{className:"gallery-thumbs__slide",children:Object(C.jsx)("button",{className:"gallery-thumbs__slide-button",children:Object(C.jsx)("img",{className:"gallery-thumbs__slide-img",src:e.src,alt:""})})},e.id)))})]})}Ne.a.use([we.a,ke.a,Ie.a,Ce.a]);const Le=e=>({type:"LOG_IN",user:e}),Te=e=>({type:"LOG_SYNC",user:e});let Pe,Re,Ae,De=!1;function Me(){De||(De=!0,H("guests"))}var qe=()=>e=>{var t,s;null===(t=Ae)||void 0===t||t(),null===(s=Re)||void 0===s||s(),document.cookie.split(";").forEach((t=>{try{Pe=JSON.parse(t.replace("USER_DATA=",""))}catch(s){return e(Te(null)),void Me()}if(!Pe.id)return e(Te(null)),void Me();Re=F(`users/user${Pe.id}/account`).orderByValue().equalTo(x(Pe.password,Pe.id)).on((t=>{var s;null===(s=Re)||void 0===s||s(),t?Ae=Y({callback:t=>{if(null===t||void 0===t?void 0:t.account){var s;if(t.account.deleted)return void e({type:"LOG_OUT"});e(Te(t)),ce(!!(null===(s=t.account.preferences)||void 0===s?void 0:s.darkTheme)),ie()}else e({type:"LOG_OUT"})},fields:["account","bookmarks","communities","conversations","friendRequests","info","photos","profilePhotos"],userId:Pe.id}):e(Te(null))}))}))};let Be;function ze(){const e=Object(a.b)(),{formState:{errors:t},handleSubmit:s,register:o}=Object(S.a)(),{AsyncButton:c,buttonLoadingRef:i,setButtonLoading:r}=q(),[l,u]=Object(n.useState)({});const m={errors:t,placeholder:!0,register:o};return Object(C.jsxs)("form",{className:"primary-form",action:"#",method:"post",onChange:()=>r(!1),onSubmit:s((function(t){var s;i.current||(r(),t=te(t),null===(s=Be)||void 0===s||s(),Be=F("users").orderByChild("account/email").equalTo(t.email.toLowerCase()).on((s=>{if(Be(),!i.current)return;const n=function(e){const t={...l};return e.password!==e.confirmPassword&&(t.wrongConfirmPassword=!0),u(t),t}(t);s&&(u({...n,emailExists:!0}),n.emailExists=!0),Object.values(n).includes(!0)?r(!1):F("contentData/nextUserId").once((async s=>{t.confirmPassword=null;const n=await U(),o={account:{email:t.email.toLowerCase(),id:s,password:x(t.password,s),preferences:{darkTheme:!!ae()||null},registrationData:{date:A,ip:n}},info:{avatar:"img/user-default.svg",gender:t.gender,id:s,lastName:t.lastName,lastSeen:A,name:t.name}};F().update({["users/user"+s]:o,"contentData/nextUserId":`${parseInt(s,10)+1}`}).then((()=>{e(d("sign-up")),setTimeout((()=>{e(Le(o)),e(qe())}),400)}))}))})))})),children:[Object(C.jsx)(J,{opts:{obj:G.find((e=>"name"===e.id)),...m}}),Object(C.jsx)(J,{opts:{obj:G.find((e=>"lastName"===e.id)),...m}}),Object(C.jsx)(V,{register:o}),Object(C.jsx)(J,{opts:{obj:G.find((e=>"email"===e.id)),...m},onInput:()=>u({...l,emailExists:!1})}),l.emailExists&&Object(C.jsx)("p",{className:"error-text",children:"This email is already used."}),G.filter((e=>["password","confirmPassword"].includes(e.id))).map((e=>Object(C.jsx)(J,{opts:{obj:e,...m},onInput:()=>u({...l,wrongConfirmPassword:!1})},e.id))),l.wrongConfirmPassword&&Object(C.jsx)("p",{className:"error-text",children:"Wrong confirm password."}),Object(C.jsx)(c,{testId:"sign-up-btn",text:"Sign up",type:"submit"})]})}function Fe(){const e=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(C.jsxs)("div",{className:"modals",children:[Object(C.jsx)($,{modalName:"gallery",children:Object(C.jsx)(Ee,{})}),e?Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)($,{modalName:"create-community",children:Object(C.jsx)(ye,{})}),Object(C.jsx)($,{modalName:"change-avatar",children:Object(C.jsx)(_e,{})}),Object(C.jsx)($,{modalName:"choose-photo",children:Object(C.jsx)(ge,{})}),Object(C.jsx)($,{modalName:"action-confirm",testId:"action-confirm-modal",children:Object(C.jsx)(Oe,{})}),Object(C.jsx)($,{modalName:"action-error",children:Object(C.jsx)(xe,{})}),Object(C.jsx)($,{modalName:"zoom",zoomImg:!0})]}):Object(C.jsx)($,{modalName:"sign-up",children:Object(C.jsx)(ze,{})})]})}function Ue(){const e=Object(a.b)(),t=k((e=>e.hamburger)),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=Object(n.useRef)(null),[c,r]=Object(n.useState)(!0),l=Object(n.useCallback)((()=>{r(!1),e({type:"CLOSE_HAMBURGER"})}),[e]);const d=Object(n.useCallback)((e=>{"Escape"===e.key&&t&&l()}),[l,t]);return Object(n.useEffect)((()=>(window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d))),[d]),s?Object(C.jsx)("div",{className:"hamburger"+(!c||t?" hamburger--open":""),onClick:l,children:Object(C.jsx)("div",{className:"hamburger__wrapper"+(t?" hamburger__wrapper--open":""),ref:o,onClick:e=>e.stopPropagation(),onTransitionEnd:function(e){t||e.target!==o.current||"transform"!==e.nativeEvent.propertyName||(r(!0),h())},children:Object(C.jsxs)("nav",{className:"hamburger__nav",children:[Object(C.jsxs)(i.b,{className:"hamburger__nav-link",to:"/communities",onClick:l,children:[Object(C.jsx)(E.K,{className:"hamburger__nav-link-icon"}),Object(C.jsx)("p",{className:"hamburger__nav-link-text",children:"Communities"})]}),Object(C.jsxs)(i.b,{className:"hamburger__nav-link",to:"/bookmarks",onClick:l,children:[Object(C.jsx)(E.b,{className:"hamburger__nav-link-icon"}),Object(C.jsx)("p",{className:"hamburger__nav-link-text",children:"Bookmarks"})]}),Object(C.jsxs)(i.b,{className:"hamburger__nav-link",to:"/search",onClick:l,children:[Object(C.jsx)(E.B,{className:"hamburger__nav-link-icon"}),Object(C.jsx)("p",{className:"hamburger__nav-link-text",children:"Search"})]})]})})}):null}const He=Object(n.createContext)(null);function Ye({opts:e={},...t}){let{openState:s,setOpenState:o,submenuClass:c="submenu",tag:a}=e;const i=a||n.Fragment,r=Object(n.useRef)(),[l,d]=Object(n.useState)(!1);return null!=s&&o||([s,o]=[l,d]),Object(C.jsx)(He.Provider,{value:{buttonRef:r,openState:s,setOpenState:o,submenuClass:c},children:Object(C.jsx)(i,{...t})})}function Ge({Tag:e,...t}){const{buttonRef:s,openState:o,setOpenState:c,submenuClass:a}=Object(n.useContext)(He);return Object(C.jsx)(e,{...t,ref:s,className:`${t.className} ${a}__button${o?` ${a}__button--open`:""}`,onClick:()=>c(!o)})}function Ve({Tag:e="div",...t}){const{buttonRef:s,openState:o,setOpenState:c,submenuClass:a}=Object(n.useContext)(He),i=Object(n.useRef)(),r=Object(n.useCallback)((e=>{!s.current||s.current.contains(e.target)||i.current.contains(e.target)||c(!1)}),[s,c]);return Object(n.useEffect)((()=>(window.addEventListener("click",r),()=>window.removeEventListener("click",r))),[r]),Object(C.jsx)(e,{...t,ref:i,className:`${t.className} ${a}__wrapper${o?` ${a}__wrapper--open`:""}`})}function Je(){const e=Object(a.b)(),t=Object(L.useHistory)(),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info})),[c,r]=Object(n.useState)(!0),[l,d]=Object(n.useState)(""),[u,m]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{let e=window.pageYOffset;function t(){const t=window.innerWidth>768,s=t?50:10,n=window.pageYOffset-e,o=window.pageYOffset>(t?200:40);function c(t){e=window.pageYOffset,document.documentElement.style.setProperty("--header-offset",t?"":"0px"),r(t)}n>s&&o?c(!1):n<-s&&c(!0)}return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)}),[]),Object(n.useEffect)((()=>{ae()&&(document.body.classList.add("disable-transition"),ie(),document.body.scrollHeight,document.body.classList.remove("disable-transition"))}),[]),Object(C.jsx)("header",{className:"header fixed-item"+(c?" header--visible":""),children:Object(C.jsx)("div",{className:"page-width",children:Object(C.jsxs)("div",{className:"header__wrapper",children:[Object(C.jsx)(i.b,{className:"header__logo",to:s?"/news":"/","aria-label":"Homepage",children:"Social App"}),Object(C.jsxs)("div",{className:"header__right",children:[Object(C.jsx)(pe,{link:!0,onChange:e=>d(e.target.value),onSubmit:function(e){e.preventDefault(),t.push(`/search?query=${l||""}`)},value:l}),void 0===s&&Object(C.jsx)(Ke,{}),s&&Object(C.jsx)("div",{className:"header__user",children:Object(C.jsxs)(Ye,{opts:{openState:u,setOpenState:m},children:[Object(C.jsxs)(Ge,{Tag:"button",className:"header__user-button",children:[Object(C.jsx)("p",{className:"header__user-button-name",children:o.name}),Object(C.jsx)("img",{className:"avatar__img-small",src:o.avatar,alt:"Avatar"}),Object(C.jsx)(E.e,{className:"header__user-button-icon"})]}),Object(C.jsx)(Ve,{className:"header__user-submenu",children:Object(C.jsxs)("div",{className:"header__user-submenu-wrapper",children:[Object(C.jsx)(Ke,{}),Object(C.jsx)(i.b,{className:"header__user-submenu-button",to:"/settings",onClick:()=>m(!1),children:"Settings"}),Object(C.jsx)("button",{className:"header__user-submenu-button",onClick:()=>{m(!1),e({type:"LOG_OUT"}),e(qe()),t.push("/")},children:"Log out"})]})})]})})]})]})})})}function Ke(){const e=k((e=>{var t,s,n;return null===(t=e.user)||void 0===t||null===(s=t.account)||void 0===s||null===(n=s.preferences)||void 0===n?void 0:n.darkTheme})),t=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[s,o]=Object(n.useState)("true"===ae());return Object(n.useEffect)((()=>o(t?!!e:!!ae())),[e,t]),Object(C.jsx)("label",{className:"change-theme"+(s?" change-theme--checked":""),children:Object(C.jsxs)("div",{className:"change-theme__wrapper",children:[Object(C.jsx)("input",{className:"change-theme__input",type:"checkbox","aria-label":"Toggle dark theme",checked:s,onChange:function(){if(t){const s=F(`users/user${t}/account/preferences/darkTheme`);e?s.remove():s.set(!0),o(!!e)}else ce(!ae()),ie(),o(!!ae())}}),Object(C.jsx)("div",{className:"change-theme__icon-container",children:Object(C.jsx)(E.i,{className:"change-theme__icon",style:{width:"1.1em"}})})]})})}function Ze(){const e=Object(a.b)(),t=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return t?Object(C.jsxs)("nav",{className:"mobile-nav",children:[Object(C.jsxs)(i.b,{className:"mobile-nav__link",to:"/news",children:[Object(C.jsx)(E.q,{className:"mobile-nav__link-icon",style:{width:"1.1em"}}),Object(C.jsx)("p",{className:"mobile-nav__link-text",children:"News"})]}),Object(C.jsxs)(i.b,{className:"mobile-nav__link",to:"/messages",children:[Object(C.jsx)(E.j,{className:"mobile-nav__link-icon"}),Object(C.jsx)("p",{className:"mobile-nav__link-text",children:"Messages"})]}),Object(C.jsxs)(i.b,{className:"mobile-nav__link",to:"/friends",children:[Object(C.jsx)(E.G,{className:"mobile-nav__link-icon",style:{width:"1.25em"}}),Object(C.jsx)("p",{className:"mobile-nav__link-text",children:"Friends"})]}),Object(C.jsxs)(i.b,{className:"mobile-nav__link",to:"/id"+t,children:[Object(C.jsx)(E.F,{className:"mobile-nav__link-icon"}),Object(C.jsx)("p",{className:"mobile-nav__link-text",children:"Profile"})]}),Object(C.jsxs)("button",{className:"mobile-nav__link",onClick:()=>e({type:"OPEN_HAMBURGER"}),children:[Object(C.jsx)(E.a,{className:"mobile-nav__link-icon"}),Object(C.jsx)("p",{className:"mobile-nav__link-text",children:"Other"})]})]}):null}function We(){const e=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return e?Object(C.jsx)("nav",{className:"navigation",children:Object(C.jsxs)("div",{className:"navigation__wrapper",children:[Object(C.jsxs)(i.b,{className:"navigation__link",to:"/id"+e,children:[Object(C.jsx)(E.F,{className:"navigation__link-icon"}),Object(C.jsx)("p",{className:"navigation__link-text",children:"My Profile"})]}),Object(C.jsxs)(i.b,{className:"navigation__link",to:"/news",children:[Object(C.jsx)(E.q,{className:"navigation__link-icon"}),Object(C.jsx)("p",{className:"navigation__link-text",children:"News"})]}),Object(C.jsxs)(i.b,{className:"navigation__link",to:"/messages",children:[Object(C.jsx)(E.j,{className:"navigation__link-icon"}),Object(C.jsx)("p",{className:"navigation__link-text",children:"Messages"})]}),Object(C.jsxs)(i.b,{className:"navigation__link",to:"/friends",children:[Object(C.jsx)(E.G,{className:"navigation__link-icon"}),Object(C.jsx)("p",{className:"navigation__link-text",children:"Friends"})]}),Object(C.jsxs)(i.b,{className:"navigation__link",to:"/communities",children:[Object(C.jsx)(E.K,{className:"navigation__link-icon"}),Object(C.jsx)("p",{className:"navigation__link-text",children:"Communities"})]}),Object(C.jsxs)(i.b,{className:"navigation__link",to:"/bookmarks",children:[Object(C.jsx)(E.b,{className:"navigation__link-icon"}),Object(C.jsx)("p",{className:"navigation__link-text",children:"Bookmarks"})]})]})}):null}function Qe(){const[e,t]=Object(n.useState)("scroll-to-top__button");return Object(n.useEffect)((()=>{const e=setInterval((()=>{t("scroll-to-top__button"+(window.pageYOffset<window.innerHeight?" scroll-to-top__button--hidden":""))}),100);return()=>clearInterval(e)}),[]),Object(C.jsx)("div",{className:"scroll-to-top",children:Object(C.jsx)("div",{className:"page-width",children:Object(C.jsx)("div",{className:"scroll-to-top__wrapper",children:Object(C.jsx)("button",{className:e,"aria-label":"Scroll to top",onClick:function(){document.body.scrollIntoView({behavior:"smooth",block:"start"})},children:Object(C.jsx)(E.h,{})})})})})}function Xe(){const e=Object(a.b)(),t=k((e=>e.toast)),[s,o]=Object(n.useState)(!1);Object(n.useEffect)((()=>{let s;o(!!t);const n=setTimeout((()=>{o(!1),s=setTimeout((()=>e({type:"CLOSE_TOAST"})),400)}),2e3);return()=>{clearTimeout(n),clearTimeout(s)}}),[e,t]);const c=null===t||void 0===t?void 0:t.icon;return Object(C.jsx)("div",{className:"toast"+(s?" toast--open":""),children:Object(C.jsxs)("div",{className:"toast__wrapper",children:[c&&Object(C.jsx)(c,{className:"toast__icon"}),Object(C.jsx)("p",{className:"toast__text",children:null===t||void 0===t?void 0:t.msg})]})})}function et(){const e=Object(a.b)(),t=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));return Object(n.useEffect)((()=>{if(!t)return;const e="/users/user"+t;let s;const n=F(".info/connected").on((t=>{var n;t&&(null===(n=s)||void 0===n||n.remove(),s=F(e+"/connections").push(),s.set(!0),s.onDisconnect().remove(),F(e+"/info/lastSeen").onDisconnect().set(A))}));return()=>{s.remove(),F(e+"/info/lastSeen").onDisconnect().cancel(),F(e+"/info/lastSeen").set(A),n()}}),[e,t]),Object(n.useEffect)((()=>{const t=()=>e(qe());return t(),window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)}),[e]),null}function tt(){return Object(n.useEffect)((()=>document.title="404 Not Found | Social App"),[]),Object(C.jsx)("section",{className:"error-404",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"error-404__wrapper",children:[Object(C.jsx)("p",{className:"error-404__number",children:"404"}),Object(C.jsx)("h2",{className:"error-404__title",children:"Not Found"}),Object(C.jsx)("p",{className:"error-404__text",children:"The requested page was not found on our server. It may have been removed."})]})})})}function st({communitiesInfo:e,renderSubscribeButton:t=!0}){const s=Object(a.b)(),n=Object(L.useHistory)(),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),i=k((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.communities)||void 0===s?void 0:s.subscribed}));return Object(C.jsx)("div",{className:"communities-list",children:e.map((e=>Object(C.jsx)("div",{className:"communities-list__item",children:Object(C.jsx)(ve,{bottomText:Z("subscriber",e.subscriberCount||0),childrenBottom:Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)("p",{className:"communities-list__item-description",children:e.deleted?"This community has been deleted.":e.shortDescription||"No description provided."}),t&&Object(C.jsx)(be,{preset:(null===i||void 0===i?void 0:i["community"+e.id])?"remove":"primary",testId:`community-${(null===i||void 0===i?void 0:i["community"+e.id])?"un":""}subscribe-btn`,text:(null===i||void 0===i?void 0:i["community"+e.id])?"Unsubscribe":"Subscribe",onClick:()=>oe(e.id,n,c,!!(null===i||void 0===i?void 0:i["community"+e.id]))})]}),community:!!e.id,userInfo:e,children:Object(C.jsx)(he,{bookmarkType:"community",itemId:e.id,children:!e.deleted&&o&&Object(C.jsx)(be,{text:"Delete community",onClick:()=>{return t=e,void s(l("action-confirm",{actionConfirm:{callback:()=>F(`communities/community${t.id}/fullInfo/banner/src`).once((e=>{ee(t.id,e,t.subscriberCount)})),irreversible:!0,password:!0,text:"Are you sure you want to delete this community?"}}));var t}})})})},e.id)))})}function nt({button:e,requestDate:t,singleUser:s,users:n}){const o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),c=s=>Object(C.jsx)("div",{className:"users-list__item",children:Object(C.jsx)(ve,{bottomText:t?W(t):se(s),childrenBottom:Object(C.jsxs)(C.Fragment,{children:["bookmarks"===e&&!t&&Object(C.jsx)(be,{text:"Remove from bookmarks",onClick:()=>F(`users/user${o}/bookmarks/users/user${s.info.id}`).remove()}),t&&Object(C.jsx)(be,{text:"Accept friend request",onClick:()=>Q({reqUserId:s.info.id,userId:o})})]}),userInfo:s.info})},s.info.id);return s?c(s):Object(C.jsx)("div",{className:"users-list",children:n.map((e=>c(e)))})}var ot=s(38),ct=s.n(ot);const at=Object(n.createContext)(null);function it(e){const{loadItem:t,opts:s}=Object(n.useContext)(at),o=Object(n.useRef)(),c=Object(n.useRef)(null),a=Object(n.useRef)(!1),[i,r]=Object(n.useState)({src:"#",alt:""}),l=Object(n.useCallback)((()=>{window.removeEventListener("load",d),window.removeEventListener("resize",d),window.removeEventListener("scroll",d),clearInterval(o.current)}),[]),d=Object(n.useCallback)((()=>{if(!c.current)return;const t=c.current,n=t.getBoundingClientRect().top+window.pageYOffset+s.scrollOffset-window.innerHeight;window.pageYOffset>=n&&t.offsetParent&&"hidden"!==getComputedStyle(t).visibility&&(a.current=!0,r({src:e.src,alt:e.alt||""}),l())}),[l,s.scrollOffset,e.alt,e.src]);return Object(n.useEffect)((()=>(a.current||(d(),window.addEventListener("load",d),window.addEventListener("resize",d),window.addEventListener("scroll",d),s.autoCheck&&(o.current=setInterval(d,s.autoCheckInterval))),l)),[l,d,s.autoCheck,s.autoCheckInterval]),Object(C.jsx)("img",{ref:c,...e,...i,onLoad:t})}var rt=function({opts:e={},tag:t="div",...s}){const o=t,c="string"===typeof e.animationClass?` ${e.animationClass}`:" lazy-animation";e.autoCheck="boolean"!==typeof e.autoCheck||e.autoCheck,e.autoCheckInterval=Number.isInteger(e.autoCheckInterval)?e.autoCheckInterval:2e3,e.scrollOffset=Number.isInteger(e.scrollOffset)?e.scrollOffset:0;const[a,i]=Object(n.useState)(!1),r=Object(n.useCallback)((()=>i(!0)),[]);return Object(C.jsx)(at.Provider,{value:{loadItem:r,opts:e},children:Object(C.jsx)(o,{...s,className:s.className+(a?"":c)})})};function lt({author:e,content:t,lazyLoadEnabled:s,linkStopPropagation:o,msgIndex:c,renderReplyToAuthorText:r}){var d;const u=Object(a.b)(),m=(null===(d=t.images)||void 0===d?void 0:d.map((t=>Object.values({...e.photos}).find((e=>e.id===t)))))||[],b=m.filter((e=>e));function j(t,s){t.preventDefault(),o&&t.stopPropagation(),u(l("gallery",{gallery:{authorInfo:e.info,content:b,initialSlide:b.indexOf(b.find((e=>e.id===s)))}}))}return Object(C.jsxs)("div",{className:"user-message",children:[r?r():t.text&&Object(C.jsx)(ct.a,{componentDecorator:(e,t,s)=>Object(C.jsx)("a",{className:"user-message__text-link",href:e,rel:"noreferrer",target:"_blank",onClick:e=>e.stopPropagation(),children:t},s),children:Object(C.jsx)("p",{className:"user-message__text user-message__item",children:t.text})}),m.map(((e,t)=>Object(C.jsx)(n.Fragment,{children:e?!s||c<4?Object(C.jsx)(i.b,{className:"user-message__img-container user-message__item",to:"#javascript",onClick:t=>j(t,e.id),children:Object(C.jsx)("img",{className:"user-message__img",src:e.src,alt:""})}):Object(C.jsx)(rt,{opts:{scrollOffset:-1e3},tag:i.b,className:"user-message__img-container user-message__item",to:"#javascript",onClick:t=>j(t,e.id),children:Object(C.jsx)(it,{className:"user-message__img",src:e.src,alt:""})}):Object(C.jsx)("p",{className:"user-message__deleted-photo user-message__item",children:"Deleted photo"})},t)))]})}function dt({post:e}){const{hash:t}=Object(L.useLocation)(),s=k((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),c=Object(n.useRef)(null),[a,i]=Object(n.useState)(null),[r,l]=Object(n.useState)(null),d=Object(n.useCallback)((()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.scrollIntoView({behavior:"auto",block:"start"})}),[]);Object(n.useEffect)((()=>"#comments"===t&&setTimeout(d,0)),[t,d]);const u=(t,s)=>n=>{const c=F().newKey(),a=t?`/${t}/replies`:"";return F(`posts/post${e.id}/comments${a}/${c}`).set({authorId:o,content:n,date:A,id:c,replyTo:s||null}).then((()=>{i(null),!s&&setTimeout(d,0)}))},m=Object.values({...e.comments}).sort(((e,t)=>t.date-e.date));return Object(C.jsx)("div",{ref:c,className:"post__comments-container",children:Object(C.jsxs)("div",{className:"post__comments",children:[Object(C.jsx)("div",{className:"post__comments-title",children:`Comments (${m.length})`}),Object(C.jsx)("div",{className:"post__comments-wrapper",children:m.map((t=>Object(C.jsx)(ut,{comment:t,postId:e.id,replyComment:a,selectedReply:r,setReplyComment:i,setSelectedReply:l,uploadCallback:u},t.id)))}),o&&Object(C.jsx)(fe,{avatar:s,buttonText:"Comment",inputPlaceholder:"Leave a comment",uploadCallback:u(),userId:o})]})})}function ut({comment:e,postId:t,replyComment:s,selectedReply:o,setReplyComment:c,setSelectedReply:i,uploadCallback:r}){const d=Object(a.b)(),u=Object(L.useHistory)(),m=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),b=k((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),j=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[h,f]=Object(n.useState)(),[p,v]=Object(n.useState)([]),[O,x]=Object(n.useState)([]);function _(e){var t;null===(t=document.querySelector("#"+e))||void 0===t||t.scrollIntoView({behavior:"auto",block:"center"}),i(e),setTimeout((()=>i(null)),0)}Object(n.useEffect)((()=>v(Object.values({...e.replies}))),[e.replies]),Object(n.useEffect)((()=>{const t=Y({callback:e=>f(e),fields:["info","photos"],userId:e.authorId}),s=[],n=[];return p.forEach(((e,t)=>{s.push(Y({callback:e=>{n[t]=e,n.length!==p.length||n.includes(void 0)||x([...n])},fields:["info","photos"],userId:e.authorId}))})),()=>{t(),s.forEach((e=>e()))}}),[e.authorId,p]);const g=({replies:n,replyTo:a,tempAuthor:i,tempComment:f})=>{var v;return Object(C.jsxs)("div",{className:"post__comment",id:f.id,children:[Object(C.jsx)(ue,{src:i.info.avatar,userId:i.info.id}),Object(C.jsxs)("div",{className:"post__comment-wrapper"+(f.id===o?" post__comment-wrapper--selected":""),children:[Object(C.jsx)(de,{text:W(f.date),userInfo:i.info}),Object(C.jsx)(lt,{author:i,content:f.content,renderReplyToAuthorText:f.replyTo?()=>((e,t)=>{var s;return Object(C.jsxs)("p",{className:"user-message__text user-message__item",children:[a&&Object(C.jsxs)("button",{className:"user-message__reply-to",onClick:()=>_(e),children:[Object(C.jsx)("span",{className:"user-message__reply-to-name",children:null===(s=O.find((e=>{var t;return e.info.id===(null===(t=p.find((e=>e.id===f.replyTo)))||void 0===t?void 0:t.authorId)})))||void 0===s?void 0:s.info.name}),", "]}),t]})})(f.replyTo,f.content.text):void 0}),Object(C.jsxs)("div",{className:"post__comment-footer",children:[Object(C.jsxs)("button",{className:"post__comment-footer-button",onClick:(s,o=!n&&f.id)=>{var c;return ne({condition:!!(null===(c=f.likes)||void 0===c?void 0:c["user"+j]),contentId:e.id,contentPath:`posts/post${t}/comments/${e.id}${o?`/replies/${o}`:""}`,history:u,userId:j,userPath:`comments/post${t}/${o?`reply${o}`:`comment${e.id}`}`})},children:[(null===(v=f.likes)||void 0===v?void 0:v["user"+j])?Object(C.jsx)(E.n,{className:"post__comment-footer-button-icon"}):Object(C.jsx)(E.w,{className:"post__comment-footer-button-icon"}),Object(C.jsx)("p",{className:"post__comment-footer-button-text",children:f.likeCounter||0})]}),Object(C.jsxs)("button",{className:"post__comment-footer-button",onClick:()=>{return t=f,void(j?c({author:O.find((e=>e.info.id===t.authorId))||h,commentId:e.id,reply:t}):u.push("/"));var t},children:[Object(C.jsx)(E.A,{className:"post__comment-footer-button-icon",style:{width:"1.01em"}}),Object(C.jsx)("p",{className:"post__comment-footer-button-text",children:"reply"})]}),(i.info.id===j||m)&&Object(C.jsxs)("button",{className:"post__comment-footer-delete-button",onClick:()=>{return s=n?"":f.id,void d(l("action-confirm",{actionConfirm:{callback:F(`posts/post${t}/comments/${e.id}${s?`/replies/${s}`:""}`).remove,irreversible:!0,text:"Are you sure you want to delete this comment?"}}));var s},children:[Object(C.jsx)(E.z,{className:"post__comment-footer-delete-button-icon",style:{width:".9em"}}),Object(C.jsx)("p",{className:"post__comment-footer-delete-button-text",children:"Delete"})]})]}),(null===n||void 0===n?void 0:n.length)>0&&Object(C.jsx)("div",{className:"post__comment-replies",children:n}),(null===s||void 0===s?void 0:s.commentId)===e.id&&n&&Object(C.jsx)(fe,{avatar:b,buttonText:"Reply",inputPlaceholder:"Leave a comment",uploadCallback:r(e.id,s.reply.id),userId:j,children:Object(C.jsxs)("button",{className:"post-msg__form-reply-to",type:"button",onClick:()=>_(s.reply.id),children:[Object(C.jsx)("p",{className:"post-msg__form-reply-to-text",children:`reply to ${s.author.info.name} ${s.author.info.lastName}`}),Object(C.jsx)(E.p,{className:"post-msg__form-reply-to-icon",style:{width:".62em"}})]})})]})]},f.id)};return h?g({tempAuthor:h,tempComment:e,replies:p.map(((e,t)=>O[t]&&g({tempAuthor:O[t],tempComment:e,replyTo:O.find((t=>{var s;return t.info.id===(null===(s=p.find((t=>t.id===e.replyTo)))||void 0===s?void 0:s.authorId)}))})))}):null}function mt({fetchedItems:e,index:t=0,loadingCallback:s,post:o,renderComments:c}){var r,d;const u=Object(a.b)(),m=Object(L.useHistory)(),b=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),j=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),h=Object(n.useRef)(null),[f,p]=Object(n.useState)();Object(n.useEffect)((()=>Y({callback:t=>{p(t),e.current.incrementQty(o.id,s)},community:!!o.communityId,fields:["info","photos"],userId:o.authorId||o.communityId})),[e,s,o.authorId,o.communityId,o.id]);const v=null===(r=o.views)||void 0===r?void 0:r["user"+j];return Object(n.useEffect)((()=>{if(!(null===f||void 0===f?void 0:f.info.id)||!j||v)return;let e;const t=new IntersectionObserver((([t])=>{t.isIntersecting?e=setTimeout((()=>{const e=`posts/post${o.id}/`;F().update({[`${e}viewCounter`]:R(1),[`${e}views/user${j}`]:{date:A,userId:j}})}),5e3):clearInterval(e)}),{threshold:.5});return t.observe(h.current),()=>{t.disconnect(),clearTimeout(e)}}),[o.id,null===f||void 0===f?void 0:f.info.id,v,j]),f?Object(C.jsxs)("article",{className:"post",ref:h,children:[Object(C.jsxs)("div",{className:"post__main",children:[Object(C.jsx)(ve,{bottomText:W(o.date),bottomTextLink:"/post"+o.id,community:!!o.communityId,userInfo:f.info,children:Object(C.jsx)(he,{bookmarkType:"post",itemId:o.id,children:(f.info.id===j||f.info.creatorId&&f.info.creatorId===j||b)&&Object(C.jsx)(be,{testId:"delete-post-btn",text:"Delete post",onClick:function(){u(l("action-confirm",{actionConfirm:{callback:F("posts/post"+o.id).remove,irreversible:!0,text:"Are you sure you want to delete this post?"}}))}})})}),Object(C.jsx)(lt,{author:f,content:o.content,lazyLoadEnabled:!0,msgIndex:t}),Object(C.jsxs)("div",{className:"post__footer",children:[Object(C.jsxs)("div",{className:"post__footer-left",children:[Object(C.jsxs)("button",{className:"post__footer-button post__footer-item",onClick:()=>{var e;return ne({condition:!!(null===(e=o.likes)||void 0===e?void 0:e["user"+j]),contentId:o.id,contentPath:`posts/post${o.id}`,history:m,userId:j,userPath:`posts/post${o.id}`})},children:[(null===(d=o.likes)||void 0===d?void 0:d["user"+j])?Object(C.jsx)(E.n,{className:"post__footer-button-icon"}):Object(C.jsx)(E.w,{className:"post__footer-button-icon"}),Object(C.jsx)("p",{className:"post__footer-button-text",children:o.likeCounter||0})]}),Object(C.jsxs)(i.b,{className:"post__footer-button post__footer-item",to:`/post${o.id}#comments`,children:[Object(C.jsx)(E.t,{className:"post__footer-button-icon"}),Object(C.jsx)("p",{className:"post__footer-button-text",children:Object.keys({...o.comments}).length})]}),Object(C.jsxs)("button",{className:"post__footer-button post__footer-item",children:[Object(C.jsx)(E.y,{className:"post__footer-button-icon",style:{width:"1.1em"}}),Object(C.jsx)("p",{className:"post__footer-button-text",children:o.shareCounter||0})]})]}),Object(C.jsx)("div",{className:"post__footer-right",children:Object(C.jsxs)("div",{className:"post__footer-item",children:[Object(C.jsx)(E.m,{className:"post__footer-button-icon",style:{width:"1.1em"}}),Object(C.jsx)("p",{className:"post__footer-button-text",children:o.viewCounter||0})]})})]})]}),c&&Object(C.jsx)(dt,{post:o})]}):null}function bt(){var e;const t=Object(L.useHistory)(),{search:s}=Object(L.useLocation)(),o=new URLSearchParams(s).get("tab"),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.bookmarks})),a=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),r=["communities","users"].find((e=>e===o))||"posts",l=Object(n.useRef)(),[d,u]=Object(n.useState)([]),{fetchedItems:m,finishLoading:b}=M(),j=Object(n.useCallback)((()=>b("Bookmarks")),[b]);Object(n.useEffect)((()=>{if(void 0===a&&t.replace("/"),!a)return;const e=Object.values({...null===c||void 0===c?void 0:c[r]});e.sort(((e,t)=>t.date-e.date)),e.length||(j(),u([]));const s=[],n=[],o=(t,s,o)=>{n[o]=t||{id:s.id,unavailable:!0},n.length!==e.length||n.includes(void 0)||(u([...n]),["users","communities"].includes(r)?j():m.current.setExpected(n.length,j)),!t&&m.current.incrementQty(s.id,j)};return e.forEach(((e,t)=>{["communities","users"].includes(r)?s.push(Y({callback:s=>o(s,e,t),community:"communities"===r,fields:"communities"===r?["fullInfo","info"]:["connections","info"],userId:e.id})):s.push(F("posts/post"+e.id).on((s=>o(s,e,t))))})),()=>s.forEach((e=>e()))}),[r,m,t,j,c,a]),Object(n.useEffect)((()=>l.current=r),[r]);const h=d.filter((e=>!e.unavailable)),f=null===(e=d.filter((e=>e.unavailable)))||void 0===e?void 0:e.length,p=e=>"sidebar__button"+(r===e?" sidebar__button--active":"");return Object(C.jsxs)("section",{className:"bookmarks",children:[Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"bookmarks__wrapper",children:[Object(C.jsxs)("div",{className:"bookmarks__header",children:[Object(C.jsx)("h1",{className:"bookmarks__header-title",children:`${r} bookmarks (${d.length})`}),f>0&&Object(C.jsxs)("p",{className:"bookmarks__header-unavailable",children:[f+" unavailable item(s) are hidden ",Object(C.jsx)("button",{className:"bookmarks__header-unavailable-remove",onClick:function(){const e="communities"===r?"community":r.slice(0,-1);F().update(d.reduce(((t,s)=>(s.unavailable&&(t[`users/user${a}/bookmarks/${r}/${e+s.id}`]=null),t)),{}))},children:"(Remove)."})]})]}),Object(C.jsx)("div",{className:"bookmarks__content",children:r===l.current&&("posts"===r?h.map(((e,t)=>Object(C.jsx)(mt,{fetchedItems:m,index:t,loadingCallback:j,post:e},e.id))):"users"===r?Object(C.jsx)(nt,{button:"bookmarks",users:h}):Object(C.jsx)(st,{communitiesInfo:h.map((e=>e.info))}))})]})}),Object(C.jsx)("aside",{className:"sidebar",children:Object(C.jsxs)("div",{className:"sidebar__wrapper",children:[Object(C.jsx)(i.b,{className:p("posts"),to:"/bookmarks",children:`Posts (${Object.keys({...null===c||void 0===c?void 0:c.posts}).length})`}),Object(C.jsx)(i.b,{className:p("users"),to:"?tab=users",children:`Users (${Object.keys({...null===c||void 0===c?void 0:c.users}).length})`}),Object(C.jsx)(i.b,{className:p("communities"),to:"?tab=communities",children:`Communities (${Object.keys({...null===c||void 0===c?void 0:c.communities}).length})`})]})})]})}function jt(){const e=Object(a.b)(),t=Object(L.useHistory)(),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[c,i]=Object(n.useState)([]),[r,d]=Object(n.useState)(),[u,m]=Object(n.useState)([]),{finishLoading:b}=M();return Object(n.useEffect)((()=>{if(null!==s)return F("communities").on((e=>{b("Communities");const t=Object.values({...e}),n=t.filter((e=>e.info.creatorId!==s));Object(o.unstable_batchedUpdates)((()=>{i(t.filter((e=>e.info.creatorId===s))),d(n.filter((e=>{var t;return!(null===(t=e.subscribers)||void 0===t?void 0:t["user"+s])&&!e.info.deleted}))),m(n.filter((e=>{var t;return null===(t=e.subscribers)||void 0===t?void 0:t["user"+s]})))}))}))}),[b,s]),r?Object(C.jsx)("section",{className:"communities",children:Object(C.jsxs)("div",{className:"content-width",children:[Object(C.jsxs)("div",{className:"communities__header",children:[Object(C.jsx)("h1",{className:"communities__title",children:"Communities"}),Object(C.jsx)(be,{testId:"open-create-community-modal",text:"Create new community",onClick:()=>s?e(l("create-community")):t.push("/")})]}),c.length>0&&Object(C.jsxs)("div",{className:"communities__item",children:[Object(C.jsx)("div",{className:"communities__item-header",children:Object(C.jsx)("h2",{className:"communities__item-title",children:`My communities (${c.length})`})}),Object(C.jsx)(st,{communitiesInfo:c.map((e=>e.info)),renderSubscribeButton:!1})]}),u.length>0&&Object(C.jsxs)("div",{className:"communities__item",children:[Object(C.jsx)("div",{className:"communities__item-header",children:Object(C.jsx)("h2",{className:"communities__item-title",children:`Subscribed (${u.length})`})}),Object(C.jsx)(st,{communitiesInfo:u.map((e=>e.info))})]}),r.length>0&&Object(C.jsxs)("div",{className:"communities__item",children:[Object(C.jsx)("div",{className:"communities__item-header",children:Object(C.jsx)("h2",{className:"communities__item-title",children:`Explore (${r.length})`})}),Object(C.jsx)(st,{communitiesInfo:r.map((e=>e.info))})]})]})}):null}function ht(){var e,t,s,o,c,r;const d=Object(a.b)(),u=Object(L.useHistory)(),{communityId:m}=Object(L.useParams)(),b=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),j=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),h=k((e=>{var t,s,n;return null===(t=e.user)||void 0===t||null===(s=t.communities)||void 0===s||null===(n=s.subscribed)||void 0===n?void 0:n["community"+m]})),{AsyncButton:f,buttonLoading:p,setButtonLoading:v}=q(),{addImgPreview:O,imgPreview:x,setImgPreview:_}=B(!1),g=Object(n.useRef)([]),[y,N]=Object(n.useState)(),[w,I]=Object(n.useState)(),[$,S]=Object(n.useState)(!1),[T,P]=Object(n.useState)(),[R,A]=Object(n.useState)(!1),{fetchedItems:z,finishLoading:U,loaded:H,setTitle:G}=M(),V=Object(n.useCallback)((()=>U(y.info.title)),[y,U]);function J(){d(l("action-confirm",{actionConfirm:{callback:()=>{var e;return ee(m,null===(e=y.fullInfo.banner)||void 0===e?void 0:e.src,y.info.subscriberCount)},irreversible:!0,password:!0,text:"Are you sure you want to delete this community?"}}))}return Object(n.useEffect)((()=>{if(null===j)return;let e,t;const s=Y({callback:s=>{if(g.current=[],null===s||void 0===s?void 0:s.profilePhotos){for(const e in s.profilePhotos){var n;(null===(n=s.photos)||void 0===n?void 0:n[e])&&g.current.push(s.photos[e])}g.current.sort(((e,t)=>t.date-e.date))}N(s),s?((t=>{var s;t.info.deleted||(null===(s=e)||void 0===s||s(),e=Y({callback:e=>I([e.info]),userId:t.info.creatorId}))})(s),(()=>{var e;null===(e=t)||void 0===e||e(),t=F("posts").orderByChild("communityId").equalTo(m).on((e=>{const t=Object.values({...e});P(t.sort(((e,t)=>+t.id-+e.id))),z.current.setExpected(t.length)}))})()):U()},community:!0,fields:["fullInfo","info","photos","profilePhotos"],userId:m});return()=>{var n,o;s(),null===(n=e)||void 0===n||n(),null===(o=t)||void 0===o||o()}}),[m,z,U,j]),Object(n.useEffect)((()=>{H.current&&y?G(y.info.title):T?V():null!==T&&null!==y||U()}),[y,U,H,V,T,G]),void 0===y?null:y?Object(C.jsxs)("section",{className:"community",children:[Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"community__content",children:[Object(C.jsxs)("div",{className:"community__header",children:[y.info.creatorId!==j&&!b||y.info.deleted?(null===(o=y.fullInfo)||void 0===o?void 0:o.banner)&&Object(C.jsx)("div",{className:"community__banner",children:Object(C.jsx)("img",{className:"community__banner-img",src:null===(c=y.fullInfo)||void 0===c?void 0:c.banner.src,alt:""})}):x[0]?Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)("div",{className:"community__banner",children:Object(C.jsx)("img",{className:"community__banner-img",src:x[0].result,alt:""})}),Object(C.jsxs)("div",{className:"community__header-buttons",children:[Object(C.jsx)(f,{text:"Confirm banner",onClick:function(){var e;if(p)return;v();const t=null===(e=y.fullInfo.banner)||void 0===e?void 0:e.src;re({callback:()=>{t&&D.refFromURL(t).delete(),v(!1),_([])},communityId:m,createId:!1,file:x[0].file,imgParent:"fullInfo",imgPath:"banner",storagePrefix:"community"+m})}}),!p&&Object(C.jsx)(be,{preset:"secondary",text:"Cancel",onClick:()=>_([])})]})]}):Object(C.jsxs)("label",{className:"community__banner-upload",htmlFor:"community__banner-overlay-input",children:[Object(C.jsxs)("button",{className:"community__banner-button community__banner",onClick:e=>{var t;return null===(t=e.target.closest("label"))||void 0===t?void 0:t.click()},children:[(null===(e=y.fullInfo)||void 0===e?void 0:e.banner)?Object(C.jsx)("img",{className:"community__banner-img",src:null===(t=y.fullInfo)||void 0===t?void 0:t.banner.src,alt:""}):Object(C.jsx)("p",{className:"community__banner-placeholder",children:"No banner"}),Object(C.jsxs)("div",{className:"community__banner-overlay",children:[Object(C.jsx)(E.x,{className:"community__banner-overlay-icon",style:{height:"1.1em"}}),Object(C.jsx)("p",{className:"community__banner-overlay-text",children:((null===(s=y.fullInfo)||void 0===s?void 0:s.banner)?"Change":"Set")+" banner"})]})]}),Object(C.jsx)("input",{className:"community__banner-overlay-input",id:"community__banner-overlay-input",type:"file",accept:".jpg, .jpeg, .png",hidden:!0,onChange:O})]}),Object(C.jsxs)("div",{className:"community__info",children:[Object(C.jsxs)("div",{className:"community__info-content",children:[Object(C.jsx)(me,{avatar:g.current.find((e=>e.src===y.info.avatar)),userInfo:y.info}),Object(C.jsxs)("div",{className:"community__info-text",children:[Object(C.jsx)(je,{className:"community-title",databaseRef:`communities/community${m}/info/title`,disabled:y.info.deleted,field:y.info.title,ownerId:y.info.creatorId,renderInputId:"title"}),Object(C.jsx)("p",{className:"community__info-subscribers",children:Z("subscriber",y.info.subscriberCount||0)}),$&&Object(C.jsx)("div",{className:"community__contacts",children:null===w||void 0===w?void 0:w.map((e=>Object(C.jsx)(ve,{avatarSize:"small",bottomText:"Creator",userInfo:e},e.id)))})]})]}),Object(C.jsxs)("div",{className:"community__info-buttons",children:[Object(C.jsx)(be,{className:"community-subscribe",preset:h?"remove":"primary",text:h?"Unsubscribe":"Subscribe",onClick:()=>oe(m,u,j,!!h)}),!y.info.deleted&&Object(C.jsx)("button",{className:"community__toggle",onClick:()=>S(!$),children:($?"Hide":"Show")+" contacts"})]})]}),(j===y.info.creatorId||b)&&Object(C.jsxs)("div",{className:"community__info-footer-buttons",children:[Object(C.jsx)(be,{text:"Change avatar",onClick:()=>d(l("change-avatar",{changeAvatarCommunityId:m}))}),Object(C.jsx)(be,{preset:"remove",text:"Delete community",onClick:J})]})]}),Object(C.jsxs)("div",{className:"community__description",children:[Object(C.jsx)("h3",{className:"community__description-title",children:"Description"}),Object(C.jsxs)("div",{className:"community__description-wrapper",children:[Object(C.jsx)(je,{databaseRef:`communities/community${m}/fullInfo/description`,disabled:y.info.deleted,emptyButtonText:"Set description",emptyFieldText:"No description provided.",field:y.info.deleted?"This community has been deleted.":null===(r=y.fullInfo)||void 0===r?void 0:r.description,ownerId:y.info.creatorId,renderInputId:"description"}),R&&Object(C.jsxs)("div",{className:"community__description-short",children:[Object(C.jsx)("h4",{className:"community__description-short-title",children:"Short description:"}),Object(C.jsx)(je,{databaseRef:`communities/community${m}/info/shortDescription`,disabled:y.info.deleted,emptyButtonText:"Set short description",emptyFieldText:"No description provided.",field:y.info.deleted?"This community has been deleted.":y.info.shortDescription,ownerId:y.info.creatorId,renderInputId:"shortDescription"})]}),(j===y.info.creatorId||b)&&!y.info.deleted&&Object(C.jsx)("button",{className:"community__toggle",onClick:()=>A(!R),children:(R?"Hide":"Show")+" short description"})]})]}),j===y.info.creatorId&&!y.info.deleted&&Object(C.jsx)(fe,{addToPhotosButton:!0,avatar:y.info.avatar,community:!!m,userId:m}),!y.info.deleted&&Object(C.jsxs)("div",{className:"community__posts",children:[Object(C.jsx)("div",{className:"community__posts-header",children:Object(C.jsx)(i.b,{className:"community__posts-title",to:"#todo",children:"Posts"})}),null===T||void 0===T?void 0:T.map(((e,t)=>Object(C.jsx)(mt,{fetchedItems:z,index:t,loadingCallback:V,post:e},e.id)))]})]})}),!y.info.deleted&&Object(C.jsxs)("aside",{className:"community__sidebar sidebar",children:[Object(C.jsx)("h3",{className:"community__sidebar-title",children:`Contacts (${null===w||void 0===w?void 0:w.length})`}),Object(C.jsx)("div",{className:"community__sidebar-content",children:Object(C.jsx)("div",{className:"community__contacts",children:null===w||void 0===w?void 0:w.map((e=>Object(C.jsx)(ve,{avatarSize:"small",bottomText:"Creator",userInfo:e},e.id)))})}),(j===y.info.creatorId||b)&&Object(C.jsxs)("div",{className:"community__sidebar-buttons",children:[Object(C.jsx)(be,{text:"Change avatar",onClick:()=>d(l("change-avatar",{changeAvatarCommunityId:m}))}),Object(C.jsx)(be,{preset:"remove",testId:"delete-community-btn",text:"Delete community",onClick:J})]})]})]}):Object(C.jsx)(tt,{})}function ft(){const e=Object(a.b)(),t=Object(L.useHistory)(),{search:s}=Object(L.useLocation)(),c=new URLSearchParams(s).get("interlocutor"),{conversationId:i}=Object(L.useParams)(),r=k((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),d=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.conversations})),u=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),m=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.info})),b=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.photos})),[j,h]=Object(n.useState)(null),[f,p]=Object(n.useState)(null),[v,O]=Object(n.useState)(),[x,_]=Object(n.useState)([]),{finishLoading:g,loaded:y}=M(),N=Object(n.useRef)(),w=Object(n.useRef)(!1);w.current=!!c||!!(null===d||void 0===d?void 0:d["conversation"+i]);const I=Object(n.useRef)([]),$=()=>I.current.forEach((e=>e())),S=Object(n.useCallback)((()=>{window.innerHeight<document.body.offsetHeight&&window.scrollTo(0,document.body.offsetHeight)}),[]);Object(n.useEffect)((()=>(null===j||void 0===j?void 0:j.info.id)&&setTimeout(S,0)),[null===j||void 0===j?void 0:j.info.id,S]);const T=Object(n.useCallback)((()=>{h(null),p(null),O([]),!y.current&&g()}),[g,y]);Object(n.useEffect)((()=>{!i&&!c&&T()}),[i,T,c]),Object(n.useEffect)((()=>void 0===u&&t.push("/")),[t,u]);const P=Object(n.useCallback)((e=>{u&&(N.current=Y({callback:t=>{!y.current&&g("Conversation"),Object(o.unstable_batchedUpdates)((()=>{h(e),p(t),O([t,{info:m,photos:b}])}))},fields:["connections","info","photos"],userId:e.info.participants.find((e=>e!==u))}))}),[g,y,u,m,b]),R=Object(n.useCallback)((e=>{const t=Object.values({...d}),s=[];I.current=[];t.forEach(((n,o)=>{I.current.push(F(`conversations/conversation${n}/info/participants`).on((n=>{s[o]=n,(()=>{if(s.length===t.length&&!s.includes(void 0)){$();for(const n of s)if(n.includes(u)&&n.includes(c||(null===f||void 0===f?void 0:f.info.id)))return void e(t[s.indexOf(n)]);e()}})()})))}))}),[null===f||void 0===f?void 0:f.info.id,c,d,u]);Object(n.useEffect)((()=>$),[null===f||void 0===f?void 0:f.info.id,c,d,u]),Object(n.useEffect)((()=>{if(!i&&c&&u){if(u!==c)return R((e=>{e?t.replace("/conversation"+e):P({info:{id:"0",lastMessage:null,participants:[u,c]},messages:[]})})),N.current;T()}}),[R,T,i,P,t,c,u]),Object(n.useEffect)((()=>{if(!i||!u)return;if(!w.current)return void g();const e=F("conversations/conversation"+i).on((e=>{e?(e.messages=Object.values({...e.messages}).sort(((e,t)=>e.date-t.date)),P(e)):T()}));return()=>{var t;e(),null===(t=N.current)||void 0===t||t.call(N)}}),[T,i,P,g,d,u]);function D(e){if(x.find((t=>t.id===e.id))){const t=[...x];t.splice(x.indexOf(e),1),_(t)}else _([...x,e])}return null===u||!v&&w.current?null:void 0!==u&&f&&v&&w.current?Object(C.jsx)("section",{className:"conversation",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"conversation__wrapper",children:[Object(C.jsx)("div",{className:"conversation__header",children:Object(C.jsxs)("div",{className:"conversation__header-wrapper",children:[Object(C.jsxs)("div",{className:"conversation__header-interlocutor",children:[Object(C.jsx)(ue,{size:"small",src:f.info.avatar,userId:f.info.id}),Object(C.jsx)(de,{text:se(f),userInfo:f.info})]}),x.length>0&&Object(C.jsxs)("div",{className:"conversation__header-overlay",children:[Object(C.jsxs)("button",{className:"conversation__header-overlay-qty",onClick:()=>_([]),children:[Object(C.jsx)("span",{className:"conversation__header-overlay-qty-icon",children:"\xd7"}),Z("message",x.length)]}),Object(C.jsxs)("div",{className:"conversation__header-overlay-buttons",children:[Object(C.jsx)("button",{className:"conversation__header-overlay-button",onClick:function(){var t,s;navigator.clipboard.writeText(x.reduce(((e,t)=>e+(t.content.text+" ")),"").trim()),e((t="Copied text to clipboard.",s=E.s,{type:"OPEN_TOAST",msg:t,icon:s}))},children:Object(C.jsx)(E.s,{})}),Object(C.jsx)("button",{className:"conversation__header-overlay-button",onClick:function(){const t=x.map((e=>e.id)),s=j.messages.filter((e=>!t.includes(e.id)));x.find((e=>e.authorId!==u))?e(l("action-error",{actionError:"You can't delete someone else's messages. Try to select only your own messages and try again."})):e(l("action-confirm",{actionConfirm:{callback:()=>{_([]);const e=`conversations/conversation${i}/`,t={[e+"info/lastMessage"]:s[s.length-1]||{date:j.info.lastMessage.date}};x.forEach((s=>t[`${e}messages/${s.id}`]=null)),F().update(t)},irreversible:!0,text:`Are you sure you want to delete ${Z("message",x.length)}?`}}))},children:Object(C.jsx)(E.z,{})})]})]})]})}),Object(C.jsx)("div",{className:"conversation__content",children:j.messages.map(((e,t)=>Object(C.jsx)(pt,{index:t,message:e,participants:v,previousMessage:j.messages[t-1],selectedMessages:x,selectMessage:D},e.id)))}),Object(C.jsx)("div",{className:"conversation__footer",children:Object(C.jsx)("div",{className:"conversation__footer-wrapper",children:Object(C.jsx)(fe,{avatar:r,buttonText:"Message",inputPlaceholder:"Your message",uploadCallback:e=>new Promise((s=>{function n(n,o){const a=F().newKey(),r={authorId:u,content:e,date:A,id:a},l=e=>`users/user${e}/conversations/conversation${n}`,d=`conversations/conversation${n}/`;F().update(o?{"contentData/nextConversationId":`${parseInt(n,10)+1}`,["conversations/conversation"+n]:{info:{id:n,lastMessage:r,participants:v.map((e=>e.info.id))},messages:{[a]:r}},[l(u)]:n,[l(c)]:n}:{[d+"info/lastMessage"]:r,[d+"messages/"+a]:r}).then((()=>{(o||i!==n)&&t.replace("/conversation"+n),s(),S()}))}"0"===(null===j||void 0===j?void 0:j.info.id)?R((e=>{e?n(e):F("contentData/nextConversationId").once((e=>n(e,!0)))})):n(null===j||void 0===j?void 0:j.info.id)})),userId:u})})})]})})}):Object(C.jsx)(tt,{})}function pt({index:e,message:t,participants:s,previousMessage:n,selectedMessages:o,selectMessage:c}){const a=s.find((e=>e.info.id===t.authorId)),i=0===e||t.authorId!==n.authorId||t.date>n.date+3e5;return Object(C.jsxs)("button",{className:"conversation__message"+(o.find((e=>e.id===t.id))?" conversation__message--selected":""),onClick:()=>c(t),children:[i&&Object(C.jsx)(ue,{size:"small",src:s.find((e=>e.info.id===t.authorId)).info.avatar,userId:t.authorId,onClick:e=>e.stopPropagation()}),Object(C.jsxs)("div",{className:"conversation__message-wrapper",children:[i&&Object(C.jsx)(de,{onlyName:!0,text:W(t.date),userInfo:s.find((e=>e.info.id===t.authorId)).info,onClick:e=>e.stopPropagation()}),Object(C.jsx)(lt,{author:a,content:t.content,linkStopPropagation:!0})]})]})}function vt(){const{search:e}=Object(L.useLocation)(),{ownerId:t}=Object(L.useParams)(),s=new URLSearchParams(e).get("tab"),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.friendRequests})),[a,r]=Object(n.useState)(),[l,d]=Object(n.useState)(!1),u=Object(n.useRef)(""),{fetchedItems:m,finishLoading:b,loaded:j,setTitle:h}=M(),f=Object(n.useCallback)((()=>b(u.current)),[b]);if(Object(n.useEffect)((()=>{if(null!==o)return Y({callback:e=>r(e),fields:["friends","info"],userId:t||o})}),[m,t,o]),Object(n.useEffect)((()=>{(null===a||void 0===a?void 0:a.info.id)?(u.current=a.info.id===o?"requests"===s?"My friend requests":"My friends":`${a.info.name} ${a.info.lastName}'s friends`,j.current&&h(u.current),l||d(!0),m.current.setExpected(Object.keys("requests"===s?{...null===c||void 0===c?void 0:c.received}:{...a.friends}).length,f)):null===a&&(d(!0),b())}),[m,b,a,j,f,s,h,l,null===c||void 0===c?void 0:c.received,o]),!l)return null;if(!a)return Object(C.jsx)(tt,{});const p=Object.values({...a.friends}),v=Object.values({...null===c||void 0===c?void 0:c.received}),O=a.info.id===o&&"requests"===s;return Object(C.jsxs)("section",{className:"friends",children:[Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"friends__wrapper",children:[Object(C.jsx)("div",{className:"friends__header",children:Object(C.jsx)(i.b,{className:"friends__title",to:"/id"+a.info.id,children:O?`Your friend requests (${v.length})`:`${a.info.id!==o?`${a.info.name}'s`:"Your"} friends (${p.length})`})}),(O?v:p).length>0&&Object(C.jsx)("div",{className:"users-list",children:(O?v:p).map((e=>Object(C.jsx)(Ot,{fetchedItems:m,friendId:e.userId,friendRequestDate:e.date,loadingCallback:f},e.userId)))})]})}),a.info.id===o&&Object(C.jsx)("aside",{className:"sidebar",children:Object(C.jsxs)("div",{className:"sidebar__wrapper",children:[Object(C.jsx)(i.b,{className:"sidebar__button"+("requests"!==s?" sidebar__button--active":""),to:"/friends",children:`Friends (${p.length})`}),Object(C.jsx)(i.b,{className:"sidebar__button"+("requests"===s?" sidebar__button--active":""),to:"?tab=requests",children:`Friend requests (${v.length})`})]})})]})}function Ot({fetchedItems:e,friendId:t,friendRequestDate:s,loadingCallback:o}){const[c,a]=Object(n.useState)();return Object(n.useEffect)((()=>Y({callback:s=>{a(s),e.current.incrementQty(t,o)},fields:["connections","info"],userId:t})),[e,t,o]),c?Object(C.jsx)(nt,{requestDate:s,singleUser:c}):null}let xt;function _t(){const e=Object(a.b)(),t=Object(L.useHistory)(),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{formState:{errors:o},handleSubmit:c,register:r}=Object(S.a)(),{AsyncButton:d,buttonLoadingRef:u,setButtonLoading:m}=q(),[b,j]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{s?t.replace("/news"):void 0===s&&(document.title="Log in | Social App")}),[t,s]),void 0!==s?null:Object(C.jsx)("section",{className:"home",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"home__wrapper",children:[Object(C.jsxs)("div",{className:"home__info",children:[Object(C.jsx)("h1",{className:"home__info-title",children:"Social App"}),Object(C.jsx)("p",{className:"home__info-text",children:"Connect with your friends and communities on Social App."})]}),Object(C.jsxs)("div",{className:"home__content",children:[Object(C.jsxs)("form",{className:"primary-form",action:"#",method:"post",noValidate:!0,onChange:()=>m(!1),onSubmit:c((function(s){var n;u.current||(m(),null===(n=xt)||void 0===n||n(),xt=F("users").orderByChild("account/email").equalTo(s.email).on((n=>{if(xt(),u.current){if(n){const o=Object.values(n)[0];(null===o||void 0===o?void 0:o.account.email)===s.email&&_(o.account.password)===s.password?(H("users/user"+o.account.id),e(Le(o)),e(qe()),t.replace("/news")):j(!0)}else j(!0);m(!1)}})))})),children:[Object(C.jsx)(J,{autoFocus:!0,id:"home__form-email",onInput:()=>j(!1),opts:{obj:G.find((e=>"email"===e.id)),errors:o,label:!0,placeholder:!0,register:r}}),Object(C.jsx)(J,{id:"home__form-password",onInput:()=>j(!1),opts:{obj:G.find((e=>"existingPassword"===e.id)),errors:o,label:!0,placeholder:!0,register:r}}),b&&Object(C.jsx)("p",{className:"error-text",children:"Wrong email or password."}),Object(C.jsx)(d,{testId:"log-in-btn",text:"Log in",type:"submit"})]}),Object(C.jsx)(i.b,{className:"home__content-forgot-password",to:"#todo",children:"Forgot password?"}),Object(C.jsx)("hr",{className:"home__content-hr"}),Object(C.jsx)(be,{preset:"secondary",testId:"open-sign-up-modal",text:"Sign up",onClick:()=>e(l("sign-up"))})]})]})})})}function gt(){const e=Object(L.useHistory)(),t=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.conversations})),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[o,c]=Object(n.useState)(),{fetchedItems:a,finishLoading:i}=M(),r=Object(n.useCallback)((()=>i("Messages")),[i]);return Object(n.useEffect)((()=>{if(!s)return;if(!t)return r(),void c([]);const e=Object.values({...t}),n=[],o=[];return e.forEach(((t,s)=>{n[s]=F(`conversations/conversation${t}/info`).on((t=>{o[s]=t,o.includes(void 0)||o.length!==e.length||(c(o.sort(((e,t)=>t.lastMessage.date-e.lastMessage.date))),a.current.setExpected(e.length,r))}))})),()=>n.forEach((e=>e()))}),[a,r,t,s]),Object(n.useEffect)((()=>void 0===s&&e.push("/")),[e,s]),void 0!==s&&o?Object(C.jsx)("section",{className:"messages",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsx)("div",{className:"messages__wrapper",children:o.length?o.map((e=>Object(C.jsx)(yt,{conversation:e,fetchedItems:a,loadingCallback:r},e.id))):Object(C.jsx)("p",{className:"no-content",children:"No messages"})})})}):null}function yt({conversation:e,fetchedItems:t,loadingCallback:s}){var o;const c=k((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),a=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[i,r]=Object(n.useState)();return Object(n.useEffect)((()=>Y({callback:e=>{r(e.info),t.current.incrementQty(e.info.id,s)},userId:e.participants.find((e=>e!==a))})),[e.participants,t,s,a]),i?Object(C.jsx)("div",{className:"messages__item",children:Object(C.jsx)(ve,{bottomText:e.lastMessage&&W(e.lastMessage.date,!0),childrenBottom:(null===(o=e.lastMessage)||void 0===o?void 0:o.content)?Object(C.jsxs)("div",{className:"messages__item-last-message",children:[Object(C.jsx)("img",{className:"avatar__img-small",src:e.lastMessage.authorId===a?c:i.avatar,alt:"Avatar"}),Object(C.jsx)("p",{className:"messages__item-last-message-content",children:e.lastMessage.content.text||"Photo"})]}):Object(C.jsx)("p",{className:"messages__item-no-messages",children:"No messages yet"}),userInfo:i,wrapperLink:"/conversation"+e.id})}):null}function Nt(){const e=Object(L.useHistory)(),t=k((e=>{var t,s;return null===(t=e.user)||void 0===t||null===(s=t.info)||void 0===s?void 0:s.avatar})),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[o,c]=Object(n.useState)([]),{fetchedItems:a,finishLoading:i}=M(),r=Object(n.useCallback)((()=>i("News")),[i]);return Object(n.useEffect)((()=>{if(void 0===s&&e.replace("/"),s)return F("posts").on((e=>{const t=Object.values(e);c(t.sort(((e,t)=>+t.id-+e.id))),a.current.setExpected(t.length,r)}))}),[a,e,r,s]),s&&o.length?Object(C.jsx)("section",{className:"news",children:Object(C.jsxs)("div",{className:"content-width",children:[Object(C.jsx)(fe,{addToPhotosButton:!0,avatar:t,userId:s}),o.map(((e,t)=>Object(C.jsx)(mt,{fetchedItems:a,index:t,loadingCallback:r,post:e},e.id)))]})}):null}function wt(){const e=Object(a.b)(),{ownerId:t}=Object(L.useParams)(),s=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[o,c]=Object(n.useState)([]),[r,d]=Object(n.useState)();Object(n.useEffect)((()=>{if(null!==s)return Y({callback:e=>{const t=[];for(const s in null===e||void 0===e?void 0:e.profilePhotos)(null===e||void 0===e?void 0:e.photos)&&t.push(e.photos[s]);c(t.sort(((e,t)=>t.date-e.date))),d(e)},fields:["info","photos","profilePhotos"],userId:t||s})}),[t,s]);const{finishLoading:u,loaded:m,setTitle:b}=M();return Object(n.useEffect)((()=>{const e=t!==s&&t?`${null===r||void 0===r?void 0:r.info.name} ${null===r||void 0===r?void 0:r.info.lastName}'s photos`:"My photos";m.current?b(e):r?u(e):null===r&&u()}),[m,t,r,u,s,b]),void 0===r?null:r?Object(C.jsx)("section",{className:"photos",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"photos__wrapper",children:[Object(C.jsx)("div",{className:"photos__header",children:Object(C.jsx)(i.b,{className:"photos__title",to:"/id"+r.info.id,children:`${t!==s&&t?`${r.info.name}'s`:"My"} photos (${o.length})`})}),Object(C.jsx)("div",{className:"photos__items",children:o.map(((t,s)=>Object(C.jsx)(i.b,{className:"photos__item",to:"#javascript",onClick:t=>{e(l("gallery",{gallery:{authorInfo:r.info,content:o,initialSlide:s}})),t.preventDefault()},children:Object(C.jsx)("img",{className:"photos__item-img",src:t.src,alt:""})},t.id)))})]})})}):Object(C.jsx)(tt,{})}function kt(){const{postId:e}=Object(L.useParams)(),[t,s]=Object(n.useState)(),{fetchedItems:o,finishLoading:c}=M(),a=Object(n.useCallback)((()=>c("Post")),[c]);return Object(n.useEffect)((()=>F("posts/post"+e).on((e=>{e?(s(e),o.current.setExpected(1)):(c(),s(null))}))),[o,c,e]),void 0===t?null:null===t?Object(C.jsx)(tt,{}):Object(C.jsx)("section",{className:"post-page",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsx)(mt,{fetchedItems:o,loadingCallback:a,post:t,renderComments:!0})})})}function It({profileOwner:e,profilePhotos:t}){var s,n,o,c;const r=Object(a.b)(),{ownerId:d}=Object(L.useParams)(),u=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.friendRequests})),m=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id}));function b(){r(l("action-confirm",{actionConfirm:{callback:()=>F().update({[`users/user${d}/friends/user${m}`]:null,[`users/user${m}/friends/user${d}`]:null}),text:"Are you sure you want to remove this friend?"}}))}const j=Object.values({...e.friends});return Object(C.jsxs)("div",{className:"profile__left",children:[Object(C.jsx)(me,{avatar:t.current.find((t=>t.src===e.info.avatar)),userInfo:e.info}),Object(C.jsx)("div",{className:"profile__left-online-status",children:Object(C.jsx)("p",{className:"profile__left-online-status-text",children:se(e)})}),e.info.deleted?(null===(c=e.friends)||void 0===c?void 0:c["user"+m])&&Object(C.jsx)("div",{className:"profile__left-buttons",children:Object(C.jsx)(be,{afterIcon:E.H,iconStyles:{width:"1.25em"},preset:"remove",text:"Remove friend",onClick:b})}):Object(C.jsxs)(C.Fragment,{children:[m&&(d!==m?Object(C.jsxs)("div",{className:"profile__left-buttons",children:[(null===(s=e.friends)||void 0===s?void 0:s["user"+m])?Object(C.jsx)(be,{afterIcon:E.H,iconStyles:{width:"1.25em"},preset:"remove",text:"Remove friend",onClick:b}):(null===u||void 0===u||null===(n=u.received)||void 0===n?void 0:n["user"+d])?Object(C.jsx)(be,{afterIcon:E.I,iconStyles:{width:"1.25em"},text:"Accept friend request",onClick:()=>Q({reqUserId:d,userId:m})}):(null===u||void 0===u||null===(o=u.sent)||void 0===o?void 0:o["user"+d])?Object(C.jsx)(be,{afterIcon:E.J,iconStyles:{width:"1.25em"},preset:"remove",text:"Cancel friend request",onClick:function(){const e=`users/user${d}/`;F().update({[`${e}friendRequests/received/user${m}`]:null,[`users/user${m}/friendRequests/sent/user${d}`]:null,[e+"fullInfo/followerCount"]:R(-1)})}}):Object(C.jsx)(be,{afterIcon:E.I,iconStyles:{width:"1.25em"},text:"Add friend",onClick:function(){const e=`users/user${d}/`;F().update({[`${e}friendRequests/received/user${m}`]:{date:A,userId:m},[`users/user${m}/friendRequests/sent/user${d}`]:{date:A,userId:d},[e+"fullInfo/followerCount"]:R(1)})}}),Object(C.jsx)(be,{afterIcon:E.k,text:"Send message",to:"/conversation?interlocutor="+d})]}):Object(C.jsx)("div",{className:"profile__left-buttons",children:Object(C.jsx)(be,{afterIcon:E.r,iconStyles:{width:".75em"},preset:"secondary",text:"Change avatar",onClick:()=>r(l("change-avatar"))})})),Object(C.jsxs)("div",{className:"profile__left-friends",children:[Object(C.jsx)("div",{className:"profile__left-friends-header",children:Object(C.jsx)(i.b,{className:"profile__left-friends-title",to:`/friends${d!==m?d:""}`,children:`Friends (${j.length})`})}),j.length>0&&Object(C.jsx)("div",{className:"profile__left-friends-items",children:j.map((e=>Object(C.jsx)(Ct,{friendId:e.userId},e.userId)))})]})]})]})}function Ct({friendId:e}){const[t,s]=Object(n.useState)();return Object(n.useEffect)((()=>Y({callback:e=>s(e.info),userId:e})),[e]),t?Object(C.jsxs)("div",{className:"profile__left-friends-item",children:[Object(C.jsx)(ue,{size:"small",src:t.avatar,userId:e}),Object(C.jsx)(i.b,{className:"profile__left-friends-item-name",to:"/id"+e,children:t.name})]}):null}function $t(){var e,t,s;const o=Object(a.b)(),{ownerId:c}=Object(L.useParams)(),r=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.admin})),d=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),u=Object(n.useRef)(),m=Object(n.useRef)([]),[b,j]=Object(n.useState)(),[h,f]=Object(n.useState)(),{fetchedItems:p,finishLoading:v,loaded:O,setTitle:x}=M(),_=Object(n.useCallback)((()=>{v((null===h||void 0===h?void 0:h.info.name)+" "+(null===h||void 0===h?void 0:h.info.lastName))}),[v,null===h||void 0===h?void 0:h.info.lastName,null===h||void 0===h?void 0:h.info.name]),g=Object(n.useCallback)((e=>{if(e){if(document.activeElement.blur(),m.current=[],e.profilePhotos){for(const s in e.profilePhotos){var t;(null===(t=e.photos)||void 0===t?void 0:t[s])&&m.current.push(e.photos[s])}m.current.sort(((e,t)=>t.date-e.date))}u.current=F("posts").orderByChild("authorId").equalTo(c).on((e=>{const t=Object.values({...e});j(t.sort(((e,t)=>+t.id-+e.id))),p.current.setExpected(t.length)}))}else f(null)}),[p,c]);return Object(n.useEffect)((()=>{O.current?x((null===h||void 0===h?void 0:h.info.name)+" "+(null===h||void 0===h?void 0:h.info.lastName)):b?_():null!==b&&null!==h||v()}),[v,O,_,c,b,h,x,d]),Object(n.useEffect)((()=>{if(null===d)return;const e=Y({callback:e=>{var t;null===(t=u.current)||void 0===t||t.call(u),g(e),f(e)},fields:["connections","friends","fullInfo","info","photos","profilePhotos"],userId:c});return()=>{var t;e(),null===(t=u.current)||void 0===t||t.call(u)}}),[c,g,d]),void 0===h?null:h?Object(C.jsx)("section",{className:"profile",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"profile__wrapper",children:[Object(C.jsx)(It,{profileOwner:h,profilePhotos:m}),Object(C.jsxs)("div",{className:"profile__content",children:[Object(C.jsxs)("div",{className:"profile__content-info",children:[Object(C.jsxs)("div",{className:"profile__content-info-header",children:[Object(C.jsxs)("div",{className:"profile__content-info-header-container",children:[Object(C.jsx)("h1",{className:"profile__content-info-header-name",children:`${h.info.name} ${h.info.lastName}`}),c!==d&&!h.info.deleted&&Object(C.jsx)(he,{bookmarkType:"user",itemId:c,children:r&&Object(C.jsx)(be,{text:"Delete user",onClick:function(){o(l("action-confirm",{actionConfirm:{callback:()=>X(c),irreversible:!0,password:!0,text:"Are you sure you want to delete this account?"}}))}})})]}),Object(C.jsx)(je,{className:"user-status",databaseRef:`users/user${c}/fullInfo/status`,emptyButtonText:"Set status",field:null===(e=h.fullInfo)||void 0===e?void 0:e.status,ownerId:c,renderInputId:"status"})]}),(h.info.birthday||h.info.country||h.info.city)&&Object(C.jsxs)("div",{className:"profile__content-info-middle",children:[h.info.birthday&&Object(C.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(C.jsx)("span",{className:"profile__content-info-middle-item-title",children:"Birthday: "}),Object(C.jsx)("span",{className:"profile__content-info-middle-item-value",children:h.info.birthday})]}),h.info.country&&Object(C.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(C.jsx)("span",{className:"profile__content-info-middle-item-title",children:"Country: "}),Object(C.jsx)("span",{className:"profile__content-info-middle-item-value",children:h.info.country})]}),h.info.city&&Object(C.jsxs)("p",{className:"profile__content-info-middle-item",children:[Object(C.jsx)("span",{className:"profile__content-info-middle-item-title",children:"City: "}),Object(C.jsx)("span",{className:"profile__content-info-middle-item-value",children:h.info.city})]})]}),Object(C.jsxs)("div",{className:"profile__content-info-footer",children:[(null===(t=h.fullInfo)||void 0===t?void 0:t.followerCount)>0&&Object(C.jsxs)("div",{className:"profile__content-info-footer-item",children:[Object(C.jsx)("p",{className:"profile__content-info-footer-item-number",children:null===(s=h.fullInfo)||void 0===s?void 0:s.followerCount}),Object(C.jsx)("p",{className:"profile__content-info-footer-item-title",children:"followers"})]}),h.profilePhotos&&Object(C.jsxs)(i.b,{className:"profile__content-info-footer-button",to:`/photos${c!==d?c:""}`,children:[Object(C.jsx)("p",{className:"profile__content-info-footer-button-number",children:Object.keys(h.profilePhotos).length}),Object(C.jsx)("p",{className:"profile__content-info-footer-button-title",children:"photos"})]}),Object(C.jsxs)(i.b,{className:"profile__content-info-footer-button",to:"#todo",children:[Object(C.jsx)("p",{className:"profile__content-info-footer-button-number",children:null===b||void 0===b?void 0:b.length}),Object(C.jsx)("p",{className:"profile__content-info-footer-button-title",children:"posts"})]})]})]}),!h.info.deleted&&Object(C.jsxs)(C.Fragment,{children:[Object(C.jsxs)("div",{className:"profile__content-photos",children:[Object(C.jsx)(i.b,{className:"profile__content-photos-title",to:`/photos${c!==d?c:""}`,children:"Photos: "+Object.keys({...h.profilePhotos}).length}),m.current.length>0&&Object(C.jsx)("div",{className:"profile__content-photos-container",children:m.current.map(((e,t)=>t<4&&Object(C.jsx)(i.b,{className:"profile__content-photos-img-container",to:"#javascript",onClick:e=>{o(l("gallery",{gallery:{authorInfo:h.info,content:m.current,initialSlide:t}})),e.preventDefault()},children:Object(C.jsx)("div",{className:"profile__content-photos-img-inner-container",children:Object(C.jsx)("img",{className:"profile__content-photos-img",src:e.src,alt:""})})},e.id)))})]}),Object(C.jsxs)("div",{className:"profile__content-posts",children:[Object(C.jsx)("div",{className:"profile__content-posts-header",children:Object(C.jsx)(i.b,{className:"profile__content-posts-title",to:"#todo",children:"Posts"})}),null===b||void 0===b?void 0:b.map(((e,t)=>Object(C.jsx)(mt,{fetchedItems:p,index:t,loadingCallback:_,post:e},e.id)))]})]})]})]})})}):Object(C.jsx)(tt,{})}function St(){const e=Object(L.useHistory)(),{finishLoading:t}=M(),{search:s}=Object(L.useLocation)(),o=new URLSearchParams(s).get("query"),c=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),[a,i]=Object(n.useState)(),[r,l]=Object(n.useState)(""),d=Object(n.useCallback)((e=>!o||e.toLowerCase().includes(o.toLowerCase())),[o]);return Object(n.useEffect)((()=>{const e=[];let t=!1;return F("contentData/nextUserId").once((s=>{if(t)return;const n=parseInt(s,10)-1,o=[!0],c=[];for(let t=1;t<=n;t++)e[t]=Y({callback:e=>{o[t]||e.info.deleted||!d(e.info.name)&&!d(e.info.lastName)||c.push(e),o[t]=!0,o.includes(void 0)||o.length-1!==n||i(c.sort(((e,t)=>+e.info.id-+t.info.id)))},fields:["connections","info"],userId:`${t}`})})),()=>{t=!0,e.forEach((e=>e()))}}),[d]),Object(n.useEffect)((()=>{a&&t(o?`Search results for ${o}`:"Search")}),[t,a,o]),Object(n.useEffect)((()=>l(o||"")),[o]),Object(n.useEffect)((()=>{const t=setTimeout((()=>{(o||"")!==r&&e.push(`?query=${r||""}`)}),250);return()=>clearTimeout(t)}),[e,o,r]),null===c?null:Object(C.jsx)("section",{className:"search",children:Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"search__wrapper",children:[Object(C.jsxs)("div",{className:"search__header",children:[Object(C.jsx)("h1",{className:"search__title",children:`Search users (${null===a||void 0===a?void 0:a.length})`}),Object(C.jsx)(pe,{onChange:e=>l(e.target.value),onSubmit:e=>e.preventDefault(),value:r})]}),Object(C.jsx)("div",{className:"search__content",children:(null===a||void 0===a?void 0:a.length)?Object(C.jsx)(nt,{users:a}):Object(C.jsx)("p",{className:"search__no-results",children:"No results."})})]})})})}function Et(){const e=Object(L.useHistory)(),{search:t}=Object(L.useLocation)(),s=new URLSearchParams(t).get("tab"),o=k((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.account.id})),{finishLoading:c}=M(),a=["account","security"].find((e=>e===s))||"information";if(Object(n.useEffect)((()=>{void 0===o?e.push("/"):o&&c("Settings")}),[c,e,o]),!o)return null;const r=e=>"sidebar__button"+(a===e?" sidebar__button--active":"");return Object(C.jsxs)("section",{className:"settings",children:[Object(C.jsx)("div",{className:"content-width",children:Object(C.jsxs)("div",{className:"settings__wrapper",children:[Object(C.jsx)("div",{className:"settings__header",children:Object(C.jsxs)("h1",{className:"settings__title",children:["information"===a&&"Main Information","security"===a&&"Security","account"===a&&"Account"]})}),"information"===a&&Object(C.jsx)(Lt,{}),"security"===a&&Object(C.jsx)(Tt,{}),"account"===a&&Object(C.jsx)(Pt,{})]})}),Object(C.jsx)("aside",{className:"sidebar",children:Object(C.jsxs)("div",{className:"sidebar__wrapper",children:[Object(C.jsx)(i.b,{className:r("information"),to:"/settings",children:"Information"}),Object(C.jsx)(i.b,{className:r("security"),to:"?tab=security",children:"Security"}),Object(C.jsx)(i.b,{className:r("account"),to:"?tab=account",children:"Account"})]})})]})}function Lt(){const e=k((e=>e.user.info)),{formState:{errors:t},handleSubmit:s,register:n,reset:o}=Object(S.a)(),{AsyncButton:c,buttonLoadingRef:a,setButtonLoading:i}=q();return Object(C.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:s((function(t){if(!a.current){i(),t=te(t);for(const e in t)t[e]||(t[e]=null);F(`users/user${e.id}/info`).update(t).then((()=>{i(!1),o()}))}})),children:[G.filter((e=>["name","lastName"].includes(e.id))).map((s=>Object(C.jsx)(J,{opts:{obj:s,defaultValue:e[s.id],errors:t,label:!0,register:n}},s.id))),Object(C.jsx)(V,{register:n,userGender:e.gender}),G.filter((e=>["country","city"].includes(e.id))).map((s=>Object(C.jsx)(J,{opts:{obj:s,defaultValue:e[s.id],errors:t,label:!0,register:n}},s.id))),Object(C.jsxs)("div",{className:"settings__buttons",children:[Object(C.jsx)(c,{text:"Save",type:"submit"}),Object(C.jsx)(be,{preset:"secondary",text:"Cancel",onClick:()=>o()})]})]})}function Tt(){const e=k((e=>e.user.account)),t=k((e=>e.user.account.id)),{formState:{errors:s},handleSubmit:o,register:c,reset:a}=Object(S.a)(),{AsyncButton:i,buttonLoadingRef:r,setButtonLoading:l}=q(),d=Object(n.useRef)(),[u,m]=Object(n.useState)(!1);return Object(C.jsxs)("form",{className:"primary-form",action:"#",method:"post",noValidate:!0,onSubmit:o((function(s){var n;r.current||(l(),null===(n=d.current)||void 0===n||n.call(d),d.current=F("users").orderByChild("account/email").equalTo(s.email.toLowerCase()).on((n=>{if(d.current(),n&&!n["user"+t])return s.email=e.email,l(!1),void m(!0);F(`users/user${e.id}/account`).update({email:s.email.toLowerCase(),password:x(s.password,t)}).then((()=>{if(_(e.password)!==s.password){const e={id:t,password:s.password};document.cookie=`USER_DATA=${JSON.stringify(e)}; expires=${new Date(Date.now()+31536e6)}`}l(!1),a()}))})))})),children:[Object(C.jsx)(J,{onInput:()=>m(!1),opts:{obj:G.find((e=>"email"===e.id)),defaultValue:e.email,errors:s,label:!0,register:c}}),u&&Object(C.jsx)("p",{className:"error-text",children:"This email is already used."}),Object(C.jsx)(J,{opts:{obj:G.find((e=>"password"===e.id)),defaultValue:_(e.password),errors:s,label:!0,register:c}}),Object(C.jsxs)("div",{className:"settings__buttons",children:[Object(C.jsx)(i,{text:"Save",type:"submit"}),Object(C.jsx)(be,{preset:"secondary",text:"Cancel",onClick:()=>{a(),m(!1)}})]})]})}function Pt(){const e=Object(a.b)(),t=k((e=>e.user.account.id));return Object(C.jsxs)("form",{className:"primary-form",action:"#",method:"post",onSubmit:function(s){s.preventDefault(),e(l("action-confirm",{actionConfirm:{callback:()=>{e(d("action-confirm")),setTimeout((()=>{e({type:"LOG_OUT"}),setTimeout((()=>X(t)),0)}),400)},irreversible:!0,password:!0,text:"Are you sure you want to delete your account?"}}))},children:[Object(C.jsx)("h3",{className:"primary-form__title",children:"Account removal"}),Object(C.jsx)(be,{preset:"remove",text:"Delete account",type:"submit"})]})}function Rt(){const e=Object(a.b)(),{pathname:t}=Object(L.useLocation)(),s=k((e=>e.modal.currentModal)),o=Object(n.useRef)(null);return o.current=s,Object(n.useEffect)((()=>{o.current&&e(d(o.current))}),[e,t]),null}const At=()=>document.documentElement.style.setProperty("--page-height",window.innerHeight+"px");function Dt(){return window.history.scrollRestoration="manual",Object(C.jsx)(i.a,{children:Object(C.jsx)(a.a,{store:I,children:Object(C.jsxs)(c.b.Provider,{value:{style:{flexShrink:0}},children:[Object(C.jsx)(Rt,{}),Object(C.jsx)(et,{}),Object(C.jsx)(Je,{}),Object(C.jsx)("main",{className:"main",children:Object(C.jsxs)("div",{className:"page-width",children:[Object(C.jsx)(We,{}),Object(C.jsxs)(r.Switch,{loadingScreen:()=>Object(C.jsxs)("div",{className:"loading-screen",children:[Object(C.jsx)("div",{}),Object(C.jsx)("div",{}),Object(C.jsx)("div",{}),Object(C.jsx)("div",{})]}),children:[Object(C.jsx)(r.Route,{path:"/",exact:!0,component:_t}),Object(C.jsx)(r.Route,{path:"/bookmarks",component:bt,loading:!0}),Object(C.jsx)(r.Route,{path:"/communities",component:jt,loading:!0}),Object(C.jsx)(r.Route,{path:"/community:communityId",component:ht,loading:!0}),Object(C.jsx)(r.Route,{path:"/conversation",component:ft,loading:!0}),Object(C.jsx)(r.Route,{path:"/friends",component:vt,loading:!0}),Object(C.jsx)(r.Route,{path:"/messages",component:gt,loading:!0}),Object(C.jsx)(r.Route,{path:"/news",component:Nt,loading:!0}),Object(C.jsx)(r.Route,{path:"/photos",component:wt,loading:!0}),Object(C.jsx)(r.Route,{path:"/search",component:St,loading:!0}),Object(C.jsx)(r.Route,{path:"/settings",component:Et,loading:!0}),Object(C.jsx)(r.Route,{path:"/conversation:conversationId",component:ft,loading:!0}),Object(C.jsx)(r.Route,{path:"/friends:ownerId",component:vt,loading:!0}),Object(C.jsx)(r.Route,{path:"/photos:ownerId",component:wt,loading:!0}),Object(C.jsx)(r.Route,{path:"/post:postId",component:kt,loading:!0}),Object(C.jsx)(r.Route,{path:"/id:ownerId",component:$t,loading:!0}),Object(C.jsx)(r.Route,{path:"/",component:tt})]})]})}),Object(C.jsx)(Ze,{}),Object(C.jsx)(Qe,{}),Object(C.jsx)(Xe,{}),Object(C.jsx)(Ue,{}),Object(C.jsx)(Fe,{})]})})})}At(),window.addEventListener("resize",At);var Mt=e=>{e&&e instanceof Function&&s.e(3).then(s.bind(null,80)).then((({getCLS:t,getFID:s,getFCP:n,getLCP:o,getTTFB:c})=>{t(e),s(e),n(e),o(e),c(e)}))};Object(o.render)(Object(C.jsx)(n.StrictMode,{children:Object(C.jsx)(Dt,{})}),document.getElementById("app")),Mt()}},[[70,1,2]]]);